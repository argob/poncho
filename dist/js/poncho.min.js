function ponchoTable(opt){var filtroColumna,listado=[],filteredTitle=[],filteredTitleGsx=[],filtro=[],titulos="",th=[],lista="";jQuery.fn.DataTable.isDataTable("#ponchoTable")&&jQuery("#ponchoTable").DataTable().destroy(),jQuery.getJSON("https://spreadsheets.google.com/feeds/list/"+opt.idSpread+"/"+opt.hojaNumero+"/public/values?alt=json",function(data){listado=data.feed.entry,jQuery.each(Object.keys(listado[0]),function(index,key){"gsx$"==key.substr(0,4)&&(filteredTitle.push(listado[0][key].$t),filteredTitleGsx.push(key),titulos+="<th>"+listado[0][key].$t+"</th>",th.push(listado[0][key].$t))}),jQuery("#ponchoTable caption").html(opt.tituloTabla),jQuery("#ponchoTable thead tr").empty(),jQuery("#ponchoTable thead tr").append(titulos),jQuery.each(listado,function(row,value){0<row&&(lista+="<tr>",jQuery.each(filteredTitleGsx,function(index,title){var tdEmpty="";if("gsx$"==title.substr(0,4)){filas=listado[row][filteredTitleGsx[index]].$t,title==filteredTitleGsx[0]&&(labelBtn=filas),title.includes("btn-")&&""!=filas&&(nameBtn=title.substr(8,title.length-8).replace("-"," "),filas='<a aria-label="'+nameBtn+" "+labelBtn+'" class="btn btn-primary btn-sm margin-btn" target="_blank" href="'+filas+'">'+nameBtn+"</a>"),title.includes("filtro-")&&""!=filas&&(filtroColumna=index,nameFiltro=title.substr(11,title.length-11).replace("-"," "),jQuery("#tituloFiltro").html(nameFiltro),filtro.push(filas)),""==filas&&(tdEmpty="hidden-xs");var filas=(new showdown.Converter).makeHtml(filas);lista+='<td class="'+tdEmpty+'" data-title="'+th[index]+'">'+filas+"</td>"}}),lista+="</tr>")}),jQuery.each(filtro.filter(function(el,index,arr){return index===arr.indexOf(el)}),function(index,val){jQuery("#ponchoTableFiltro").append("<option>"+val+"</option>")}),jQuery("#ponchoTable tbody").empty(),jQuery("#ponchoTable tbody").append(lista),function(){function removeAccents(data){return data.replace(/έ/g,"ε").replace(/[ύϋΰ]/g,"υ").replace(/ό/g,"ο").replace(/ώ/g,"ω").replace(/ά/g,"α").replace(/[ίϊΐ]/g,"ι").replace(/ή/g,"η").replace(/\n/g," ").replace(/[áÁ]/g,"a").replace(/[éÉ]/g,"e").replace(/[íÍ]/g,"i").replace(/[óÓ]/g,"o").replace(/[úÚ]/g,"u").replace(/ê/g,"e").replace(/î/g,"i").replace(/ô/g,"o").replace(/è/g,"e").replace(/ï/g,"i").replace(/ü/g,"u").replace(/ã/g,"a").replace(/õ/g,"o").replace(/ç/g,"c").replace(/ì/g,"i")}var searchType=jQuery.fn.DataTable.ext.type.search;console.log(jQuery.fn.DataTable.ext.type.search),searchType.string=function(data){return data?"string"==typeof data?removeAccents(data):data:""},searchType.html=function(data){return data?"string"==typeof data?removeAccents(data.replace(/<.*?>/g,"")):data:""};var tabla=jQuery("#ponchoTable").DataTable({lengthChange:!1,autoWidth:!1,ordering:opt.orden,order:[[opt.ordenColumna-1,opt.ordenTipo]],dom:"<'row'<'col-sm-6'l><'col-sm-6'f>><'row'<'col-sm-12'i>><'row'<'col-sm-12'tr>><'row'<'col-md-offset-3 col-md-6 col-sm-offset-2 col-sm-8'p>>",language:{sProcessing:"Procesando...",sLengthMenu:"Mostrar _MENU_ registros",sZeroRecords:"No se encontraron resultados",sEmptyTable:"Ningún dato disponible en esta tabla",sInfo:"_TOTAL_ resultados",sInfoEmpty:"No hay resultados",sInfoFiltered:"",sInfoPostFix:"",sSearch:"Buscar:",sUrl:"",sInfoThousands:",",sLoadingRecords:"Cargando...",oPaginate:{sFirst:"<<",sLast:">>",sNext:">",sPrevious:"<"},oAria:{sSortAscending:": Activar para ordenar la columna de manera ascendente",sSortDescending:": Activar para ordenar la columna de manera descendente",paginate:{first:"Ir a la primera página",previous:"Ir a la página anterior",next:"Ir a la página siguiente",last:"Ir a la última página"}}}});jQuery(document).ready(function(){jQuery("#ponchoTableSearch").keyup(function(){tabla.search(jQuery.fn.DataTable.ext.type.search.string(this.value)).draw()})}),jQuery("#ponchoTable_filter").parent().parent().remove(),1<jQuery("#ponchoTableFiltro option").length&&jQuery("#ponchoTableFiltroCont").show();jQuery("#ponchoTableFiltro").on("change",function(){var filtro=jQuery(this).val();""!=filtro?tabla.column(filtroColumna).every(function(){this.search(jQuery.fn.DataTable.ext.type.search.string(filtro)).draw()}):tabla.search("").columns().search("").draw()})}()})}function ponchoMaps(opt){var puntos,mapOptions={center:new google.maps.LatLng(58,16),zoom:5,mapTypeId:google.maps.MapTypeId.ROADMAP,center:{lat:-39.6930895,lng:-57.2432742},styles:[{featureType:"administrative.country",stylers:[{visibility:"on"}]},{featureType:"poi",stylers:[{visibility:"off"}]}]},map=new google.maps.Map(document.getElementById("map"),mapOptions);jQuery.getJSON("https://spreadsheets.google.com/feeds/list/"+opt.idSpreadheet+"/"+opt.hojaNumero+"/public/values?alt=json",function(data){var autores=["metricas.mod@gmail.com","modernizacion.ux@gmail.com","contenidosgobar@gmail.com"];jQuery.each(data.feed.author,function(index,val){-1==autores.indexOf(val.email.$t)&&(jQuery("body").remove(),window.location.replace("http://www.argentina.gob.ar"))}),puntos=data.feed.entry;var markers=[],detalles=[],template=['<?xml version="1.0"?>','<svg version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="286.818px" height="396.798px" viewBox="63.14 8.15 286.818 396.798" enable-background="new 63.14 8.15 286.818 396.798" xml:space="preserve">','<path stroke="#FFF" stroke-width="10" fill="{{ color }}" d="M206.549,20.359L206.549,20.359c-74.459,0-134.584,60.126-134.584,134.584c0,25.961,8.293,50.751,19.832,71.122l87.71,151.801c5.499,9.916,16.586,14.874,27.043,14.874c10.458,0,21.003-4.958,27.043-14.874l87.71-151.711c11.629-20.373,19.832-44.712,19.832-71.124C341.133,80.574,281.008,20.359,206.549,20.359z M206.549,206.978c-33.804,0-61.41-27.606-61.41-61.41s27.606-61.41,61.41-61.41s61.41,27.606,61.41,61.41C267.959,179.484,240.353,206.978,206.549,206.978z"/>',"</svg>"].join("\n"),colores={azul:{hex:"#0072BB"},verde:{hex:"#2E7D33"},rojo:{hex:"#C62828"},gris:{hex:"#707070"},fucsia:{hex:"#EC407A"},arandano:{hex:"#C2185B"},uva:{hex:"#6A1B99"},cielo:{hex:"#039BE5"},verdin:{hex:"#6EA100"},lima:{hex:"#CDDC39"},maiz:{hex:"#FFCE00"},tomate:{hex:"#EF5350"},"naranja oscuro":{hex:"#EF6C00"},"verde azulado":{hex:"#008388"}};jQuery.each(puntos,function(key,punto){color=punto.gsx$color.$t.toLowerCase(),svg=template.replace("{{ color }}",colores[color].hex);var latLng=new google.maps.LatLng(punto.gsx$latitud.$t,punto.gsx$longitud.$t),marker=new google.maps.Marker({position:latLng,title:punto.gsx$nombre.$t,icon:{url:"data:image/svg+xml;charset=UTF-8,"+encodeURIComponent(svg),scaledSize:new google.maps.Size(40,40)},optimized:!1});if(markers.push(marker),provincia=localidad=telefono=email=boton=descripcion=ubicacion="",""==punto.gsx$provincia.$t&&""==punto.gsx$localidad.$t||(ubicacion='<div class="separarGuiones"><i class="fa fa-map-marker"></i><span>'+punto.gsx$provincia.$t+"</span><span>"+punto.gsx$localidad.$t+"</span></div>"),""!=punto.gsx$telefono.$t&&(telefono="<div><i class='fa fa-phone'></i>"+punto.gsx$telefono.$t+"</div>"),""!=punto.gsx$email.$t&&(email="<div><i class='fa fa-envelope'></i>"+punto.gsx$email.$t+"</div>"),""!=punto.gsx$descripcion.$t){var converter=new showdown.Converter;descripcion="<div>"+converter.makeHtml(punto.gsx$descripcion.$t)+"</div>"}""!=punto.gsx$boton.$t&&(boton="<hr><a class='btn btn-success btn-sm' href="+punto.gsx$boton.$t+">"+opt.textoBoton+"</a>"),detalles[key]=new google.maps.InfoWindow({content:'<div class="media"> <div class="media-body"><small class="text-primary">'+punto.gsx$tipo.$t+"</small><h4>"+punto.gsx$nombre.$t+"</h4> "+descripcion+ubicacion+telefono+email+boton+"</div></div>",maxWidth:300}),markers[key].addListener("click",function(){closeWindows(),map.setZoom(17),map.setCenter(markers[key].getPosition()),detalles[key].open(map,markers[key])}),jQuery("#map-container").removeClass("state-loading"),marker.setMap(map)});var closeWindows=function(){for(i=0;i<detalles.length;i++)detalles[i].close()};if("si"==opt.agrupar)new MarkerClusterer(map,markers,{enableRetinaIcons:!0,imageSizes:[20,30,40,50,60,70],maxZoom:10,gridSize:50,styles:[{textColor:"white",url:"https://www.argentina.gob.ar/sites/default/files/cluster_ponchomaps.png",width:45,height:45}]})})}