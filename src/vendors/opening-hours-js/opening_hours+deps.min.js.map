{"version":3,"file":"opening_hours+deps.min.js","sources":["../node_modules/suncalc/suncalc.js","../node_modules/i18next/dist/esm/i18next.js","../src/locales/core.js","../src/index.js"],"sourcesContent":["/*\n (c) 2011-2015, Vladimir Agafonkin\n SunCalc is a JavaScript library for calculating sun/moon position and light phases.\n https://github.com/mourner/suncalc\n*/\n\n(function () { 'use strict';\n\n// shortcuts for easier to read formulas\n\nvar PI   = Math.PI,\n    sin  = Math.sin,\n    cos  = Math.cos,\n    tan  = Math.tan,\n    asin = Math.asin,\n    atan = Math.atan2,\n    acos = Math.acos,\n    rad  = PI / 180;\n\n// sun calculations are based on http://aa.quae.nl/en/reken/zonpositie.html formulas\n\n\n// date/time constants and conversions\n\nvar dayMs = 1000 * 60 * 60 * 24,\n    J1970 = 2440588,\n    J2000 = 2451545;\n\nfunction toJulian(date) { return date.valueOf() / dayMs - 0.5 + J1970; }\nfunction fromJulian(j)  { return new Date((j + 0.5 - J1970) * dayMs); }\nfunction toDays(date)   { return toJulian(date) - J2000; }\n\n\n// general calculations for position\n\nvar e = rad * 23.4397; // obliquity of the Earth\n\nfunction rightAscension(l, b) { return atan(sin(l) * cos(e) - tan(b) * sin(e), cos(l)); }\nfunction declination(l, b)    { return asin(sin(b) * cos(e) + cos(b) * sin(e) * sin(l)); }\n\nfunction azimuth(H, phi, dec)  { return atan(sin(H), cos(H) * sin(phi) - tan(dec) * cos(phi)); }\nfunction altitude(H, phi, dec) { return asin(sin(phi) * sin(dec) + cos(phi) * cos(dec) * cos(H)); }\n\nfunction siderealTime(d, lw) { return rad * (280.16 + 360.9856235 * d) - lw; }\n\nfunction astroRefraction(h) {\n    if (h < 0) // the following formula works for positive altitudes only.\n        h = 0; // if h = -0.08901179 a div/0 would occur.\n\n    // formula 16.4 of \"Astronomical Algorithms\" 2nd edition by Jean Meeus (Willmann-Bell, Richmond) 1998.\n    // 1.02 / tan(h + 10.26 / (h + 5.10)) h in degrees, result in arc minutes -> converted to rad:\n    return 0.0002967 / Math.tan(h + 0.00312536 / (h + 0.08901179));\n}\n\n// general sun calculations\n\nfunction solarMeanAnomaly(d) { return rad * (357.5291 + 0.98560028 * d); }\n\nfunction eclipticLongitude(M) {\n\n    var C = rad * (1.9148 * sin(M) + 0.02 * sin(2 * M) + 0.0003 * sin(3 * M)), // equation of center\n        P = rad * 102.9372; // perihelion of the Earth\n\n    return M + C + P + PI;\n}\n\nfunction sunCoords(d) {\n\n    var M = solarMeanAnomaly(d),\n        L = eclipticLongitude(M);\n\n    return {\n        dec: declination(L, 0),\n        ra: rightAscension(L, 0)\n    };\n}\n\n\nvar SunCalc = {};\n\n\n// calculates sun position for a given date and latitude/longitude\n\nSunCalc.getPosition = function (date, lat, lng) {\n\n    var lw  = rad * -lng,\n        phi = rad * lat,\n        d   = toDays(date),\n\n        c  = sunCoords(d),\n        H  = siderealTime(d, lw) - c.ra;\n\n    return {\n        azimuth: azimuth(H, phi, c.dec),\n        altitude: altitude(H, phi, c.dec)\n    };\n};\n\n\n// sun times configuration (angle, morning name, evening name)\n\nvar times = SunCalc.times = [\n    [-0.833, 'sunrise',       'sunset'      ],\n    [  -0.3, 'sunriseEnd',    'sunsetStart' ],\n    [    -6, 'dawn',          'dusk'        ],\n    [   -12, 'nauticalDawn',  'nauticalDusk'],\n    [   -18, 'nightEnd',      'night'       ],\n    [     6, 'goldenHourEnd', 'goldenHour'  ]\n];\n\n// adds a custom time to the times config\n\nSunCalc.addTime = function (angle, riseName, setName) {\n    times.push([angle, riseName, setName]);\n};\n\n\n// calculations for sun times\n\nvar J0 = 0.0009;\n\nfunction julianCycle(d, lw) { return Math.round(d - J0 - lw / (2 * PI)); }\n\nfunction approxTransit(Ht, lw, n) { return J0 + (Ht + lw) / (2 * PI) + n; }\nfunction solarTransitJ(ds, M, L)  { return J2000 + ds + 0.0053 * sin(M) - 0.0069 * sin(2 * L); }\n\nfunction hourAngle(h, phi, d) { return acos((sin(h) - sin(phi) * sin(d)) / (cos(phi) * cos(d))); }\nfunction observerAngle(height) { return -2.076 * Math.sqrt(height) / 60; }\n\n// returns set time for the given sun altitude\nfunction getSetJ(h, lw, phi, dec, n, M, L) {\n\n    var w = hourAngle(h, phi, dec),\n        a = approxTransit(w, lw, n);\n    return solarTransitJ(a, M, L);\n}\n\n\n// calculates sun times for a given date, latitude/longitude, and, optionally,\n// the observer height (in meters) relative to the horizon\n\nSunCalc.getTimes = function (date, lat, lng, height) {\n\n    height = height || 0;\n\n    var lw = rad * -lng,\n        phi = rad * lat,\n\n        dh = observerAngle(height),\n\n        d = toDays(date),\n        n = julianCycle(d, lw),\n        ds = approxTransit(0, lw, n),\n\n        M = solarMeanAnomaly(ds),\n        L = eclipticLongitude(M),\n        dec = declination(L, 0),\n\n        Jnoon = solarTransitJ(ds, M, L),\n\n        i, len, time, h0, Jset, Jrise;\n\n\n    var result = {\n        solarNoon: fromJulian(Jnoon),\n        nadir: fromJulian(Jnoon - 0.5)\n    };\n\n    for (i = 0, len = times.length; i < len; i += 1) {\n        time = times[i];\n        h0 = (time[0] + dh) * rad;\n\n        Jset = getSetJ(h0, lw, phi, dec, n, M, L);\n        Jrise = Jnoon - (Jset - Jnoon);\n\n        result[time[1]] = fromJulian(Jrise);\n        result[time[2]] = fromJulian(Jset);\n    }\n\n    return result;\n};\n\n\n// moon calculations, based on http://aa.quae.nl/en/reken/hemelpositie.html formulas\n\nfunction moonCoords(d) { // geocentric ecliptic coordinates of the moon\n\n    var L = rad * (218.316 + 13.176396 * d), // ecliptic longitude\n        M = rad * (134.963 + 13.064993 * d), // mean anomaly\n        F = rad * (93.272 + 13.229350 * d),  // mean distance\n\n        l  = L + rad * 6.289 * sin(M), // longitude\n        b  = rad * 5.128 * sin(F),     // latitude\n        dt = 385001 - 20905 * cos(M);  // distance to the moon in km\n\n    return {\n        ra: rightAscension(l, b),\n        dec: declination(l, b),\n        dist: dt\n    };\n}\n\nSunCalc.getMoonPosition = function (date, lat, lng) {\n\n    var lw  = rad * -lng,\n        phi = rad * lat,\n        d   = toDays(date),\n\n        c = moonCoords(d),\n        H = siderealTime(d, lw) - c.ra,\n        h = altitude(H, phi, c.dec),\n        // formula 14.1 of \"Astronomical Algorithms\" 2nd edition by Jean Meeus (Willmann-Bell, Richmond) 1998.\n        pa = atan(sin(H), tan(phi) * cos(c.dec) - sin(c.dec) * cos(H));\n\n    h = h + astroRefraction(h); // altitude correction for refraction\n\n    return {\n        azimuth: azimuth(H, phi, c.dec),\n        altitude: h,\n        distance: c.dist,\n        parallacticAngle: pa\n    };\n};\n\n\n// calculations for illumination parameters of the moon,\n// based on http://idlastro.gsfc.nasa.gov/ftp/pro/astro/mphase.pro formulas and\n// Chapter 48 of \"Astronomical Algorithms\" 2nd edition by Jean Meeus (Willmann-Bell, Richmond) 1998.\n\nSunCalc.getMoonIllumination = function (date) {\n\n    var d = toDays(date || new Date()),\n        s = sunCoords(d),\n        m = moonCoords(d),\n\n        sdist = 149598000, // distance from Earth to Sun in km\n\n        phi = acos(sin(s.dec) * sin(m.dec) + cos(s.dec) * cos(m.dec) * cos(s.ra - m.ra)),\n        inc = atan(sdist * sin(phi), m.dist - sdist * cos(phi)),\n        angle = atan(cos(s.dec) * sin(s.ra - m.ra), sin(s.dec) * cos(m.dec) -\n                cos(s.dec) * sin(m.dec) * cos(s.ra - m.ra));\n\n    return {\n        fraction: (1 + cos(inc)) / 2,\n        phase: 0.5 + 0.5 * inc * (angle < 0 ? -1 : 1) / Math.PI,\n        angle: angle\n    };\n};\n\n\nfunction hoursLater(date, h) {\n    return new Date(date.valueOf() + h * dayMs / 24);\n}\n\n// calculations for moon rise/set times are based on http://www.stargazing.net/kepler/moonrise.html article\n\nSunCalc.getMoonTimes = function (date, lat, lng, inUTC) {\n    var t = new Date(date);\n    if (inUTC) t.setUTCHours(0, 0, 0, 0);\n    else t.setHours(0, 0, 0, 0);\n\n    var hc = 0.133 * rad,\n        h0 = SunCalc.getMoonPosition(t, lat, lng).altitude - hc,\n        h1, h2, rise, set, a, b, xe, ye, d, roots, x1, x2, dx;\n\n    // go in 2-hour chunks, each time seeing if a 3-point quadratic curve crosses zero (which means rise or set)\n    for (var i = 1; i <= 24; i += 2) {\n        h1 = SunCalc.getMoonPosition(hoursLater(t, i), lat, lng).altitude - hc;\n        h2 = SunCalc.getMoonPosition(hoursLater(t, i + 1), lat, lng).altitude - hc;\n\n        a = (h0 + h2) / 2 - h1;\n        b = (h2 - h0) / 2;\n        xe = -b / (2 * a);\n        ye = (a * xe + b) * xe + h1;\n        d = b * b - 4 * a * h1;\n        roots = 0;\n\n        if (d >= 0) {\n            dx = Math.sqrt(d) / (Math.abs(a) * 2);\n            x1 = xe - dx;\n            x2 = xe + dx;\n            if (Math.abs(x1) <= 1) roots++;\n            if (Math.abs(x2) <= 1) roots++;\n            if (x1 < -1) x1 = x2;\n        }\n\n        if (roots === 1) {\n            if (h0 < 0) rise = i + x1;\n            else set = i + x1;\n\n        } else if (roots === 2) {\n            rise = i + (ye < 0 ? x2 : x1);\n            set = i + (ye < 0 ? x1 : x2);\n        }\n\n        if (rise && set) break;\n\n        h0 = h2;\n    }\n\n    var result = {};\n\n    if (rise) result.rise = hoursLater(t, rise);\n    if (set) result.set = hoursLater(t, set);\n\n    if (!rise && !set) result[ye > 0 ? 'alwaysUp' : 'alwaysDown'] = true;\n\n    return result;\n};\n\n\n// export as Node module / AMD module / browser variable\nif (typeof exports === 'object' && typeof module !== 'undefined') module.exports = SunCalc;\nelse if (typeof define === 'function' && define.amd) define(SunCalc);\nelse window.SunCalc = SunCalc;\n\n}());\n","const isString = obj => typeof obj === 'string';\nconst defer = () => {\n  let res;\n  let rej;\n  const promise = new Promise((resolve, reject) => {\n    res = resolve;\n    rej = reject;\n  });\n  promise.resolve = res;\n  promise.reject = rej;\n  return promise;\n};\nconst makeString = object => {\n  if (object == null) return '';\n  return '' + object;\n};\nconst copy = (a, s, t) => {\n  a.forEach(m => {\n    if (s[m]) t[m] = s[m];\n  });\n};\nconst lastOfPathSeparatorRegExp = /###/g;\nconst cleanKey = key => key && key.indexOf('###') > -1 ? key.replace(lastOfPathSeparatorRegExp, '.') : key;\nconst canNotTraverseDeeper = object => !object || isString(object);\nconst getLastOfPath = (object, path, Empty) => {\n  const stack = !isString(path) ? path : path.split('.');\n  let stackIndex = 0;\n  while (stackIndex < stack.length - 1) {\n    if (canNotTraverseDeeper(object)) return {};\n    const key = cleanKey(stack[stackIndex]);\n    if (!object[key] && Empty) object[key] = new Empty();\n    if (Object.prototype.hasOwnProperty.call(object, key)) {\n      object = object[key];\n    } else {\n      object = {};\n    }\n    ++stackIndex;\n  }\n  if (canNotTraverseDeeper(object)) return {};\n  return {\n    obj: object,\n    k: cleanKey(stack[stackIndex])\n  };\n};\nconst setPath = (object, path, newValue) => {\n  const {\n    obj,\n    k\n  } = getLastOfPath(object, path, Object);\n  if (obj !== undefined || path.length === 1) {\n    obj[k] = newValue;\n    return;\n  }\n  let e = path[path.length - 1];\n  let p = path.slice(0, path.length - 1);\n  let last = getLastOfPath(object, p, Object);\n  while (last.obj === undefined && p.length) {\n    e = `${p[p.length - 1]}.${e}`;\n    p = p.slice(0, p.length - 1);\n    last = getLastOfPath(object, p, Object);\n    if (last?.obj && typeof last.obj[`${last.k}.${e}`] !== 'undefined') {\n      last.obj = undefined;\n    }\n  }\n  last.obj[`${last.k}.${e}`] = newValue;\n};\nconst pushPath = (object, path, newValue, concat) => {\n  const {\n    obj,\n    k\n  } = getLastOfPath(object, path, Object);\n  obj[k] = obj[k] || [];\n  obj[k].push(newValue);\n};\nconst getPath = (object, path) => {\n  const {\n    obj,\n    k\n  } = getLastOfPath(object, path);\n  if (!obj) return undefined;\n  if (!Object.prototype.hasOwnProperty.call(obj, k)) return undefined;\n  return obj[k];\n};\nconst getPathWithDefaults = (data, defaultData, key) => {\n  const value = getPath(data, key);\n  if (value !== undefined) {\n    return value;\n  }\n  return getPath(defaultData, key);\n};\nconst deepExtend = (target, source, overwrite) => {\n  for (const prop in source) {\n    if (prop !== '__proto__' && prop !== 'constructor') {\n      if (prop in target) {\n        if (isString(target[prop]) || target[prop] instanceof String || isString(source[prop]) || source[prop] instanceof String) {\n          if (overwrite) target[prop] = source[prop];\n        } else {\n          deepExtend(target[prop], source[prop], overwrite);\n        }\n      } else {\n        target[prop] = source[prop];\n      }\n    }\n  }\n  return target;\n};\nconst regexEscape = str => str.replace(/[\\-\\[\\]\\/\\{\\}\\(\\)\\*\\+\\?\\.\\\\\\^\\$\\|]/g, '\\\\$&');\nvar _entityMap = {\n  '&': '&amp;',\n  '<': '&lt;',\n  '>': '&gt;',\n  '\"': '&quot;',\n  \"'\": '&#39;',\n  '/': '&#x2F;'\n};\nconst escape = data => {\n  if (isString(data)) {\n    return data.replace(/[&<>\"'\\/]/g, s => _entityMap[s]);\n  }\n  return data;\n};\nclass RegExpCache {\n  constructor(capacity) {\n    this.capacity = capacity;\n    this.regExpMap = new Map();\n    this.regExpQueue = [];\n  }\n  getRegExp(pattern) {\n    const regExpFromCache = this.regExpMap.get(pattern);\n    if (regExpFromCache !== undefined) {\n      return regExpFromCache;\n    }\n    const regExpNew = new RegExp(pattern);\n    if (this.regExpQueue.length === this.capacity) {\n      this.regExpMap.delete(this.regExpQueue.shift());\n    }\n    this.regExpMap.set(pattern, regExpNew);\n    this.regExpQueue.push(pattern);\n    return regExpNew;\n  }\n}\nconst chars = [' ', ',', '?', '!', ';'];\nconst looksLikeObjectPathRegExpCache = new RegExpCache(20);\nconst looksLikeObjectPath = (key, nsSeparator, keySeparator) => {\n  nsSeparator = nsSeparator || '';\n  keySeparator = keySeparator || '';\n  const possibleChars = chars.filter(c => nsSeparator.indexOf(c) < 0 && keySeparator.indexOf(c) < 0);\n  if (possibleChars.length === 0) return true;\n  const r = looksLikeObjectPathRegExpCache.getRegExp(`(${possibleChars.map(c => c === '?' ? '\\\\?' : c).join('|')})`);\n  let matched = !r.test(key);\n  if (!matched) {\n    const ki = key.indexOf(keySeparator);\n    if (ki > 0 && !r.test(key.substring(0, ki))) {\n      matched = true;\n    }\n  }\n  return matched;\n};\nconst deepFind = function (obj, path) {\n  let keySeparator = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : '.';\n  if (!obj) return undefined;\n  if (obj[path]) {\n    if (!Object.prototype.hasOwnProperty.call(obj, path)) return undefined;\n    return obj[path];\n  }\n  const tokens = path.split(keySeparator);\n  let current = obj;\n  for (let i = 0; i < tokens.length;) {\n    if (!current || typeof current !== 'object') {\n      return undefined;\n    }\n    let next;\n    let nextPath = '';\n    for (let j = i; j < tokens.length; ++j) {\n      if (j !== i) {\n        nextPath += keySeparator;\n      }\n      nextPath += tokens[j];\n      next = current[nextPath];\n      if (next !== undefined) {\n        if (['string', 'number', 'boolean'].indexOf(typeof next) > -1 && j < tokens.length - 1) {\n          continue;\n        }\n        i += j - i + 1;\n        break;\n      }\n    }\n    current = next;\n  }\n  return current;\n};\nconst getCleanedCode = code => code?.replace('_', '-');\n\nconst consoleLogger = {\n  type: 'logger',\n  log(args) {\n    this.output('log', args);\n  },\n  warn(args) {\n    this.output('warn', args);\n  },\n  error(args) {\n    this.output('error', args);\n  },\n  output(type, args) {\n    console?.[type]?.apply?.(console, args);\n  }\n};\nclass Logger {\n  constructor(concreteLogger) {\n    let options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n    this.init(concreteLogger, options);\n  }\n  init(concreteLogger) {\n    let options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n    this.prefix = options.prefix || 'i18next:';\n    this.logger = concreteLogger || consoleLogger;\n    this.options = options;\n    this.debug = options.debug;\n  }\n  log() {\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n    return this.forward(args, 'log', '', true);\n  }\n  warn() {\n    for (var _len2 = arguments.length, args = new Array(_len2), _key2 = 0; _key2 < _len2; _key2++) {\n      args[_key2] = arguments[_key2];\n    }\n    return this.forward(args, 'warn', '', true);\n  }\n  error() {\n    for (var _len3 = arguments.length, args = new Array(_len3), _key3 = 0; _key3 < _len3; _key3++) {\n      args[_key3] = arguments[_key3];\n    }\n    return this.forward(args, 'error', '');\n  }\n  deprecate() {\n    for (var _len4 = arguments.length, args = new Array(_len4), _key4 = 0; _key4 < _len4; _key4++) {\n      args[_key4] = arguments[_key4];\n    }\n    return this.forward(args, 'warn', 'WARNING DEPRECATED: ', true);\n  }\n  forward(args, lvl, prefix, debugOnly) {\n    if (debugOnly && !this.debug) return null;\n    if (isString(args[0])) args[0] = `${prefix}${this.prefix} ${args[0]}`;\n    return this.logger[lvl](args);\n  }\n  create(moduleName) {\n    return new Logger(this.logger, {\n      ...{\n        prefix: `${this.prefix}:${moduleName}:`\n      },\n      ...this.options\n    });\n  }\n  clone(options) {\n    options = options || this.options;\n    options.prefix = options.prefix || this.prefix;\n    return new Logger(this.logger, options);\n  }\n}\nvar baseLogger = new Logger();\n\nclass EventEmitter {\n  constructor() {\n    this.observers = {};\n  }\n  on(events, listener) {\n    events.split(' ').forEach(event => {\n      if (!this.observers[event]) this.observers[event] = new Map();\n      const numListeners = this.observers[event].get(listener) || 0;\n      this.observers[event].set(listener, numListeners + 1);\n    });\n    return this;\n  }\n  off(event, listener) {\n    if (!this.observers[event]) return;\n    if (!listener) {\n      delete this.observers[event];\n      return;\n    }\n    this.observers[event].delete(listener);\n  }\n  emit(event) {\n    for (var _len = arguments.length, args = new Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {\n      args[_key - 1] = arguments[_key];\n    }\n    if (this.observers[event]) {\n      const cloned = Array.from(this.observers[event].entries());\n      cloned.forEach(_ref => {\n        let [observer, numTimesAdded] = _ref;\n        for (let i = 0; i < numTimesAdded; i++) {\n          observer(...args);\n        }\n      });\n    }\n    if (this.observers['*']) {\n      const cloned = Array.from(this.observers['*'].entries());\n      cloned.forEach(_ref2 => {\n        let [observer, numTimesAdded] = _ref2;\n        for (let i = 0; i < numTimesAdded; i++) {\n          observer.apply(observer, [event, ...args]);\n        }\n      });\n    }\n  }\n}\n\nclass ResourceStore extends EventEmitter {\n  constructor(data) {\n    let options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {\n      ns: ['translation'],\n      defaultNS: 'translation'\n    };\n    super();\n    this.data = data || {};\n    this.options = options;\n    if (this.options.keySeparator === undefined) {\n      this.options.keySeparator = '.';\n    }\n    if (this.options.ignoreJSONStructure === undefined) {\n      this.options.ignoreJSONStructure = true;\n    }\n  }\n  addNamespaces(ns) {\n    if (this.options.ns.indexOf(ns) < 0) {\n      this.options.ns.push(ns);\n    }\n  }\n  removeNamespaces(ns) {\n    const index = this.options.ns.indexOf(ns);\n    if (index > -1) {\n      this.options.ns.splice(index, 1);\n    }\n  }\n  getResource(lng, ns, key) {\n    let options = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : {};\n    const keySeparator = options.keySeparator !== undefined ? options.keySeparator : this.options.keySeparator;\n    const ignoreJSONStructure = options.ignoreJSONStructure !== undefined ? options.ignoreJSONStructure : this.options.ignoreJSONStructure;\n    let path;\n    if (lng.indexOf('.') > -1) {\n      path = lng.split('.');\n    } else {\n      path = [lng, ns];\n      if (key) {\n        if (Array.isArray(key)) {\n          path.push(...key);\n        } else if (isString(key) && keySeparator) {\n          path.push(...key.split(keySeparator));\n        } else {\n          path.push(key);\n        }\n      }\n    }\n    const result = getPath(this.data, path);\n    if (!result && !ns && !key && lng.indexOf('.') > -1) {\n      lng = path[0];\n      ns = path[1];\n      key = path.slice(2).join('.');\n    }\n    if (result || !ignoreJSONStructure || !isString(key)) return result;\n    return deepFind(this.data?.[lng]?.[ns], key, keySeparator);\n  }\n  addResource(lng, ns, key, value) {\n    let options = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : {\n      silent: false\n    };\n    const keySeparator = options.keySeparator !== undefined ? options.keySeparator : this.options.keySeparator;\n    let path = [lng, ns];\n    if (key) path = path.concat(keySeparator ? key.split(keySeparator) : key);\n    if (lng.indexOf('.') > -1) {\n      path = lng.split('.');\n      value = ns;\n      ns = path[1];\n    }\n    this.addNamespaces(ns);\n    setPath(this.data, path, value);\n    if (!options.silent) this.emit('added', lng, ns, key, value);\n  }\n  addResources(lng, ns, resources) {\n    let options = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : {\n      silent: false\n    };\n    for (const m in resources) {\n      if (isString(resources[m]) || Array.isArray(resources[m])) this.addResource(lng, ns, m, resources[m], {\n        silent: true\n      });\n    }\n    if (!options.silent) this.emit('added', lng, ns, resources);\n  }\n  addResourceBundle(lng, ns, resources, deep, overwrite) {\n    let options = arguments.length > 5 && arguments[5] !== undefined ? arguments[5] : {\n      silent: false,\n      skipCopy: false\n    };\n    let path = [lng, ns];\n    if (lng.indexOf('.') > -1) {\n      path = lng.split('.');\n      deep = resources;\n      resources = ns;\n      ns = path[1];\n    }\n    this.addNamespaces(ns);\n    let pack = getPath(this.data, path) || {};\n    if (!options.skipCopy) resources = JSON.parse(JSON.stringify(resources));\n    if (deep) {\n      deepExtend(pack, resources, overwrite);\n    } else {\n      pack = {\n        ...pack,\n        ...resources\n      };\n    }\n    setPath(this.data, path, pack);\n    if (!options.silent) this.emit('added', lng, ns, resources);\n  }\n  removeResourceBundle(lng, ns) {\n    if (this.hasResourceBundle(lng, ns)) {\n      delete this.data[lng][ns];\n    }\n    this.removeNamespaces(ns);\n    this.emit('removed', lng, ns);\n  }\n  hasResourceBundle(lng, ns) {\n    return this.getResource(lng, ns) !== undefined;\n  }\n  getResourceBundle(lng, ns) {\n    if (!ns) ns = this.options.defaultNS;\n    return this.getResource(lng, ns);\n  }\n  getDataByLanguage(lng) {\n    return this.data[lng];\n  }\n  hasLanguageSomeTranslations(lng) {\n    const data = this.getDataByLanguage(lng);\n    const n = data && Object.keys(data) || [];\n    return !!n.find(v => data[v] && Object.keys(data[v]).length > 0);\n  }\n  toJSON() {\n    return this.data;\n  }\n}\n\nvar postProcessor = {\n  processors: {},\n  addPostProcessor(module) {\n    this.processors[module.name] = module;\n  },\n  handle(processors, value, key, options, translator) {\n    processors.forEach(processor => {\n      value = this.processors[processor]?.process(value, key, options, translator) ?? value;\n    });\n    return value;\n  }\n};\n\nconst checkedLoadedFor = {};\nconst shouldHandleAsObject = res => !isString(res) && typeof res !== 'boolean' && typeof res !== 'number';\nclass Translator extends EventEmitter {\n  constructor(services) {\n    let options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n    super();\n    copy(['resourceStore', 'languageUtils', 'pluralResolver', 'interpolator', 'backendConnector', 'i18nFormat', 'utils'], services, this);\n    this.options = options;\n    if (this.options.keySeparator === undefined) {\n      this.options.keySeparator = '.';\n    }\n    this.logger = baseLogger.create('translator');\n  }\n  changeLanguage(lng) {\n    if (lng) this.language = lng;\n  }\n  exists(key) {\n    let options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {\n      interpolation: {}\n    };\n    if (key == null) {\n      return false;\n    }\n    const resolved = this.resolve(key, options);\n    return resolved?.res !== undefined;\n  }\n  extractFromKey(key, options) {\n    let nsSeparator = options.nsSeparator !== undefined ? options.nsSeparator : this.options.nsSeparator;\n    if (nsSeparator === undefined) nsSeparator = ':';\n    const keySeparator = options.keySeparator !== undefined ? options.keySeparator : this.options.keySeparator;\n    let namespaces = options.ns || this.options.defaultNS || [];\n    const wouldCheckForNsInKey = nsSeparator && key.indexOf(nsSeparator) > -1;\n    const seemsNaturalLanguage = !this.options.userDefinedKeySeparator && !options.keySeparator && !this.options.userDefinedNsSeparator && !options.nsSeparator && !looksLikeObjectPath(key, nsSeparator, keySeparator);\n    if (wouldCheckForNsInKey && !seemsNaturalLanguage) {\n      const m = key.match(this.interpolator.nestingRegexp);\n      if (m && m.length > 0) {\n        return {\n          key,\n          namespaces: isString(namespaces) ? [namespaces] : namespaces\n        };\n      }\n      const parts = key.split(nsSeparator);\n      if (nsSeparator !== keySeparator || nsSeparator === keySeparator && this.options.ns.indexOf(parts[0]) > -1) namespaces = parts.shift();\n      key = parts.join(keySeparator);\n    }\n    return {\n      key,\n      namespaces: isString(namespaces) ? [namespaces] : namespaces\n    };\n  }\n  translate(keys, options, lastKey) {\n    if (typeof options !== 'object' && this.options.overloadTranslationOptionHandler) {\n      options = this.options.overloadTranslationOptionHandler(arguments);\n    }\n    if (typeof options === 'object') options = {\n      ...options\n    };\n    if (!options) options = {};\n    if (keys == null) return '';\n    if (!Array.isArray(keys)) keys = [String(keys)];\n    const returnDetails = options.returnDetails !== undefined ? options.returnDetails : this.options.returnDetails;\n    const keySeparator = options.keySeparator !== undefined ? options.keySeparator : this.options.keySeparator;\n    const {\n      key,\n      namespaces\n    } = this.extractFromKey(keys[keys.length - 1], options);\n    const namespace = namespaces[namespaces.length - 1];\n    const lng = options.lng || this.language;\n    const appendNamespaceToCIMode = options.appendNamespaceToCIMode || this.options.appendNamespaceToCIMode;\n    if (lng?.toLowerCase() === 'cimode') {\n      if (appendNamespaceToCIMode) {\n        const nsSeparator = options.nsSeparator || this.options.nsSeparator;\n        if (returnDetails) {\n          return {\n            res: `${namespace}${nsSeparator}${key}`,\n            usedKey: key,\n            exactUsedKey: key,\n            usedLng: lng,\n            usedNS: namespace,\n            usedParams: this.getUsedParamsDetails(options)\n          };\n        }\n        return `${namespace}${nsSeparator}${key}`;\n      }\n      if (returnDetails) {\n        return {\n          res: key,\n          usedKey: key,\n          exactUsedKey: key,\n          usedLng: lng,\n          usedNS: namespace,\n          usedParams: this.getUsedParamsDetails(options)\n        };\n      }\n      return key;\n    }\n    const resolved = this.resolve(keys, options);\n    let res = resolved?.res;\n    const resUsedKey = resolved?.usedKey || key;\n    const resExactUsedKey = resolved?.exactUsedKey || key;\n    const noObject = ['[object Number]', '[object Function]', '[object RegExp]'];\n    const joinArrays = options.joinArrays !== undefined ? options.joinArrays : this.options.joinArrays;\n    const handleAsObjectInI18nFormat = !this.i18nFormat || this.i18nFormat.handleAsObject;\n    const needsPluralHandling = options.count !== undefined && !isString(options.count);\n    const hasDefaultValue = Translator.hasDefaultValue(options);\n    const defaultValueSuffix = needsPluralHandling ? this.pluralResolver.getSuffix(lng, options.count, options) : '';\n    const defaultValueSuffixOrdinalFallback = options.ordinal && needsPluralHandling ? this.pluralResolver.getSuffix(lng, options.count, {\n      ordinal: false\n    }) : '';\n    const needsZeroSuffixLookup = needsPluralHandling && !options.ordinal && options.count === 0;\n    const defaultValue = needsZeroSuffixLookup && options[`defaultValue${this.options.pluralSeparator}zero`] || options[`defaultValue${defaultValueSuffix}`] || options[`defaultValue${defaultValueSuffixOrdinalFallback}`] || options.defaultValue;\n    let resForObjHndl = res;\n    if (handleAsObjectInI18nFormat && !res && hasDefaultValue) {\n      resForObjHndl = defaultValue;\n    }\n    const handleAsObject = shouldHandleAsObject(resForObjHndl);\n    const resType = Object.prototype.toString.apply(resForObjHndl);\n    if (handleAsObjectInI18nFormat && resForObjHndl && handleAsObject && noObject.indexOf(resType) < 0 && !(isString(joinArrays) && Array.isArray(resForObjHndl))) {\n      if (!options.returnObjects && !this.options.returnObjects) {\n        if (!this.options.returnedObjectHandler) {\n          this.logger.warn('accessing an object - but returnObjects options is not enabled!');\n        }\n        const r = this.options.returnedObjectHandler ? this.options.returnedObjectHandler(resUsedKey, resForObjHndl, {\n          ...options,\n          ns: namespaces\n        }) : `key '${key} (${this.language})' returned an object instead of string.`;\n        if (returnDetails) {\n          resolved.res = r;\n          resolved.usedParams = this.getUsedParamsDetails(options);\n          return resolved;\n        }\n        return r;\n      }\n      if (keySeparator) {\n        const resTypeIsArray = Array.isArray(resForObjHndl);\n        const copy = resTypeIsArray ? [] : {};\n        const newKeyToUse = resTypeIsArray ? resExactUsedKey : resUsedKey;\n        for (const m in resForObjHndl) {\n          if (Object.prototype.hasOwnProperty.call(resForObjHndl, m)) {\n            const deepKey = `${newKeyToUse}${keySeparator}${m}`;\n            if (hasDefaultValue && !res) {\n              copy[m] = this.translate(deepKey, {\n                ...options,\n                defaultValue: shouldHandleAsObject(defaultValue) ? defaultValue[m] : undefined,\n                ...{\n                  joinArrays: false,\n                  ns: namespaces\n                }\n              });\n            } else {\n              copy[m] = this.translate(deepKey, {\n                ...options,\n                ...{\n                  joinArrays: false,\n                  ns: namespaces\n                }\n              });\n            }\n            if (copy[m] === deepKey) copy[m] = resForObjHndl[m];\n          }\n        }\n        res = copy;\n      }\n    } else if (handleAsObjectInI18nFormat && isString(joinArrays) && Array.isArray(res)) {\n      res = res.join(joinArrays);\n      if (res) res = this.extendTranslation(res, keys, options, lastKey);\n    } else {\n      let usedDefault = false;\n      let usedKey = false;\n      if (!this.isValidLookup(res) && hasDefaultValue) {\n        usedDefault = true;\n        res = defaultValue;\n      }\n      if (!this.isValidLookup(res)) {\n        usedKey = true;\n        res = key;\n      }\n      const missingKeyNoValueFallbackToKey = options.missingKeyNoValueFallbackToKey || this.options.missingKeyNoValueFallbackToKey;\n      const resForMissing = missingKeyNoValueFallbackToKey && usedKey ? undefined : res;\n      const updateMissing = hasDefaultValue && defaultValue !== res && this.options.updateMissing;\n      if (usedKey || usedDefault || updateMissing) {\n        this.logger.log(updateMissing ? 'updateKey' : 'missingKey', lng, namespace, key, updateMissing ? defaultValue : res);\n        if (keySeparator) {\n          const fk = this.resolve(key, {\n            ...options,\n            keySeparator: false\n          });\n          if (fk && fk.res) this.logger.warn('Seems the loaded translations were in flat JSON format instead of nested. Either set keySeparator: false on init or make sure your translations are published in nested format.');\n        }\n        let lngs = [];\n        const fallbackLngs = this.languageUtils.getFallbackCodes(this.options.fallbackLng, options.lng || this.language);\n        if (this.options.saveMissingTo === 'fallback' && fallbackLngs && fallbackLngs[0]) {\n          for (let i = 0; i < fallbackLngs.length; i++) {\n            lngs.push(fallbackLngs[i]);\n          }\n        } else if (this.options.saveMissingTo === 'all') {\n          lngs = this.languageUtils.toResolveHierarchy(options.lng || this.language);\n        } else {\n          lngs.push(options.lng || this.language);\n        }\n        const send = (l, k, specificDefaultValue) => {\n          const defaultForMissing = hasDefaultValue && specificDefaultValue !== res ? specificDefaultValue : resForMissing;\n          if (this.options.missingKeyHandler) {\n            this.options.missingKeyHandler(l, namespace, k, defaultForMissing, updateMissing, options);\n          } else if (this.backendConnector?.saveMissing) {\n            this.backendConnector.saveMissing(l, namespace, k, defaultForMissing, updateMissing, options);\n          }\n          this.emit('missingKey', l, namespace, k, res);\n        };\n        if (this.options.saveMissing) {\n          if (this.options.saveMissingPlurals && needsPluralHandling) {\n            lngs.forEach(language => {\n              const suffixes = this.pluralResolver.getSuffixes(language, options);\n              if (needsZeroSuffixLookup && options[`defaultValue${this.options.pluralSeparator}zero`] && suffixes.indexOf(`${this.options.pluralSeparator}zero`) < 0) {\n                suffixes.push(`${this.options.pluralSeparator}zero`);\n              }\n              suffixes.forEach(suffix => {\n                send([language], key + suffix, options[`defaultValue${suffix}`] || defaultValue);\n              });\n            });\n          } else {\n            send(lngs, key, defaultValue);\n          }\n        }\n      }\n      res = this.extendTranslation(res, keys, options, resolved, lastKey);\n      if (usedKey && res === key && this.options.appendNamespaceToMissingKey) res = `${namespace}:${key}`;\n      if ((usedKey || usedDefault) && this.options.parseMissingKeyHandler) {\n        res = this.options.parseMissingKeyHandler(this.options.appendNamespaceToMissingKey ? `${namespace}:${key}` : key, usedDefault ? res : undefined);\n      }\n    }\n    if (returnDetails) {\n      resolved.res = res;\n      resolved.usedParams = this.getUsedParamsDetails(options);\n      return resolved;\n    }\n    return res;\n  }\n  extendTranslation(res, key, options, resolved, lastKey) {\n    var _this = this;\n    if (this.i18nFormat?.parse) {\n      res = this.i18nFormat.parse(res, {\n        ...this.options.interpolation.defaultVariables,\n        ...options\n      }, options.lng || this.language || resolved.usedLng, resolved.usedNS, resolved.usedKey, {\n        resolved\n      });\n    } else if (!options.skipInterpolation) {\n      if (options.interpolation) this.interpolator.init({\n        ...options,\n        ...{\n          interpolation: {\n            ...this.options.interpolation,\n            ...options.interpolation\n          }\n        }\n      });\n      const skipOnVariables = isString(res) && (options?.interpolation?.skipOnVariables !== undefined ? options.interpolation.skipOnVariables : this.options.interpolation.skipOnVariables);\n      let nestBef;\n      if (skipOnVariables) {\n        const nb = res.match(this.interpolator.nestingRegexp);\n        nestBef = nb && nb.length;\n      }\n      let data = options.replace && !isString(options.replace) ? options.replace : options;\n      if (this.options.interpolation.defaultVariables) data = {\n        ...this.options.interpolation.defaultVariables,\n        ...data\n      };\n      res = this.interpolator.interpolate(res, data, options.lng || this.language || resolved.usedLng, options);\n      if (skipOnVariables) {\n        const na = res.match(this.interpolator.nestingRegexp);\n        const nestAft = na && na.length;\n        if (nestBef < nestAft) options.nest = false;\n      }\n      if (!options.lng && resolved && resolved.res) options.lng = this.language || resolved.usedLng;\n      if (options.nest !== false) res = this.interpolator.nest(res, function () {\n        for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n          args[_key] = arguments[_key];\n        }\n        if (lastKey?.[0] === args[0] && !options.context) {\n          _this.logger.warn(`It seems you are nesting recursively key: ${args[0]} in key: ${key[0]}`);\n          return null;\n        }\n        return _this.translate(...args, key);\n      }, options);\n      if (options.interpolation) this.interpolator.reset();\n    }\n    const postProcess = options.postProcess || this.options.postProcess;\n    const postProcessorNames = isString(postProcess) ? [postProcess] : postProcess;\n    if (res != null && postProcessorNames?.length && options.applyPostProcessor !== false) {\n      res = postProcessor.handle(postProcessorNames, res, key, this.options && this.options.postProcessPassResolved ? {\n        i18nResolved: {\n          ...resolved,\n          usedParams: this.getUsedParamsDetails(options)\n        },\n        ...options\n      } : options, this);\n    }\n    return res;\n  }\n  resolve(keys) {\n    let options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n    let found;\n    let usedKey;\n    let exactUsedKey;\n    let usedLng;\n    let usedNS;\n    if (isString(keys)) keys = [keys];\n    keys.forEach(k => {\n      if (this.isValidLookup(found)) return;\n      const extracted = this.extractFromKey(k, options);\n      const key = extracted.key;\n      usedKey = key;\n      let namespaces = extracted.namespaces;\n      if (this.options.fallbackNS) namespaces = namespaces.concat(this.options.fallbackNS);\n      const needsPluralHandling = options.count !== undefined && !isString(options.count);\n      const needsZeroSuffixLookup = needsPluralHandling && !options.ordinal && options.count === 0;\n      const needsContextHandling = options.context !== undefined && (isString(options.context) || typeof options.context === 'number') && options.context !== '';\n      const codes = options.lngs ? options.lngs : this.languageUtils.toResolveHierarchy(options.lng || this.language, options.fallbackLng);\n      namespaces.forEach(ns => {\n        if (this.isValidLookup(found)) return;\n        usedNS = ns;\n        if (!checkedLoadedFor[`${codes[0]}-${ns}`] && this.utils?.hasLoadedNamespace && !this.utils?.hasLoadedNamespace(usedNS)) {\n          checkedLoadedFor[`${codes[0]}-${ns}`] = true;\n          this.logger.warn(`key \"${usedKey}\" for languages \"${codes.join(', ')}\" won't get resolved as namespace \"${usedNS}\" was not yet loaded`, 'This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!');\n        }\n        codes.forEach(code => {\n          if (this.isValidLookup(found)) return;\n          usedLng = code;\n          const finalKeys = [key];\n          if (this.i18nFormat?.addLookupKeys) {\n            this.i18nFormat.addLookupKeys(finalKeys, key, code, ns, options);\n          } else {\n            let pluralSuffix;\n            if (needsPluralHandling) pluralSuffix = this.pluralResolver.getSuffix(code, options.count, options);\n            const zeroSuffix = `${this.options.pluralSeparator}zero`;\n            const ordinalPrefix = `${this.options.pluralSeparator}ordinal${this.options.pluralSeparator}`;\n            if (needsPluralHandling) {\n              finalKeys.push(key + pluralSuffix);\n              if (options.ordinal && pluralSuffix.indexOf(ordinalPrefix) === 0) {\n                finalKeys.push(key + pluralSuffix.replace(ordinalPrefix, this.options.pluralSeparator));\n              }\n              if (needsZeroSuffixLookup) {\n                finalKeys.push(key + zeroSuffix);\n              }\n            }\n            if (needsContextHandling) {\n              const contextKey = `${key}${this.options.contextSeparator}${options.context}`;\n              finalKeys.push(contextKey);\n              if (needsPluralHandling) {\n                finalKeys.push(contextKey + pluralSuffix);\n                if (options.ordinal && pluralSuffix.indexOf(ordinalPrefix) === 0) {\n                  finalKeys.push(contextKey + pluralSuffix.replace(ordinalPrefix, this.options.pluralSeparator));\n                }\n                if (needsZeroSuffixLookup) {\n                  finalKeys.push(contextKey + zeroSuffix);\n                }\n              }\n            }\n          }\n          let possibleKey;\n          while (possibleKey = finalKeys.pop()) {\n            if (!this.isValidLookup(found)) {\n              exactUsedKey = possibleKey;\n              found = this.getResource(code, ns, possibleKey, options);\n            }\n          }\n        });\n      });\n    });\n    return {\n      res: found,\n      usedKey,\n      exactUsedKey,\n      usedLng,\n      usedNS\n    };\n  }\n  isValidLookup(res) {\n    return res !== undefined && !(!this.options.returnNull && res === null) && !(!this.options.returnEmptyString && res === '');\n  }\n  getResource(code, ns, key) {\n    let options = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : {};\n    if (this.i18nFormat?.getResource) return this.i18nFormat.getResource(code, ns, key, options);\n    return this.resourceStore.getResource(code, ns, key, options);\n  }\n  getUsedParamsDetails() {\n    let options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n    const optionsKeys = ['defaultValue', 'ordinal', 'context', 'replace', 'lng', 'lngs', 'fallbackLng', 'ns', 'keySeparator', 'nsSeparator', 'returnObjects', 'returnDetails', 'joinArrays', 'postProcess', 'interpolation'];\n    const useOptionsReplaceForData = options.replace && !isString(options.replace);\n    let data = useOptionsReplaceForData ? options.replace : options;\n    if (useOptionsReplaceForData && typeof options.count !== 'undefined') {\n      data.count = options.count;\n    }\n    if (this.options.interpolation.defaultVariables) {\n      data = {\n        ...this.options.interpolation.defaultVariables,\n        ...data\n      };\n    }\n    if (!useOptionsReplaceForData) {\n      data = {\n        ...data\n      };\n      for (const key of optionsKeys) {\n        delete data[key];\n      }\n    }\n    return data;\n  }\n  static hasDefaultValue(options) {\n    const prefix = 'defaultValue';\n    for (const option in options) {\n      if (Object.prototype.hasOwnProperty.call(options, option) && prefix === option.substring(0, prefix.length) && undefined !== options[option]) {\n        return true;\n      }\n    }\n    return false;\n  }\n}\n\nclass LanguageUtil {\n  constructor(options) {\n    this.options = options;\n    this.supportedLngs = this.options.supportedLngs || false;\n    this.logger = baseLogger.create('languageUtils');\n  }\n  getScriptPartFromCode(code) {\n    code = getCleanedCode(code);\n    if (!code || code.indexOf('-') < 0) return null;\n    const p = code.split('-');\n    if (p.length === 2) return null;\n    p.pop();\n    if (p[p.length - 1].toLowerCase() === 'x') return null;\n    return this.formatLanguageCode(p.join('-'));\n  }\n  getLanguagePartFromCode(code) {\n    code = getCleanedCode(code);\n    if (!code || code.indexOf('-') < 0) return code;\n    const p = code.split('-');\n    return this.formatLanguageCode(p[0]);\n  }\n  formatLanguageCode(code) {\n    if (isString(code) && code.indexOf('-') > -1) {\n      let formattedCode;\n      try {\n        formattedCode = Intl.getCanonicalLocales(code)[0];\n      } catch (e) {}\n      if (formattedCode && this.options.lowerCaseLng) {\n        formattedCode = formattedCode.toLowerCase();\n      }\n      if (formattedCode) return formattedCode;\n      if (this.options.lowerCaseLng) {\n        return code.toLowerCase();\n      }\n      return code;\n    }\n    return this.options.cleanCode || this.options.lowerCaseLng ? code.toLowerCase() : code;\n  }\n  isSupportedCode(code) {\n    if (this.options.load === 'languageOnly' || this.options.nonExplicitSupportedLngs) {\n      code = this.getLanguagePartFromCode(code);\n    }\n    return !this.supportedLngs || !this.supportedLngs.length || this.supportedLngs.indexOf(code) > -1;\n  }\n  getBestMatchFromCodes(codes) {\n    if (!codes) return null;\n    let found;\n    codes.forEach(code => {\n      if (found) return;\n      const cleanedLng = this.formatLanguageCode(code);\n      if (!this.options.supportedLngs || this.isSupportedCode(cleanedLng)) found = cleanedLng;\n    });\n    if (!found && this.options.supportedLngs) {\n      codes.forEach(code => {\n        if (found) return;\n        const lngOnly = this.getLanguagePartFromCode(code);\n        if (this.isSupportedCode(lngOnly)) return found = lngOnly;\n        found = this.options.supportedLngs.find(supportedLng => {\n          if (supportedLng === lngOnly) return supportedLng;\n          if (supportedLng.indexOf('-') < 0 && lngOnly.indexOf('-') < 0) return;\n          if (supportedLng.indexOf('-') > 0 && lngOnly.indexOf('-') < 0 && supportedLng.substring(0, supportedLng.indexOf('-')) === lngOnly) return supportedLng;\n          if (supportedLng.indexOf(lngOnly) === 0 && lngOnly.length > 1) return supportedLng;\n        });\n      });\n    }\n    if (!found) found = this.getFallbackCodes(this.options.fallbackLng)[0];\n    return found;\n  }\n  getFallbackCodes(fallbacks, code) {\n    if (!fallbacks) return [];\n    if (typeof fallbacks === 'function') fallbacks = fallbacks(code);\n    if (isString(fallbacks)) fallbacks = [fallbacks];\n    if (Array.isArray(fallbacks)) return fallbacks;\n    if (!code) return fallbacks.default || [];\n    let found = fallbacks[code];\n    if (!found) found = fallbacks[this.getScriptPartFromCode(code)];\n    if (!found) found = fallbacks[this.formatLanguageCode(code)];\n    if (!found) found = fallbacks[this.getLanguagePartFromCode(code)];\n    if (!found) found = fallbacks.default;\n    return found || [];\n  }\n  toResolveHierarchy(code, fallbackCode) {\n    const fallbackCodes = this.getFallbackCodes(fallbackCode || this.options.fallbackLng || [], code);\n    const codes = [];\n    const addCode = c => {\n      if (!c) return;\n      if (this.isSupportedCode(c)) {\n        codes.push(c);\n      } else {\n        this.logger.warn(`rejecting language code not found in supportedLngs: ${c}`);\n      }\n    };\n    if (isString(code) && (code.indexOf('-') > -1 || code.indexOf('_') > -1)) {\n      if (this.options.load !== 'languageOnly') addCode(this.formatLanguageCode(code));\n      if (this.options.load !== 'languageOnly' && this.options.load !== 'currentOnly') addCode(this.getScriptPartFromCode(code));\n      if (this.options.load !== 'currentOnly') addCode(this.getLanguagePartFromCode(code));\n    } else if (isString(code)) {\n      addCode(this.formatLanguageCode(code));\n    }\n    fallbackCodes.forEach(fc => {\n      if (codes.indexOf(fc) < 0) addCode(this.formatLanguageCode(fc));\n    });\n    return codes;\n  }\n}\n\nconst suffixesOrder = {\n  zero: 0,\n  one: 1,\n  two: 2,\n  few: 3,\n  many: 4,\n  other: 5\n};\nconst dummyRule = {\n  select: count => count === 1 ? 'one' : 'other',\n  resolvedOptions: () => ({\n    pluralCategories: ['one', 'other']\n  })\n};\nclass PluralResolver {\n  constructor(languageUtils) {\n    let options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n    this.languageUtils = languageUtils;\n    this.options = options;\n    this.logger = baseLogger.create('pluralResolver');\n    this.pluralRulesCache = {};\n  }\n  addRule(lng, obj) {\n    this.rules[lng] = obj;\n  }\n  clearCache() {\n    this.pluralRulesCache = {};\n  }\n  getRule(code) {\n    let options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n    const cleanedCode = getCleanedCode(code === 'dev' ? 'en' : code);\n    const type = options.ordinal ? 'ordinal' : 'cardinal';\n    const cacheKey = JSON.stringify({\n      cleanedCode,\n      type\n    });\n    if (cacheKey in this.pluralRulesCache) {\n      return this.pluralRulesCache[cacheKey];\n    }\n    let rule;\n    try {\n      rule = new Intl.PluralRules(cleanedCode, {\n        type\n      });\n    } catch (err) {\n      if (!Intl) {\n        this.logger.error('No Intl support, please use an Intl polyfill!');\n        return dummyRule;\n      }\n      if (!code.match(/-|_/)) return dummyRule;\n      const lngPart = this.languageUtils.getLanguagePartFromCode(code);\n      rule = this.getRule(lngPart, options);\n    }\n    this.pluralRulesCache[cacheKey] = rule;\n    return rule;\n  }\n  needsPlural(code) {\n    let options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n    let rule = this.getRule(code, options);\n    if (!rule) rule = this.getRule('dev', options);\n    return rule?.resolvedOptions().pluralCategories.length > 1;\n  }\n  getPluralFormsOfKey(code, key) {\n    let options = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n    return this.getSuffixes(code, options).map(suffix => `${key}${suffix}`);\n  }\n  getSuffixes(code) {\n    let options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n    let rule = this.getRule(code, options);\n    if (!rule) rule = this.getRule('dev', options);\n    if (!rule) return [];\n    return rule.resolvedOptions().pluralCategories.sort((pluralCategory1, pluralCategory2) => suffixesOrder[pluralCategory1] - suffixesOrder[pluralCategory2]).map(pluralCategory => `${this.options.prepend}${options.ordinal ? `ordinal${this.options.prepend}` : ''}${pluralCategory}`);\n  }\n  getSuffix(code, count) {\n    let options = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n    const rule = this.getRule(code, options);\n    if (rule) {\n      return `${this.options.prepend}${options.ordinal ? `ordinal${this.options.prepend}` : ''}${rule.select(count)}`;\n    }\n    this.logger.warn(`no plural rule found for: ${code}`);\n    return this.getSuffix('dev', count, options);\n  }\n}\n\nconst deepFindWithDefaults = function (data, defaultData, key) {\n  let keySeparator = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : '.';\n  let ignoreJSONStructure = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : true;\n  let path = getPathWithDefaults(data, defaultData, key);\n  if (!path && ignoreJSONStructure && isString(key)) {\n    path = deepFind(data, key, keySeparator);\n    if (path === undefined) path = deepFind(defaultData, key, keySeparator);\n  }\n  return path;\n};\nconst regexSafe = val => val.replace(/\\$/g, '$$$$');\nclass Interpolator {\n  constructor() {\n    let options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n    this.logger = baseLogger.create('interpolator');\n    this.options = options;\n    this.format = options?.interpolation?.format || (value => value);\n    this.init(options);\n  }\n  init() {\n    let options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n    if (!options.interpolation) options.interpolation = {\n      escapeValue: true\n    };\n    const {\n      escape: escape$1,\n      escapeValue,\n      useRawValueToEscape,\n      prefix,\n      prefixEscaped,\n      suffix,\n      suffixEscaped,\n      formatSeparator,\n      unescapeSuffix,\n      unescapePrefix,\n      nestingPrefix,\n      nestingPrefixEscaped,\n      nestingSuffix,\n      nestingSuffixEscaped,\n      nestingOptionsSeparator,\n      maxReplaces,\n      alwaysFormat\n    } = options.interpolation;\n    this.escape = escape$1 !== undefined ? escape$1 : escape;\n    this.escapeValue = escapeValue !== undefined ? escapeValue : true;\n    this.useRawValueToEscape = useRawValueToEscape !== undefined ? useRawValueToEscape : false;\n    this.prefix = prefix ? regexEscape(prefix) : prefixEscaped || '{{';\n    this.suffix = suffix ? regexEscape(suffix) : suffixEscaped || '}}';\n    this.formatSeparator = formatSeparator || ',';\n    this.unescapePrefix = unescapeSuffix ? '' : unescapePrefix || '-';\n    this.unescapeSuffix = this.unescapePrefix ? '' : unescapeSuffix || '';\n    this.nestingPrefix = nestingPrefix ? regexEscape(nestingPrefix) : nestingPrefixEscaped || regexEscape('$t(');\n    this.nestingSuffix = nestingSuffix ? regexEscape(nestingSuffix) : nestingSuffixEscaped || regexEscape(')');\n    this.nestingOptionsSeparator = nestingOptionsSeparator || ',';\n    this.maxReplaces = maxReplaces || 1000;\n    this.alwaysFormat = alwaysFormat !== undefined ? alwaysFormat : false;\n    this.resetRegExp();\n  }\n  reset() {\n    if (this.options) this.init(this.options);\n  }\n  resetRegExp() {\n    const getOrResetRegExp = (existingRegExp, pattern) => {\n      if (existingRegExp?.source === pattern) {\n        existingRegExp.lastIndex = 0;\n        return existingRegExp;\n      }\n      return new RegExp(pattern, 'g');\n    };\n    this.regexp = getOrResetRegExp(this.regexp, `${this.prefix}(.+?)${this.suffix}`);\n    this.regexpUnescape = getOrResetRegExp(this.regexpUnescape, `${this.prefix}${this.unescapePrefix}(.+?)${this.unescapeSuffix}${this.suffix}`);\n    this.nestingRegexp = getOrResetRegExp(this.nestingRegexp, `${this.nestingPrefix}(.+?)${this.nestingSuffix}`);\n  }\n  interpolate(str, data, lng, options) {\n    let match;\n    let value;\n    let replaces;\n    const defaultData = this.options && this.options.interpolation && this.options.interpolation.defaultVariables || {};\n    const handleFormat = key => {\n      if (key.indexOf(this.formatSeparator) < 0) {\n        const path = deepFindWithDefaults(data, defaultData, key, this.options.keySeparator, this.options.ignoreJSONStructure);\n        return this.alwaysFormat ? this.format(path, undefined, lng, {\n          ...options,\n          ...data,\n          interpolationkey: key\n        }) : path;\n      }\n      const p = key.split(this.formatSeparator);\n      const k = p.shift().trim();\n      const f = p.join(this.formatSeparator).trim();\n      return this.format(deepFindWithDefaults(data, defaultData, k, this.options.keySeparator, this.options.ignoreJSONStructure), f, lng, {\n        ...options,\n        ...data,\n        interpolationkey: k\n      });\n    };\n    this.resetRegExp();\n    const missingInterpolationHandler = options?.missingInterpolationHandler || this.options.missingInterpolationHandler;\n    const skipOnVariables = options?.interpolation?.skipOnVariables !== undefined ? options.interpolation.skipOnVariables : this.options.interpolation.skipOnVariables;\n    const todos = [{\n      regex: this.regexpUnescape,\n      safeValue: val => regexSafe(val)\n    }, {\n      regex: this.regexp,\n      safeValue: val => this.escapeValue ? regexSafe(this.escape(val)) : regexSafe(val)\n    }];\n    todos.forEach(todo => {\n      replaces = 0;\n      while (match = todo.regex.exec(str)) {\n        const matchedVar = match[1].trim();\n        value = handleFormat(matchedVar);\n        if (value === undefined) {\n          if (typeof missingInterpolationHandler === 'function') {\n            const temp = missingInterpolationHandler(str, match, options);\n            value = isString(temp) ? temp : '';\n          } else if (options && Object.prototype.hasOwnProperty.call(options, matchedVar)) {\n            value = '';\n          } else if (skipOnVariables) {\n            value = match[0];\n            continue;\n          } else {\n            this.logger.warn(`missed to pass in variable ${matchedVar} for interpolating ${str}`);\n            value = '';\n          }\n        } else if (!isString(value) && !this.useRawValueToEscape) {\n          value = makeString(value);\n        }\n        const safeValue = todo.safeValue(value);\n        str = str.replace(match[0], safeValue);\n        if (skipOnVariables) {\n          todo.regex.lastIndex += value.length;\n          todo.regex.lastIndex -= match[0].length;\n        } else {\n          todo.regex.lastIndex = 0;\n        }\n        replaces++;\n        if (replaces >= this.maxReplaces) {\n          break;\n        }\n      }\n    });\n    return str;\n  }\n  nest(str, fc) {\n    let options = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n    let match;\n    let value;\n    let clonedOptions;\n    const handleHasOptions = (key, inheritedOptions) => {\n      const sep = this.nestingOptionsSeparator;\n      if (key.indexOf(sep) < 0) return key;\n      const c = key.split(new RegExp(`${sep}[ ]*{`));\n      let optionsString = `{${c[1]}`;\n      key = c[0];\n      optionsString = this.interpolate(optionsString, clonedOptions);\n      const matchedSingleQuotes = optionsString.match(/'/g);\n      const matchedDoubleQuotes = optionsString.match(/\"/g);\n      if ((matchedSingleQuotes?.length ?? 0) % 2 === 0 && !matchedDoubleQuotes || matchedDoubleQuotes.length % 2 !== 0) {\n        optionsString = optionsString.replace(/'/g, '\"');\n      }\n      try {\n        clonedOptions = JSON.parse(optionsString);\n        if (inheritedOptions) clonedOptions = {\n          ...inheritedOptions,\n          ...clonedOptions\n        };\n      } catch (e) {\n        this.logger.warn(`failed parsing options string in nesting for key ${key}`, e);\n        return `${key}${sep}${optionsString}`;\n      }\n      if (clonedOptions.defaultValue && clonedOptions.defaultValue.indexOf(this.prefix) > -1) delete clonedOptions.defaultValue;\n      return key;\n    };\n    while (match = this.nestingRegexp.exec(str)) {\n      let formatters = [];\n      clonedOptions = {\n        ...options\n      };\n      clonedOptions = clonedOptions.replace && !isString(clonedOptions.replace) ? clonedOptions.replace : clonedOptions;\n      clonedOptions.applyPostProcessor = false;\n      delete clonedOptions.defaultValue;\n      let doReduce = false;\n      if (match[0].indexOf(this.formatSeparator) !== -1 && !/{.*}/.test(match[1])) {\n        const r = match[1].split(this.formatSeparator).map(elem => elem.trim());\n        match[1] = r.shift();\n        formatters = r;\n        doReduce = true;\n      }\n      value = fc(handleHasOptions.call(this, match[1].trim(), clonedOptions), clonedOptions);\n      if (value && match[0] === str && !isString(value)) return value;\n      if (!isString(value)) value = makeString(value);\n      if (!value) {\n        this.logger.warn(`missed to resolve ${match[1]} for nesting ${str}`);\n        value = '';\n      }\n      if (doReduce) {\n        value = formatters.reduce((v, f) => this.format(v, f, options.lng, {\n          ...options,\n          interpolationkey: match[1].trim()\n        }), value.trim());\n      }\n      str = str.replace(match[0], value);\n      this.regexp.lastIndex = 0;\n    }\n    return str;\n  }\n}\n\nconst parseFormatStr = formatStr => {\n  let formatName = formatStr.toLowerCase().trim();\n  const formatOptions = {};\n  if (formatStr.indexOf('(') > -1) {\n    const p = formatStr.split('(');\n    formatName = p[0].toLowerCase().trim();\n    const optStr = p[1].substring(0, p[1].length - 1);\n    if (formatName === 'currency' && optStr.indexOf(':') < 0) {\n      if (!formatOptions.currency) formatOptions.currency = optStr.trim();\n    } else if (formatName === 'relativetime' && optStr.indexOf(':') < 0) {\n      if (!formatOptions.range) formatOptions.range = optStr.trim();\n    } else {\n      const opts = optStr.split(';');\n      opts.forEach(opt => {\n        if (opt) {\n          const [key, ...rest] = opt.split(':');\n          const val = rest.join(':').trim().replace(/^'+|'+$/g, '');\n          const trimmedKey = key.trim();\n          if (!formatOptions[trimmedKey]) formatOptions[trimmedKey] = val;\n          if (val === 'false') formatOptions[trimmedKey] = false;\n          if (val === 'true') formatOptions[trimmedKey] = true;\n          if (!isNaN(val)) formatOptions[trimmedKey] = parseInt(val, 10);\n        }\n      });\n    }\n  }\n  return {\n    formatName,\n    formatOptions\n  };\n};\nconst createCachedFormatter = fn => {\n  const cache = {};\n  return (val, lng, options) => {\n    let optForCache = options;\n    if (options && options.interpolationkey && options.formatParams && options.formatParams[options.interpolationkey] && options[options.interpolationkey]) {\n      optForCache = {\n        ...optForCache,\n        [options.interpolationkey]: undefined\n      };\n    }\n    const key = lng + JSON.stringify(optForCache);\n    let formatter = cache[key];\n    if (!formatter) {\n      formatter = fn(getCleanedCode(lng), options);\n      cache[key] = formatter;\n    }\n    return formatter(val);\n  };\n};\nclass Formatter {\n  constructor() {\n    let options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n    this.logger = baseLogger.create('formatter');\n    this.options = options;\n    this.formats = {\n      number: createCachedFormatter((lng, opt) => {\n        const formatter = new Intl.NumberFormat(lng, {\n          ...opt\n        });\n        return val => formatter.format(val);\n      }),\n      currency: createCachedFormatter((lng, opt) => {\n        const formatter = new Intl.NumberFormat(lng, {\n          ...opt,\n          style: 'currency'\n        });\n        return val => formatter.format(val);\n      }),\n      datetime: createCachedFormatter((lng, opt) => {\n        const formatter = new Intl.DateTimeFormat(lng, {\n          ...opt\n        });\n        return val => formatter.format(val);\n      }),\n      relativetime: createCachedFormatter((lng, opt) => {\n        const formatter = new Intl.RelativeTimeFormat(lng, {\n          ...opt\n        });\n        return val => formatter.format(val, opt.range || 'day');\n      }),\n      list: createCachedFormatter((lng, opt) => {\n        const formatter = new Intl.ListFormat(lng, {\n          ...opt\n        });\n        return val => formatter.format(val);\n      })\n    };\n    this.init(options);\n  }\n  init(services) {\n    let options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {\n      interpolation: {}\n    };\n    this.formatSeparator = options.interpolation.formatSeparator || ',';\n  }\n  add(name, fc) {\n    this.formats[name.toLowerCase().trim()] = fc;\n  }\n  addCached(name, fc) {\n    this.formats[name.toLowerCase().trim()] = createCachedFormatter(fc);\n  }\n  format(value, format, lng) {\n    let options = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : {};\n    const formats = format.split(this.formatSeparator);\n    if (formats.length > 1 && formats[0].indexOf('(') > 1 && formats[0].indexOf(')') < 0 && formats.find(f => f.indexOf(')') > -1)) {\n      const lastIndex = formats.findIndex(f => f.indexOf(')') > -1);\n      formats[0] = [formats[0], ...formats.splice(1, lastIndex)].join(this.formatSeparator);\n    }\n    const result = formats.reduce((mem, f) => {\n      const {\n        formatName,\n        formatOptions\n      } = parseFormatStr(f);\n      if (this.formats[formatName]) {\n        let formatted = mem;\n        try {\n          const valOptions = options?.formatParams?.[options.interpolationkey] || {};\n          const l = valOptions.locale || valOptions.lng || options.locale || options.lng || lng;\n          formatted = this.formats[formatName](mem, l, {\n            ...formatOptions,\n            ...options,\n            ...valOptions\n          });\n        } catch (error) {\n          this.logger.warn(error);\n        }\n        return formatted;\n      } else {\n        this.logger.warn(`there was no format function for ${formatName}`);\n      }\n      return mem;\n    }, value);\n    return result;\n  }\n}\n\nconst removePending = (q, name) => {\n  if (q.pending[name] !== undefined) {\n    delete q.pending[name];\n    q.pendingCount--;\n  }\n};\nclass Connector extends EventEmitter {\n  constructor(backend, store, services) {\n    let options = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : {};\n    super();\n    this.backend = backend;\n    this.store = store;\n    this.services = services;\n    this.languageUtils = services.languageUtils;\n    this.options = options;\n    this.logger = baseLogger.create('backendConnector');\n    this.waitingReads = [];\n    this.maxParallelReads = options.maxParallelReads || 10;\n    this.readingCalls = 0;\n    this.maxRetries = options.maxRetries >= 0 ? options.maxRetries : 5;\n    this.retryTimeout = options.retryTimeout >= 1 ? options.retryTimeout : 350;\n    this.state = {};\n    this.queue = [];\n    this.backend?.init?.(services, options.backend, options);\n  }\n  queueLoad(languages, namespaces, options, callback) {\n    const toLoad = {};\n    const pending = {};\n    const toLoadLanguages = {};\n    const toLoadNamespaces = {};\n    languages.forEach(lng => {\n      let hasAllNamespaces = true;\n      namespaces.forEach(ns => {\n        const name = `${lng}|${ns}`;\n        if (!options.reload && this.store.hasResourceBundle(lng, ns)) {\n          this.state[name] = 2;\n        } else if (this.state[name] < 0) ; else if (this.state[name] === 1) {\n          if (pending[name] === undefined) pending[name] = true;\n        } else {\n          this.state[name] = 1;\n          hasAllNamespaces = false;\n          if (pending[name] === undefined) pending[name] = true;\n          if (toLoad[name] === undefined) toLoad[name] = true;\n          if (toLoadNamespaces[ns] === undefined) toLoadNamespaces[ns] = true;\n        }\n      });\n      if (!hasAllNamespaces) toLoadLanguages[lng] = true;\n    });\n    if (Object.keys(toLoad).length || Object.keys(pending).length) {\n      this.queue.push({\n        pending,\n        pendingCount: Object.keys(pending).length,\n        loaded: {},\n        errors: [],\n        callback\n      });\n    }\n    return {\n      toLoad: Object.keys(toLoad),\n      pending: Object.keys(pending),\n      toLoadLanguages: Object.keys(toLoadLanguages),\n      toLoadNamespaces: Object.keys(toLoadNamespaces)\n    };\n  }\n  loaded(name, err, data) {\n    const s = name.split('|');\n    const lng = s[0];\n    const ns = s[1];\n    if (err) this.emit('failedLoading', lng, ns, err);\n    if (!err && data) {\n      this.store.addResourceBundle(lng, ns, data, undefined, undefined, {\n        skipCopy: true\n      });\n    }\n    this.state[name] = err ? -1 : 2;\n    if (err && data) this.state[name] = 0;\n    const loaded = {};\n    this.queue.forEach(q => {\n      pushPath(q.loaded, [lng], ns);\n      removePending(q, name);\n      if (err) q.errors.push(err);\n      if (q.pendingCount === 0 && !q.done) {\n        Object.keys(q.loaded).forEach(l => {\n          if (!loaded[l]) loaded[l] = {};\n          const loadedKeys = q.loaded[l];\n          if (loadedKeys.length) {\n            loadedKeys.forEach(n => {\n              if (loaded[l][n] === undefined) loaded[l][n] = true;\n            });\n          }\n        });\n        q.done = true;\n        if (q.errors.length) {\n          q.callback(q.errors);\n        } else {\n          q.callback();\n        }\n      }\n    });\n    this.emit('loaded', loaded);\n    this.queue = this.queue.filter(q => !q.done);\n  }\n  read(lng, ns, fcName) {\n    let tried = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : 0;\n    let wait = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : this.retryTimeout;\n    let callback = arguments.length > 5 ? arguments[5] : undefined;\n    if (!lng.length) return callback(null, {});\n    if (this.readingCalls >= this.maxParallelReads) {\n      this.waitingReads.push({\n        lng,\n        ns,\n        fcName,\n        tried,\n        wait,\n        callback\n      });\n      return;\n    }\n    this.readingCalls++;\n    const resolver = (err, data) => {\n      this.readingCalls--;\n      if (this.waitingReads.length > 0) {\n        const next = this.waitingReads.shift();\n        this.read(next.lng, next.ns, next.fcName, next.tried, next.wait, next.callback);\n      }\n      if (err && data && tried < this.maxRetries) {\n        setTimeout(() => {\n          this.read.call(this, lng, ns, fcName, tried + 1, wait * 2, callback);\n        }, wait);\n        return;\n      }\n      callback(err, data);\n    };\n    const fc = this.backend[fcName].bind(this.backend);\n    if (fc.length === 2) {\n      try {\n        const r = fc(lng, ns);\n        if (r && typeof r.then === 'function') {\n          r.then(data => resolver(null, data)).catch(resolver);\n        } else {\n          resolver(null, r);\n        }\n      } catch (err) {\n        resolver(err);\n      }\n      return;\n    }\n    return fc(lng, ns, resolver);\n  }\n  prepareLoading(languages, namespaces) {\n    let options = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n    let callback = arguments.length > 3 ? arguments[3] : undefined;\n    if (!this.backend) {\n      this.logger.warn('No backend was added via i18next.use. Will not load resources.');\n      return callback && callback();\n    }\n    if (isString(languages)) languages = this.languageUtils.toResolveHierarchy(languages);\n    if (isString(namespaces)) namespaces = [namespaces];\n    const toLoad = this.queueLoad(languages, namespaces, options, callback);\n    if (!toLoad.toLoad.length) {\n      if (!toLoad.pending.length) callback();\n      return null;\n    }\n    toLoad.toLoad.forEach(name => {\n      this.loadOne(name);\n    });\n  }\n  load(languages, namespaces, callback) {\n    this.prepareLoading(languages, namespaces, {}, callback);\n  }\n  reload(languages, namespaces, callback) {\n    this.prepareLoading(languages, namespaces, {\n      reload: true\n    }, callback);\n  }\n  loadOne(name) {\n    let prefix = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : '';\n    const s = name.split('|');\n    const lng = s[0];\n    const ns = s[1];\n    this.read(lng, ns, 'read', undefined, undefined, (err, data) => {\n      if (err) this.logger.warn(`${prefix}loading namespace ${ns} for language ${lng} failed`, err);\n      if (!err && data) this.logger.log(`${prefix}loaded namespace ${ns} for language ${lng}`, data);\n      this.loaded(name, err, data);\n    });\n  }\n  saveMissing(languages, namespace, key, fallbackValue, isUpdate) {\n    let options = arguments.length > 5 && arguments[5] !== undefined ? arguments[5] : {};\n    let clb = arguments.length > 6 && arguments[6] !== undefined ? arguments[6] : () => {};\n    if (this.services?.utils?.hasLoadedNamespace && !this.services?.utils?.hasLoadedNamespace(namespace)) {\n      this.logger.warn(`did not save key \"${key}\" as the namespace \"${namespace}\" was not yet loaded`, 'This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!');\n      return;\n    }\n    if (key === undefined || key === null || key === '') return;\n    if (this.backend?.create) {\n      const opts = {\n        ...options,\n        isUpdate\n      };\n      const fc = this.backend.create.bind(this.backend);\n      if (fc.length < 6) {\n        try {\n          let r;\n          if (fc.length === 5) {\n            r = fc(languages, namespace, key, fallbackValue, opts);\n          } else {\n            r = fc(languages, namespace, key, fallbackValue);\n          }\n          if (r && typeof r.then === 'function') {\n            r.then(data => clb(null, data)).catch(clb);\n          } else {\n            clb(null, r);\n          }\n        } catch (err) {\n          clb(err);\n        }\n      } else {\n        fc(languages, namespace, key, fallbackValue, clb, opts);\n      }\n    }\n    if (!languages || !languages[0]) return;\n    this.store.addResource(languages[0], namespace, key, fallbackValue);\n  }\n}\n\nconst get = () => ({\n  debug: false,\n  initAsync: true,\n  ns: ['translation'],\n  defaultNS: ['translation'],\n  fallbackLng: ['dev'],\n  fallbackNS: false,\n  supportedLngs: false,\n  nonExplicitSupportedLngs: false,\n  load: 'all',\n  preload: false,\n  simplifyPluralSuffix: true,\n  keySeparator: '.',\n  nsSeparator: ':',\n  pluralSeparator: '_',\n  contextSeparator: '_',\n  partialBundledLanguages: false,\n  saveMissing: false,\n  updateMissing: false,\n  saveMissingTo: 'fallback',\n  saveMissingPlurals: true,\n  missingKeyHandler: false,\n  missingInterpolationHandler: false,\n  postProcess: false,\n  postProcessPassResolved: false,\n  returnNull: false,\n  returnEmptyString: true,\n  returnObjects: false,\n  joinArrays: false,\n  returnedObjectHandler: false,\n  parseMissingKeyHandler: false,\n  appendNamespaceToMissingKey: false,\n  appendNamespaceToCIMode: false,\n  overloadTranslationOptionHandler: args => {\n    let ret = {};\n    if (typeof args[1] === 'object') ret = args[1];\n    if (isString(args[1])) ret.defaultValue = args[1];\n    if (isString(args[2])) ret.tDescription = args[2];\n    if (typeof args[2] === 'object' || typeof args[3] === 'object') {\n      const options = args[3] || args[2];\n      Object.keys(options).forEach(key => {\n        ret[key] = options[key];\n      });\n    }\n    return ret;\n  },\n  interpolation: {\n    escapeValue: true,\n    format: value => value,\n    prefix: '{{',\n    suffix: '}}',\n    formatSeparator: ',',\n    unescapePrefix: '-',\n    nestingPrefix: '$t(',\n    nestingSuffix: ')',\n    nestingOptionsSeparator: ',',\n    maxReplaces: 1000,\n    skipOnVariables: true\n  }\n});\nconst transformOptions = options => {\n  if (isString(options.ns)) options.ns = [options.ns];\n  if (isString(options.fallbackLng)) options.fallbackLng = [options.fallbackLng];\n  if (isString(options.fallbackNS)) options.fallbackNS = [options.fallbackNS];\n  if (options.supportedLngs?.indexOf?.('cimode') < 0) {\n    options.supportedLngs = options.supportedLngs.concat(['cimode']);\n  }\n  if (typeof options.initImmediate === 'boolean') options.initAsync = options.initImmediate;\n  return options;\n};\n\nconst noop = () => {};\nconst bindMemberFunctions = inst => {\n  const mems = Object.getOwnPropertyNames(Object.getPrototypeOf(inst));\n  mems.forEach(mem => {\n    if (typeof inst[mem] === 'function') {\n      inst[mem] = inst[mem].bind(inst);\n    }\n  });\n};\nclass I18n extends EventEmitter {\n  constructor() {\n    let options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n    let callback = arguments.length > 1 ? arguments[1] : undefined;\n    super();\n    this.options = transformOptions(options);\n    this.services = {};\n    this.logger = baseLogger;\n    this.modules = {\n      external: []\n    };\n    bindMemberFunctions(this);\n    if (callback && !this.isInitialized && !options.isClone) {\n      if (!this.options.initAsync) {\n        this.init(options, callback);\n        return this;\n      }\n      setTimeout(() => {\n        this.init(options, callback);\n      }, 0);\n    }\n  }\n  init() {\n    var _this = this;\n    let options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n    let callback = arguments.length > 1 ? arguments[1] : undefined;\n    this.isInitializing = true;\n    if (typeof options === 'function') {\n      callback = options;\n      options = {};\n    }\n    if (options.defaultNS == null && options.ns) {\n      if (isString(options.ns)) {\n        options.defaultNS = options.ns;\n      } else if (options.ns.indexOf('translation') < 0) {\n        options.defaultNS = options.ns[0];\n      }\n    }\n    const defOpts = get();\n    this.options = {\n      ...defOpts,\n      ...this.options,\n      ...transformOptions(options)\n    };\n    this.options.interpolation = {\n      ...defOpts.interpolation,\n      ...this.options.interpolation\n    };\n    if (options.keySeparator !== undefined) {\n      this.options.userDefinedKeySeparator = options.keySeparator;\n    }\n    if (options.nsSeparator !== undefined) {\n      this.options.userDefinedNsSeparator = options.nsSeparator;\n    }\n    const createClassOnDemand = ClassOrObject => {\n      if (!ClassOrObject) return null;\n      if (typeof ClassOrObject === 'function') return new ClassOrObject();\n      return ClassOrObject;\n    };\n    if (!this.options.isClone) {\n      if (this.modules.logger) {\n        baseLogger.init(createClassOnDemand(this.modules.logger), this.options);\n      } else {\n        baseLogger.init(null, this.options);\n      }\n      let formatter;\n      if (this.modules.formatter) {\n        formatter = this.modules.formatter;\n      } else {\n        formatter = Formatter;\n      }\n      const lu = new LanguageUtil(this.options);\n      this.store = new ResourceStore(this.options.resources, this.options);\n      const s = this.services;\n      s.logger = baseLogger;\n      s.resourceStore = this.store;\n      s.languageUtils = lu;\n      s.pluralResolver = new PluralResolver(lu, {\n        prepend: this.options.pluralSeparator,\n        simplifyPluralSuffix: this.options.simplifyPluralSuffix\n      });\n      if (formatter && (!this.options.interpolation.format || this.options.interpolation.format === defOpts.interpolation.format)) {\n        s.formatter = createClassOnDemand(formatter);\n        s.formatter.init(s, this.options);\n        this.options.interpolation.format = s.formatter.format.bind(s.formatter);\n      }\n      s.interpolator = new Interpolator(this.options);\n      s.utils = {\n        hasLoadedNamespace: this.hasLoadedNamespace.bind(this)\n      };\n      s.backendConnector = new Connector(createClassOnDemand(this.modules.backend), s.resourceStore, s, this.options);\n      s.backendConnector.on('*', function (event) {\n        for (var _len = arguments.length, args = new Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {\n          args[_key - 1] = arguments[_key];\n        }\n        _this.emit(event, ...args);\n      });\n      if (this.modules.languageDetector) {\n        s.languageDetector = createClassOnDemand(this.modules.languageDetector);\n        if (s.languageDetector.init) s.languageDetector.init(s, this.options.detection, this.options);\n      }\n      if (this.modules.i18nFormat) {\n        s.i18nFormat = createClassOnDemand(this.modules.i18nFormat);\n        if (s.i18nFormat.init) s.i18nFormat.init(this);\n      }\n      this.translator = new Translator(this.services, this.options);\n      this.translator.on('*', function (event) {\n        for (var _len2 = arguments.length, args = new Array(_len2 > 1 ? _len2 - 1 : 0), _key2 = 1; _key2 < _len2; _key2++) {\n          args[_key2 - 1] = arguments[_key2];\n        }\n        _this.emit(event, ...args);\n      });\n      this.modules.external.forEach(m => {\n        if (m.init) m.init(this);\n      });\n    }\n    this.format = this.options.interpolation.format;\n    if (!callback) callback = noop;\n    if (this.options.fallbackLng && !this.services.languageDetector && !this.options.lng) {\n      const codes = this.services.languageUtils.getFallbackCodes(this.options.fallbackLng);\n      if (codes.length > 0 && codes[0] !== 'dev') this.options.lng = codes[0];\n    }\n    if (!this.services.languageDetector && !this.options.lng) {\n      this.logger.warn('init: no languageDetector is used and no lng is defined');\n    }\n    const storeApi = ['getResource', 'hasResourceBundle', 'getResourceBundle', 'getDataByLanguage'];\n    storeApi.forEach(fcName => {\n      this[fcName] = function () {\n        return _this.store[fcName](...arguments);\n      };\n    });\n    const storeApiChained = ['addResource', 'addResources', 'addResourceBundle', 'removeResourceBundle'];\n    storeApiChained.forEach(fcName => {\n      this[fcName] = function () {\n        _this.store[fcName](...arguments);\n        return _this;\n      };\n    });\n    const deferred = defer();\n    const load = () => {\n      const finish = (err, t) => {\n        this.isInitializing = false;\n        if (this.isInitialized && !this.initializedStoreOnce) this.logger.warn('init: i18next is already initialized. You should call init just once!');\n        this.isInitialized = true;\n        if (!this.options.isClone) this.logger.log('initialized', this.options);\n        this.emit('initialized', this.options);\n        deferred.resolve(t);\n        callback(err, t);\n      };\n      if (this.languages && !this.isInitialized) return finish(null, this.t.bind(this));\n      this.changeLanguage(this.options.lng, finish);\n    };\n    if (this.options.resources || !this.options.initAsync) {\n      load();\n    } else {\n      setTimeout(load, 0);\n    }\n    return deferred;\n  }\n  loadResources(language) {\n    let callback = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : noop;\n    let usedCallback = callback;\n    const usedLng = isString(language) ? language : this.language;\n    if (typeof language === 'function') usedCallback = language;\n    if (!this.options.resources || this.options.partialBundledLanguages) {\n      if (usedLng?.toLowerCase() === 'cimode' && (!this.options.preload || this.options.preload.length === 0)) return usedCallback();\n      const toLoad = [];\n      const append = lng => {\n        if (!lng) return;\n        if (lng === 'cimode') return;\n        const lngs = this.services.languageUtils.toResolveHierarchy(lng);\n        lngs.forEach(l => {\n          if (l === 'cimode') return;\n          if (toLoad.indexOf(l) < 0) toLoad.push(l);\n        });\n      };\n      if (!usedLng) {\n        const fallbacks = this.services.languageUtils.getFallbackCodes(this.options.fallbackLng);\n        fallbacks.forEach(l => append(l));\n      } else {\n        append(usedLng);\n      }\n      this.options.preload?.forEach?.(l => append(l));\n      this.services.backendConnector.load(toLoad, this.options.ns, e => {\n        if (!e && !this.resolvedLanguage && this.language) this.setResolvedLanguage(this.language);\n        usedCallback(e);\n      });\n    } else {\n      usedCallback(null);\n    }\n  }\n  reloadResources(lngs, ns, callback) {\n    const deferred = defer();\n    if (typeof lngs === 'function') {\n      callback = lngs;\n      lngs = undefined;\n    }\n    if (typeof ns === 'function') {\n      callback = ns;\n      ns = undefined;\n    }\n    if (!lngs) lngs = this.languages;\n    if (!ns) ns = this.options.ns;\n    if (!callback) callback = noop;\n    this.services.backendConnector.reload(lngs, ns, err => {\n      deferred.resolve();\n      callback(err);\n    });\n    return deferred;\n  }\n  use(module) {\n    if (!module) throw new Error('You are passing an undefined module! Please check the object you are passing to i18next.use()');\n    if (!module.type) throw new Error('You are passing a wrong module! Please check the object you are passing to i18next.use()');\n    if (module.type === 'backend') {\n      this.modules.backend = module;\n    }\n    if (module.type === 'logger' || module.log && module.warn && module.error) {\n      this.modules.logger = module;\n    }\n    if (module.type === 'languageDetector') {\n      this.modules.languageDetector = module;\n    }\n    if (module.type === 'i18nFormat') {\n      this.modules.i18nFormat = module;\n    }\n    if (module.type === 'postProcessor') {\n      postProcessor.addPostProcessor(module);\n    }\n    if (module.type === 'formatter') {\n      this.modules.formatter = module;\n    }\n    if (module.type === '3rdParty') {\n      this.modules.external.push(module);\n    }\n    return this;\n  }\n  setResolvedLanguage(l) {\n    if (!l || !this.languages) return;\n    if (['cimode', 'dev'].indexOf(l) > -1) return;\n    for (let li = 0; li < this.languages.length; li++) {\n      const lngInLngs = this.languages[li];\n      if (['cimode', 'dev'].indexOf(lngInLngs) > -1) continue;\n      if (this.store.hasLanguageSomeTranslations(lngInLngs)) {\n        this.resolvedLanguage = lngInLngs;\n        break;\n      }\n    }\n  }\n  changeLanguage(lng, callback) {\n    var _this2 = this;\n    this.isLanguageChangingTo = lng;\n    const deferred = defer();\n    this.emit('languageChanging', lng);\n    const setLngProps = l => {\n      this.language = l;\n      this.languages = this.services.languageUtils.toResolveHierarchy(l);\n      this.resolvedLanguage = undefined;\n      this.setResolvedLanguage(l);\n    };\n    const done = (err, l) => {\n      if (l) {\n        setLngProps(l);\n        this.translator.changeLanguage(l);\n        this.isLanguageChangingTo = undefined;\n        this.emit('languageChanged', l);\n        this.logger.log('languageChanged', l);\n      } else {\n        this.isLanguageChangingTo = undefined;\n      }\n      deferred.resolve(function () {\n        return _this2.t(...arguments);\n      });\n      if (callback) callback(err, function () {\n        return _this2.t(...arguments);\n      });\n    };\n    const setLng = lngs => {\n      if (!lng && !lngs && this.services.languageDetector) lngs = [];\n      const l = isString(lngs) ? lngs : this.services.languageUtils.getBestMatchFromCodes(lngs);\n      if (l) {\n        if (!this.language) {\n          setLngProps(l);\n        }\n        if (!this.translator.language) this.translator.changeLanguage(l);\n        this.services.languageDetector?.cacheUserLanguage?.(l);\n      }\n      this.loadResources(l, err => {\n        done(err, l);\n      });\n    };\n    if (!lng && this.services.languageDetector && !this.services.languageDetector.async) {\n      setLng(this.services.languageDetector.detect());\n    } else if (!lng && this.services.languageDetector && this.services.languageDetector.async) {\n      if (this.services.languageDetector.detect.length === 0) {\n        this.services.languageDetector.detect().then(setLng);\n      } else {\n        this.services.languageDetector.detect(setLng);\n      }\n    } else {\n      setLng(lng);\n    }\n    return deferred;\n  }\n  getFixedT(lng, ns, keyPrefix) {\n    var _this3 = this;\n    const fixedT = function (key, opts) {\n      let options;\n      if (typeof opts !== 'object') {\n        for (var _len3 = arguments.length, rest = new Array(_len3 > 2 ? _len3 - 2 : 0), _key3 = 2; _key3 < _len3; _key3++) {\n          rest[_key3 - 2] = arguments[_key3];\n        }\n        options = _this3.options.overloadTranslationOptionHandler([key, opts].concat(rest));\n      } else {\n        options = {\n          ...opts\n        };\n      }\n      options.lng = options.lng || fixedT.lng;\n      options.lngs = options.lngs || fixedT.lngs;\n      options.ns = options.ns || fixedT.ns;\n      if (options.keyPrefix !== '') options.keyPrefix = options.keyPrefix || keyPrefix || fixedT.keyPrefix;\n      const keySeparator = _this3.options.keySeparator || '.';\n      let resultKey;\n      if (options.keyPrefix && Array.isArray(key)) {\n        resultKey = key.map(k => `${options.keyPrefix}${keySeparator}${k}`);\n      } else {\n        resultKey = options.keyPrefix ? `${options.keyPrefix}${keySeparator}${key}` : key;\n      }\n      return _this3.t(resultKey, options);\n    };\n    if (isString(lng)) {\n      fixedT.lng = lng;\n    } else {\n      fixedT.lngs = lng;\n    }\n    fixedT.ns = ns;\n    fixedT.keyPrefix = keyPrefix;\n    return fixedT;\n  }\n  t() {\n    for (var _len4 = arguments.length, args = new Array(_len4), _key4 = 0; _key4 < _len4; _key4++) {\n      args[_key4] = arguments[_key4];\n    }\n    return this.translator?.translate(...args);\n  }\n  exists() {\n    for (var _len5 = arguments.length, args = new Array(_len5), _key5 = 0; _key5 < _len5; _key5++) {\n      args[_key5] = arguments[_key5];\n    }\n    return this.translator?.exists(...args);\n  }\n  setDefaultNamespace(ns) {\n    this.options.defaultNS = ns;\n  }\n  hasLoadedNamespace(ns) {\n    let options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n    if (!this.isInitialized) {\n      this.logger.warn('hasLoadedNamespace: i18next was not initialized', this.languages);\n      return false;\n    }\n    if (!this.languages || !this.languages.length) {\n      this.logger.warn('hasLoadedNamespace: i18n.languages were undefined or empty', this.languages);\n      return false;\n    }\n    const lng = options.lng || this.resolvedLanguage || this.languages[0];\n    const fallbackLng = this.options ? this.options.fallbackLng : false;\n    const lastLng = this.languages[this.languages.length - 1];\n    if (lng.toLowerCase() === 'cimode') return true;\n    const loadNotPending = (l, n) => {\n      const loadState = this.services.backendConnector.state[`${l}|${n}`];\n      return loadState === -1 || loadState === 0 || loadState === 2;\n    };\n    if (options.precheck) {\n      const preResult = options.precheck(this, loadNotPending);\n      if (preResult !== undefined) return preResult;\n    }\n    if (this.hasResourceBundle(lng, ns)) return true;\n    if (!this.services.backendConnector.backend || this.options.resources && !this.options.partialBundledLanguages) return true;\n    if (loadNotPending(lng, ns) && (!fallbackLng || loadNotPending(lastLng, ns))) return true;\n    return false;\n  }\n  loadNamespaces(ns, callback) {\n    const deferred = defer();\n    if (!this.options.ns) {\n      if (callback) callback();\n      return Promise.resolve();\n    }\n    if (isString(ns)) ns = [ns];\n    ns.forEach(n => {\n      if (this.options.ns.indexOf(n) < 0) this.options.ns.push(n);\n    });\n    this.loadResources(err => {\n      deferred.resolve();\n      if (callback) callback(err);\n    });\n    return deferred;\n  }\n  loadLanguages(lngs, callback) {\n    const deferred = defer();\n    if (isString(lngs)) lngs = [lngs];\n    const preloaded = this.options.preload || [];\n    const newLngs = lngs.filter(lng => preloaded.indexOf(lng) < 0 && this.services.languageUtils.isSupportedCode(lng));\n    if (!newLngs.length) {\n      if (callback) callback();\n      return Promise.resolve();\n    }\n    this.options.preload = preloaded.concat(newLngs);\n    this.loadResources(err => {\n      deferred.resolve();\n      if (callback) callback(err);\n    });\n    return deferred;\n  }\n  dir(lng) {\n    if (!lng) lng = this.resolvedLanguage || (this.languages?.length > 0 ? this.languages[0] : this.language);\n    if (!lng) return 'rtl';\n    const rtlLngs = ['ar', 'shu', 'sqr', 'ssh', 'xaa', 'yhd', 'yud', 'aao', 'abh', 'abv', 'acm', 'acq', 'acw', 'acx', 'acy', 'adf', 'ads', 'aeb', 'aec', 'afb', 'ajp', 'apc', 'apd', 'arb', 'arq', 'ars', 'ary', 'arz', 'auz', 'avl', 'ayh', 'ayl', 'ayn', 'ayp', 'bbz', 'pga', 'he', 'iw', 'ps', 'pbt', 'pbu', 'pst', 'prp', 'prd', 'ug', 'ur', 'ydd', 'yds', 'yih', 'ji', 'yi', 'hbo', 'men', 'xmn', 'fa', 'jpr', 'peo', 'pes', 'prs', 'dv', 'sam', 'ckb'];\n    const languageUtils = this.services?.languageUtils || new LanguageUtil(get());\n    return rtlLngs.indexOf(languageUtils.getLanguagePartFromCode(lng)) > -1 || lng.toLowerCase().indexOf('-arab') > 1 ? 'rtl' : 'ltr';\n  }\n  static createInstance() {\n    let options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n    let callback = arguments.length > 1 ? arguments[1] : undefined;\n    return new I18n(options, callback);\n  }\n  cloneInstance() {\n    let options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n    let callback = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : noop;\n    const forkResourceStore = options.forkResourceStore;\n    if (forkResourceStore) delete options.forkResourceStore;\n    const mergedOptions = {\n      ...this.options,\n      ...options,\n      ...{\n        isClone: true\n      }\n    };\n    const clone = new I18n(mergedOptions);\n    if (options.debug !== undefined || options.prefix !== undefined) {\n      clone.logger = clone.logger.clone(options);\n    }\n    const membersToCopy = ['store', 'services', 'language'];\n    membersToCopy.forEach(m => {\n      clone[m] = this[m];\n    });\n    clone.services = {\n      ...this.services\n    };\n    clone.services.utils = {\n      hasLoadedNamespace: clone.hasLoadedNamespace.bind(clone)\n    };\n    if (forkResourceStore) {\n      const clonedData = Object.keys(this.store.data).reduce((prev, l) => {\n        prev[l] = {\n          ...this.store.data[l]\n        };\n        return Object.keys(prev[l]).reduce((acc, n) => {\n          acc[n] = {\n            ...prev[l][n]\n          };\n          return acc;\n        }, {});\n      }, {});\n      clone.store = new ResourceStore(clonedData, mergedOptions);\n      clone.services.resourceStore = clone.store;\n    }\n    clone.translator = new Translator(clone.services, mergedOptions);\n    clone.translator.on('*', function (event) {\n      for (var _len6 = arguments.length, args = new Array(_len6 > 1 ? _len6 - 1 : 0), _key6 = 1; _key6 < _len6; _key6++) {\n        args[_key6 - 1] = arguments[_key6];\n      }\n      clone.emit(event, ...args);\n    });\n    clone.init(mergedOptions, callback);\n    clone.translator.options = mergedOptions;\n    clone.translator.backendConnector.services.utils = {\n      hasLoadedNamespace: clone.hasLoadedNamespace.bind(clone)\n    };\n    return clone;\n  }\n  toJSON() {\n    return {\n      options: this.options,\n      store: this.store,\n      language: this.language,\n      languages: this.languages,\n      resolvedLanguage: this.resolvedLanguage\n    };\n  }\n}\nconst instance = I18n.createInstance();\ninstance.createInstance = I18n.createInstance;\n\nconst createInstance = instance.createInstance;\nconst dir = instance.dir;\nconst init = instance.init;\nconst loadResources = instance.loadResources;\nconst reloadResources = instance.reloadResources;\nconst use = instance.use;\nconst changeLanguage = instance.changeLanguage;\nconst getFixedT = instance.getFixedT;\nconst t = instance.t;\nconst exists = instance.exists;\nconst setDefaultNamespace = instance.setDefaultNamespace;\nconst hasLoadedNamespace = instance.hasLoadedNamespace;\nconst loadNamespaces = instance.loadNamespaces;\nconst loadLanguages = instance.loadLanguages;\n\nexport { changeLanguage, createInstance, instance as default, dir, exists, getFixedT, hasLoadedNamespace, init, loadLanguages, loadNamespaces, loadResources, reloadResources, setDefaultNamespace, t, use };\n","import i18next from 'i18next';\nexport default i18next;\n\nimport opening_hours_resources from './opening_hours_resources.yaml';\n\nif (!i18next.isInitialized) {\n    i18next.init({\n        fallbackLng: 'en',\n        // lngWhitelist: ['en', 'de'],\n        resources: opening_hours_resources,\n        getAsync: true,\n        useCookie: true,\n        // debug: true,\n    });\n} else {\n    // compat with an app that already initializes i18n\n    for (var lang in opening_hours_resources) {\n        i18next.addResourceBundle(lang, 'opening_hours', opening_hours_resources[lang]['opening_hours'], true);\n    }\n}\n","/*\n * SPDX-FileCopyrightText:  2012 Dmitry Marakasov\n * SPDX-FileCopyrightText:  2013 Robin Schneider <ypid@riseup.net>\n *\n * SPDX-License-Identifier: LGPL-3.0-only\n *\n * This file is based on work under the following copyright and permission\n * notice:\n *\n *     Copyright (c) 2012-2013 Dmitry Marakasov\n *     All rights reserved.\n *\n *     Redistribution and use in source and binary forms, with or without\n *     modification, are permitted provided that the following conditions are met:\n *\n *     1. Redistributions of source code must retain the above copyright notice, this\n *     list of conditions and the following disclaimer.\n *\n *     2. Redistributions in binary form must reproduce the above copyright notice,\n *     this list of conditions and the following disclaimer in the documentation\n *     and/or other materials provided with the distribution.\n *\n *     THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\" AND\n *     ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\n *     WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\n *     DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE\n *     FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL\n *     DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR\n *     SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER\n *     CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,\n *     OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\n *     OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n */\nimport * as holiday_definitions from './holidays/index';\nimport word_error_correction from './locales/word_error_correction.yaml';\nimport lang from './locales/lang.yaml';\n\nimport SunCalc from 'suncalc';\nimport i18next from './locales/core';\n\nexport default function(value, nominatim_object, optional_conf_parm) {\n    // Short constants {{{\n    var word_value_replacement = { // If the correct values can not be calculated.\n        dawn    : 60 * 5 + 30,\n        sunrise : 60 * 6,\n        sunset  : 60 * 18,\n        dusk    : 60 * 18 + 30,\n    };\n    var months   = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];\n    var weekdays = ['Su','Mo','Tu','We','Th','Fr','Sa'];\n    var string_to_token_map = {\n        'su': [ 0, 'weekday' ],\n        'mo': [ 1, 'weekday' ],\n        'tu': [ 2, 'weekday' ],\n        'we': [ 3, 'weekday' ],\n        'th': [ 4, 'weekday' ],\n        'fr': [ 5, 'weekday' ],\n        'sa': [ 6, 'weekday' ],\n        'jan': [  0, 'month' ],\n        'feb': [  1, 'month' ],\n        'mar': [  2, 'month' ],\n        'apr': [  3, 'month' ],\n        'may': [  4, 'month' ],\n        'jun': [  5, 'month' ],\n        'jul': [  6, 'month' ],\n        'aug': [  7, 'month' ],\n        'sep': [  8, 'month' ],\n        'oct': [  9, 'month' ],\n        'nov': [ 10, 'month' ],\n        'dec': [ 11, 'month' ],\n        'day': [ 'day', 'calcday' ],\n        'days': [ 'days', 'calcday' ],\n        'sunrise': [ 'sunrise', 'timevar' ],\n        'sunset': [ 'sunset', 'timevar' ],\n        'dawn': [ 'dawn', 'timevar' ],\n        'dusk': [ 'dusk', 'timevar' ],\n        'easter': [ 'easter', 'event' ],\n        'week': [ 'week', 'week' ],\n        'open': [ 'open', 'state' ],\n        'closed': [ 'closed', 'state' ],\n        'off': [ 'off', 'state' ],\n        'unknown': [ 'unknown', 'state' ],\n    }\n\n    var default_prettify_conf = {\n        // Update README.md if changed.\n        'zero_pad_hour': true,           // enforce (\"%02d\", hour)\n        'one_zero_if_hour_zero': false,  // only one zero \"0\" if hour is zero \"0\"\n        'leave_off_closed': true,        // leave keywords \"off\" and \"closed\" as is\n        'keyword_for_off_closed': 'off', // use given keyword instead of \"off\" or \"closed\"\n        'rule_sep_string': ' ',          // separate rules by string\n        'print_semicolon': true,         // print token which separates normal rules\n        'leave_weekday_sep_one_day_betw': true, // use the separator (either \",\" or \"-\" which is used to separate days which follow to each other like Sa,Su or Su-Mo\n        'sep_one_day_between': ',',      // separator which should be used\n        'zero_pad_month_and_week_numbers': true, // Format week (e.g. `week 01`) and month day numbers (e.g. `Jan 01`) with \"%02d\".\n        'locale': 'en',                  // use local language (needs i18next)\n    };\n\n    var osm_tag_defaults = {\n        'opening_hours'       :  { 'mode' :  0, 'warn_for_PH_missing' :  true, },\n        'collection_times'    :  { 'mode' :  2, },\n        /* oh_mode 2: \"including the hyphen because there are post boxes which are\n         * emptied several (undefined) times or one (undefined) time in a certain time\n         * frame. This shall be covered also.\".\n         * Ref: https://wiki.openstreetmap.org/wiki/Key:collection_times */\n        'opening_hours:.+'    :  { 'mode' :  0, },\n        '.+:opening_hours'    :  { 'mode' :  0, },\n        '.+:opening_hours:.+' :  { 'mode' :  0, },\n        'smoking_hours'       :  { 'mode' :  0, },\n        'service_times'       :  { 'mode' :  2, },\n        'happy_hours'         :  { 'mode' :  0, },\n        'lit'                 :  { 'mode' :  0,\n            map: {\n                'yes'      : 'sunset-sunrise open \"specified as yes: At night (unknown time schedule or daylight detection)\"',\n                'automatic': 'unknown \"specified as automatic: When someone enters the way the lights are turned on.\"',\n                'no'       : 'off \"specified as no: There are no lights installed.\"',\n                'interval' : 'unknown \"specified as interval\"',\n                'limited'  : 'unknown \"specified as limited\"',\n            }\n        },\n    };\n\n    var minutes_in_day = 60 * 24;\n    var msec_in_day    = 1000 * 60 * minutes_in_day;\n    // var msec_in_week   = msec_in_day * 7;\n\n    var library_name   = 'opening_hours.js';\n    var repository_url = 'https://github.com/opening-hours/' + library_name;\n    // var issues_url     = repository_url + '/issues?state=open';\n    /* }}} */\n\n    /* Translation function {{{ */\n    /* Roughly compatibly to i18next so we can replace everything by i18next with\n     * sprintf support.\n     */\n    var locale = 'en'; // Default locale\n    if (typeof i18next === 'object') {\n        locale = i18next.language;\n    }\n\n    var t = function(str, variables) {\n        if (\n                typeof i18next === 'object'\n                && typeof i18next.t === 'function'\n                && typeof locale === 'string'\n                && ['de'].indexOf(locale) !== -1\n            ) {\n\n            var translatorFunction;\n            if (i18next.language !== locale) {\n                translatorFunction = i18next.getFixedT(locale);\n            } else {\n                translatorFunction = i18next.t;\n            }\n            var text = translatorFunction('opening_hours:texts.' + str, variables);\n            return text;\n        }\n        var text = lang[str];\n        if (typeof text === 'undefined') {\n            text = str;\n        }\n        return text.replace(/{{([^{}]*)}}/g, function (match, c) {\n            return typeof variables[c] !== 'undefined'\n                ? variables[c]\n                : match\n                ;\n            }\n        );\n    };\n    /* }}} */\n\n    /* Optional constructor parameters {{{ */\n\n    /* nominatim_object {{{\n     *\n     * Required to reasonably calculate 'sunrise' and holidays.\n     */\n    var location_cc, location_state, lat, lon;\n    if (typeof nominatim_object === 'object' && nominatim_object !== null) {\n        if (typeof nominatim_object.address === 'object') {\n            if (typeof nominatim_object.address.country_code === 'string') {\n                location_cc = nominatim_object.address.country_code;\n            }\n            if (typeof nominatim_object.address.state === 'string') {\n                location_state = nominatim_object.address.state;\n            } else if (typeof nominatim_object.address.county === 'string') {\n                location_state = nominatim_object.address.county;\n            }\n        }\n\n        if (typeof nominatim_object.lon === 'string' && typeof nominatim_object.lat === 'string') {\n            lat = nominatim_object.lat;\n            lon = nominatim_object.lon;\n        }\n    } else if (nominatim_object === null) {\n        /* Set the location to some random value. This can be used if you dont\n         * care about correct opening hours for more complex opening_hours\n         * values.\n         */\n        location_cc = 'de';\n        location_state = 'Baden-W\\u00fcrttemberg';\n        lat = '49.5400039';\n        lon = '9.7937133';\n    } else if (typeof nominatim_object !== 'undefined') {\n        throw 'The nominatim_object parameter is of unknown type.'\n            + ' Given ' + typeof(nominatim_object)\n            + ', expected object.';\n    }\n    /* }}} */\n\n    /* mode, locale, warnings_severity, tag_key, map_value {{{\n     *\n     * 0: time ranges (default), tags: opening_hours, lit, \n     * 1: points in time\n     * 2: both (time ranges and points in time), tags: collection_times, service_times\n     */\n\n    var warnings_severity = 4;\n    /* Default, currently the highest severity supported.\n     * This number is expected to be >= 4. This is not explicitly checked.\n     */\n\n    var oh_mode;\n    var oh_map_value = false;\n    var oh_key, oh_regex_key;\n\n    if (typeof optional_conf_parm === 'number') {\n        oh_mode = optional_conf_parm;\n    } else if (typeof optional_conf_parm === 'object') {\n        if (typeof optional_conf_parm['locale'] === 'string') {\n            /* TODO: The split thing is obviously a workaround. */\n            locale = optional_conf_parm['locale'].split('-')[0];\n        }\n        if (checkOptionalConfParm('mode', 'number')) {\n            oh_mode = optional_conf_parm['mode'];\n        }\n        if (checkOptionalConfParm('warnings_severity', 'number')) {\n            warnings_severity = optional_conf_parm['warnings_severity'];\n            if ([ 0, 1, 2, 3, 4, 5, 6, 7 ].indexOf(warnings_severity) === -1) {\n                throw t('warnings severity', { 'severity': warnings_severity, 'allowed': '[ 0, 1, 2, 3, 4, 5, 6, 7 ]' });\n            }\n        }\n        if (checkOptionalConfParm('tag_key', 'string')) {\n            oh_key = optional_conf_parm['tag_key'];\n        }\n        if (checkOptionalConfParm('map_value', 'boolean')) {\n            oh_map_value = optional_conf_parm.map_value;\n        }\n    } else if (typeof optional_conf_parm !== 'undefined') {\n        throw t('optional conf parm type', { 'given': typeof(optional_conf_parm) });\n    }\n\n    if (typeof oh_key === 'string') {\n        oh_regex_key = getRegexKeyForKeyFromOsmDefaults(oh_key)\n\n        if (oh_map_value\n            && typeof osm_tag_defaults[oh_regex_key] === 'object'\n            && typeof osm_tag_defaults[oh_regex_key]['map'] === 'object'\n            && typeof osm_tag_defaults[oh_regex_key]['map'][value] === 'string'\n            ) {\n\n            value = osm_tag_defaults[oh_regex_key]['map'][value];\n        }\n    } else if (oh_map_value) {\n        throw t('conf param tag key missing');\n    }\n\n    if (typeof oh_mode === 'undefined') {\n        if (typeof oh_key === 'string' && osm_tag_defaults[oh_regex_key] !== undefined) {\n            if (typeof osm_tag_defaults[oh_regex_key]['mode'] === 'number') {\n                oh_mode = osm_tag_defaults[oh_regex_key]['mode'];\n            } else {\n                oh_mode = 0;\n            }\n        } else {\n            oh_mode = 0;\n        }\n    } else if ([ 0, 1, 2 ].indexOf(oh_mode) === -1) {\n        throw t('conf param mode invalid', { 'given': oh_mode, 'allowed': '[ 0, 1, 2 ]' });\n    }\n\n    /* }}} */\n    /* }}} */\n\n    // Tokenize value and generate selector functions. {{{\n    if (typeof value !== 'string') {\n        throw t('no string');\n    }\n    if (/^(?:\\s*;?)+$/.test(value)) {\n        throw t('nothing');\n    }\n\n    var parsing_warnings = []; // Elements are fed into function formatWarnErrorMessage(nrule, at, message)\n    var done_with_warnings = false; // The functions which returns warnings can be called multiple times.\n    var done_with_selector_reordering = false;\n    var done_with_selector_reordering_warnings = false;\n    var tokens = tokenize(value);\n    // console.log(JSON.stringify(tokens, null, '    '));\n    var prettified_value = '';\n    var week_stable = true;\n\n    var rules = [];\n    var rule_infos = {};\n    /* Not reliable because tokens !== new_tokens */\n    // for (var nrule = 0; nrule < tokens.length; nrule++) {\n    //     rule_infos[nrule] = {};\n    // }\n    var new_tokens = [];\n\n    for (var nrule = 0; nrule < tokens.length; nrule++) {\n        if (tokens[nrule][0].length === 0) {\n            // Rule does contain nothing useful e.g. second rule of '10:00-12:00;' (empty) which needs to be handled.\n            parsing_warnings.push([nrule, -1,\n                t('nothing useful')\n                + (nrule === tokens.length - 1 && nrule > 0 && !tokens[nrule][1] ?\n                    ' ' + t('programmers joke') : '')\n                ]);\n            continue;\n        }\n\n        var continue_at = 0;\n        var next_rule_is_additional = false;\n        do {\n            if (continue_at === tokens[nrule][0].length) {\n                /* Additional rule does contain nothing useful e.g. second rule\n                 * of '10:00-12:00,' (empty) which needs to be handled.\n                  */\n                break;\n            }\n\n            var rule = {\n                // Time selectors\n                time: [],\n\n                // Temporary array of selectors from time wrapped to the next day\n                wraptime: [],\n\n                // Date selectors\n                weekday: [],\n                holiday: [],\n                week: [],\n                month: [],\n                monthday: [],\n                year: [],\n\n                // Array with non-empty date selector types, with most optimal ordering\n                date: [],\n\n                fallback: tokens[nrule][1],\n                additional: continue_at ? true : false,\n                meaning: true,\n                unknown: false,\n                comment: undefined,\n                build_from_token_rule: undefined,\n            };\n\n            rule.build_from_token_rule = [ nrule, continue_at, new_tokens.length ];\n            continue_at = parseGroup(tokens[nrule][0], continue_at, rule, nrule);\n            if (typeof continue_at === 'object') {\n                continue_at = continue_at[0];\n            } else {\n                continue_at = 0;\n            }\n\n            // console.log('Current tokens: ' + JSON.stringify(tokens[nrule], null, '    '));\n\n            new_tokens.push(\n                [\n                    tokens[nrule][0].slice(\n                        rule.build_from_token_rule[1],\n                        continue_at === 0\n                            ? tokens[nrule][0].length\n                            : continue_at\n                    ),\n                    tokens[nrule][1],\n                    tokens[nrule][2],\n                ]\n            );\n\n            if (next_rule_is_additional && new_tokens.length > 1) {\n                // Move 'rule separator' from last token of last rule to first token of this rule.\n                new_tokens[new_tokens.length - 1][0].unshift(new_tokens[new_tokens.length - 2][0].pop());\n            }\n\n            next_rule_is_additional = continue_at === 0 ? false : true;\n\n            var optimal_selector_order = ['year', 'holiday', 'month', 'monthday', 'week', 'weekday'];\n            optimal_selector_order.forEach(function (element) {\n                if (rule[element].length > 0) {\n                    rule.date.push(rule[element]);\n                    rule[element] = [];\n                }\n            });\n\n            // console.log('Rule: ' + JSON.stringify(rule, null, '    '));\n            rules.push(rule);\n\n            /* This handles selectors with time ranges wrapping over midnight (e.g. 10:00-02:00).\n             * It generates wrappers for all selectors and creates a new rule.\n             */\n            if (rule.wraptime.length > 0) {\n                var wrapselectors = {\n                    time: rule.wraptime,\n                    date: [],\n\n                    meaning: rule.meaning,\n                    unknown: rule.unknown,\n                    comment: rule.comment,\n\n                    wrapped: true,\n                    build_from_token_rule: rule.build_from_token_rule,\n                };\n\n                for (var dselg = 0; dselg < rule.date.length; dselg++) {\n                    wrapselectors.date.push([]);\n                    for (var dsel = 0; dsel < rule.date[dselg].length; dsel++) {\n                        wrapselectors.date[wrapselectors.date.length-1].push(\n                                generateDateShifter(rule.date[dselg][dsel], -msec_in_day)\n                            );\n                    }\n                }\n\n                rules.push(wrapselectors);\n            }\n        } while (continue_at);\n    }\n    // console.log(JSON.stringify(tokens, null, '    '));\n    // console.log(JSON.stringify(new_tokens, null, '    '));\n    /* }}} */\n\n    /* Helper functions {{{ */\n    /* Get regex string key from key osm_tag_defaults. {{{\n     *\n     * :param key: Tag key e.g. opening_hours:kitchen.\n     * :returns: Regex key from osm_tag_defaults e.g. opening_hours:.*\n     */\n    function getRegexKeyForKeyFromOsmDefaults(key) {\n        var regex_key;\n        var exact_match = false;\n\n        Object.keys(osm_tag_defaults).forEach(function (osm_key) {\n            if (exact_match === true) {\n                return;\n            }\n            if (key === osm_key) { // Exact match.\n                regex_key = osm_key;\n                // We can't just return here as some old browsers\n                // don't interpret it as a final return (like a loop break)\n                exact_match = true;\n            } else if (new RegExp(osm_key).test(key)) {\n                regex_key = osm_key;\n            }\n        });\n        return regex_key;\n    }\n    /* }}} */\n\n    /* Check given element in optional_conf_parm. {{{\n     *\n     * :param key: Key of optional_conf_parm.\n     * :param expected_type: Expected `typeof()` the parameter.\n     * :returns: True if the expected type matches the given type.\n     */\n    function checkOptionalConfParm(key, expected_type) {\n        if (typeof optional_conf_parm[key] === expected_type) {\n            return true;\n        } else if (typeof optional_conf_parm[key] !== 'undefined') {\n            throw t('conf param unknown type', { 'key': key, 'given': typeof(optional_conf_parm[key]), 'expected': expected_type });\n        }\n        return false;\n    }\n    /* }}} */\n    /* }}} */\n\n    /* Format warning or error message for the user. {{{\n     *\n     * :param nrule: Rule number starting with 0.\n     * :param at: Token position at which the issue occurred.\n     * :param message: Human readable string with the message.\n     * :param tokens_to_use: List of token objects.\n     * :returns: String with position of the warning or error marked for the user.\n     */\n    function formatWarnErrorMessage(nrule, at, message, tokens_to_use) {\n        if (typeof tokens_to_use === 'undefined') {\n            tokens_to_use = tokens;\n        }\n        // console.log(`Called formatWarnErrorMessage: ${nrule}, ${at}, ${message}`);\n        // FIXME: Change to new_tokens.\n        if (typeof nrule === 'number') {\n            var pos = 0;\n            if (nrule === -1) { // Usage of rule index not required because we do have access to value.length.\n                pos = value.length - at;\n            } else { // Issue occurred at a later time, position in string needs to be reconstructed.\n                if (typeof tokens_to_use[nrule][0][at] === 'undefined') {\n                    if (typeof tokens_to_use[nrule][0] && at === -1) {\n                        pos = value.length;\n                        if (typeof tokens_to_use[nrule+1] === 'object' && typeof tokens_to_use[nrule+1][2] === 'number') {\n                            pos -= tokens_to_use[nrule+1][2];\n                        } else if (typeof tokens_to_use[nrule][2] === 'number') {\n                            pos -= tokens_to_use[nrule][2];\n                        }\n                    } else {\n                        // Given position is invalid.\n                        //\n                        formatLibraryBugMessage('Bug in warning generation code which could not determine the exact position of the warning or error in value.');\n                        pos = value.length;\n                        if (typeof tokens_to_use[nrule][2] === 'number') {\n                            // Fallback: Point to last token in the rule which caused the problem.\n                            // Run real_test regularly to fix the problem before a user is confronted with it.\n                            pos -= tokens_to_use[nrule][2];\n                            console.warn('Last token for rule: ' + JSON.stringify(tokens_to_use[nrule]));\n                            console.log(value.substring(0, pos) + ' <--- (' + message + ')');\n                            console.log('\\n');\n                        } {\n                            console.warn('tokens_to_use[nrule][2] is undefined. This is ok if nrule is the last rule.');\n                        }\n                    }\n                } else {\n                    pos = value.length;\n                    if (typeof tokens_to_use[nrule][0][at+1] === 'object') {\n                        pos -= tokens_to_use[nrule][0][at+1][2];\n                    } else if (typeof tokens_to_use[nrule][2] === 'number') {\n                        pos -= tokens_to_use[nrule][2];\n                    }\n                }\n            }\n            return value.substring(0, pos) + ' <--- (' + message + ')';\n        } else if (typeof nrule === 'string') {\n            return nrule.substring(0, at) + ' <--- (' + message + ')';\n        }\n    }\n    /* }}} */\n\n    /* Format internal library error message. {{{\n     *\n     * :param message: Human readable string with the error message.\n     * :param text_template: Message template defined in the `lang` variable to use for the error message. Defaults to 'library bug'.\n     * :returns: Error message for the user.\n     */\n    function formatLibraryBugMessage(message, text_template) {\n        if (typeof message === 'undefined') {\n            message = '';\n        } else {\n            message = ' ' + message;\n        }\n        if (typeof text_template !== 'string') {\n            text_template = 'library bug';\n        }\n\n        message = t(text_template, { 'value': value, 'url': repository_url, 'message': message });\n        console.error(message);\n        return message;\n    } /* }}} */\n\n    /* Tokenize input stream {{{\n     *\n     * :param value: Raw opening_hours value.\n     * :returns: Tokenized list object. Complex structure. Check the\n     *        internal documentation in the docs/ directory for details.\n     */\n    function tokenize(value) {\n        var all_tokens       = [];\n        var curr_rule_tokens = [];\n\n        var last_rule_fallback_terminated = false;\n\n        while (value !== '') {\n            /* Ordered after likelihood of input for performance reasons.\n             * Also, error tolerance is supposed to happen at the end.\n             */\n            // console.log(\"Parsing value: \" + value);\n            var tmp = value.match(/^([a-z]{2,})\\b((?:[.]| before| after)?)/i);\n            var token_from_map = undefined;\n            if (tmp && tmp[2] === '') {\n                token_from_map = string_to_token_map[tmp[1].toLowerCase()];\n            }\n            if (typeof token_from_map === 'object') {\n                curr_rule_tokens.push(token_from_map.concat([value.length]));\n                value = value.substr(tmp[1].length);\n            } else if (tmp = value.match(/^\\s+/)) {\n                // whitespace is ignored\n                value = value.substr(tmp[0].length);\n            } else if (tmp = value.match(/^24\\/7/)) {\n                // Reserved keyword.\n                curr_rule_tokens.push([tmp[0], tmp[0], value.length ]);\n                value = value.substr(tmp[0].length);\n            } else if (/^;/.test(value)) {\n                // semicolon terminates rule.\n                // Next token belong to a new rule.\n                all_tokens.push([ curr_rule_tokens, last_rule_fallback_terminated, value.length ]);\n                value = value.substr(1);\n\n                curr_rule_tokens = [];\n                last_rule_fallback_terminated = false;\n            } else if (/^[:.]/.test(value)) {\n                // Time separator (timesep).\n                if (value[0] === '.' && !done_with_warnings) {\n                    parsing_warnings.push([ -1, value.length - 1, t('hour min separator')]);\n                }\n                curr_rule_tokens.push([ ':', 'timesep', value.length ]);\n                value = value.substr(1);\n            } else if (tmp = value.match(/^(?:PH|SH)/i)) {\n                // special day name (holidays)\n                curr_rule_tokens.push([tmp[0].toUpperCase(), 'holiday', value.length ]);\n                value = value.substr(2);\n            } else if (tmp = value.match(/^[\\u2070-\\u209F\\u00B2\\u00B3\\u00B9]{1,2}/)) {\n                var unicode_code_point_to_digit = {\n                    176: 0,\n                    0x2070: 0,\n                    185: 1,\n                    178: 2,\n                    179: 3,\n                }\n                var regular_number = tmp[0].split('').map(function (ch) {\n                    var code_point = ch.charCodeAt(0);\n                    if (typeof unicode_code_point_to_digit[code_point] === 'number') {\n                        return unicode_code_point_to_digit[code_point];\n                    } else if (0x2074 <= code_point && code_point <= 0x2079) {\n                        return code_point - 0x2070;\n                    } else if (0x2080 <= code_point && code_point <= 0x2089) {\n                        return code_point - 0x2080;\n                    }\n                }).join('');\n                var ok = '';\n                if (curr_rule_tokens.length > 0 && matchTokens(curr_rule_tokens, curr_rule_tokens.length-1, 'number')) {\n                    ok += ':';\n                }\n                ok += regular_number;\n                if (!done_with_warnings) {\n                    for (var i = 0; i <= tmp[0].length; i++) {\n                        if (value.charCodeAt(i) === 176) {\n                            parsing_warnings.push([ -1, value.length - (1 + i),\n                                    t('rant degree sign used for zero')]);\n                        }\n                    }\n                    parsing_warnings.push([ -1, value.length - tmp[0].length,\n                            t('please use ok for ko', {'ko': tmp[0], 'ok': ok})]);\n                }\n                value = ok + value.substr(tmp[0].length);\n            } else if (tmp = value.match(/^(&|_||||||=||ffnungszeit(?:en)?:?|opening_hours\\s*=|\\?|~|||always (?:open|closed)|24x7|24 hours 7 days a week|24 hours|7 ?days(?:(?: a |\\/)week)?|7j?\\/7|all days?|every day|(?:bis|till?|-|)? ?(?:open ?end|late)|(?:(?:one )?day (?:before|after) )?(?:school|public) holidays?|days?\\b||||jours fris|on work days?|sonntags?|(?:nur |an )?sonn-?(?:(?: und |\\/)feiertag(?:s|en?)?)?|(?:an )?feiertag(?:s|en?)?|(?:nach|on|by) (?:appointments?|vereinbarung|absprache)|p\\.m\\.|a\\.m\\.|[_a-z]+\\b|||mo|tu|we|th|fr|sa|su|jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)(\\.?)/i)) {\n                /* Handle all remaining words and specific other characters with error tolerance.\n                 *\n                 * |: Word boundary does not work with Unicode chars: 'test  test'.match(/\\b\\b/i)\n                 * https://stackoverflow.com/questions/10590098/javascript-regexp-word-boundaries-unicode-characters\n                 * Order in the regular expression capturing group is important in some cases.\n                 *\n                 * mo|tu|we|th|fr|sa|su|jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec: Prefer defended keywords\n                 * if used in cases like 'mo12:00-14:00' (when keyword is followed by number).\n                 */\n                var correct_val = returnCorrectWordOrToken(tmp[1].toLowerCase(), value.length);\n                // console.log('Error tolerance for string \"' + tmp[1] + '\" returned \"' + correct_val + '\".');\n                if (typeof correct_val === 'object') {\n                    curr_rule_tokens.push([ correct_val[0], correct_val[1], value.length ]);\n                    value = value.substr(tmp[0].length);\n                } else if (typeof correct_val === 'string') {\n                    if (correct_val === 'am' || correct_val === 'pm') {\n                        var hours_token_at = curr_rule_tokens.length - 1;\n                        var hours_token;\n                        if (hours_token_at >= 0) {\n                            if (hours_token_at -2 >= 0 &&\n                                    matchTokens(\n                                        curr_rule_tokens, hours_token_at - 2,\n                                        'number', 'timesep', 'number'\n                                    )\n                            ) {\n                                hours_token_at -= 2;\n                                hours_token = curr_rule_tokens[hours_token_at];\n                            } else if (matchTokens(curr_rule_tokens, hours_token_at, 'number')) {\n                                hours_token = curr_rule_tokens[hours_token_at];\n                            }\n\n                            if (typeof hours_token === 'object') {\n                                if (correct_val === 'pm' && hours_token[0] < 12) {\n                                    hours_token[0] += 12;\n                                }\n                                if (correct_val === 'am' && hours_token[0] === 12) {\n                                    hours_token[0] = 0;\n                                }\n                                curr_rule_tokens[hours_token_at] = hours_token;\n                            }\n                        }\n                        correct_val = '';\n                    }\n                    var correct_tokens = tokenize(correct_val)[0];\n                    if (correct_tokens[1] === true) { // last_rule_fallback_terminated\n                        throw formatLibraryBugMessage();\n                    }\n                    for (var i = 0; i < correct_tokens[0].length; i++) {\n                        curr_rule_tokens.push([correct_tokens[0][i][0], correct_tokens[0][i][1], value.length]);\n                        // value.length - tmp[0].length does not have the desired effect for all test cases.\n                    }\n\n                    value = value.substr(tmp[0].length);\n                    // value = correct_val + value.substr(tmp[0].length);\n                    // Does not work because it would generate the wrong length for formatWarnErrorMessage.\n                } else {\n                    // No correction available. Insert as single character token and let the parser handle the error.\n                    curr_rule_tokens.push([value[0].toLowerCase(), value[0].toLowerCase(), value.length - 1 ]);\n                    value = value.substr(1);\n                }\n                if (typeof tmp[2] === 'string' && tmp[2] !== '' && !done_with_warnings) {\n                    parsing_warnings.push([ -1, value.length, t('omit ko', {'ko': tmp[2]})]);\n                }\n            } else if (tmp = value.match(/^(\\d+)(?:([.])([^\\d]))?/)) {\n                // number\n                if (Number(tmp[1]) > 1900) { // Assumed to be a year number.\n                    curr_rule_tokens.push([Number(tmp[1]), 'year', value.length ]);\n                    if (Number(tmp[1]) >= 2100) // Probably an error\n                        parsing_warnings.push([ -1, value.length - 1,\n                                t('interpreted as year', {number:  Number(tmp[1])})\n                        ]);\n                } else {\n                    curr_rule_tokens.push([Number(tmp[1]), 'number', value.length ]);\n                }\n\n                value = value.substr(tmp[1].length + (typeof tmp[2] === 'string' ? tmp[2].length : 0));\n                if (typeof tmp[2] === 'string' && tmp[2] !== '' && !done_with_warnings) {\n                    parsing_warnings.push([ -1, value.length, t('omit ko', {'ko': tmp[2]})]);\n                }\n            } else if (/^\\|\\|/.test(value)) {\n                // || terminates rule.\n                // Next token belong to a fallback rule.\n                if (curr_rule_tokens.length === 0) {\n                    throw formatWarnErrorMessage(-1, value.length - 2, t('rule before fallback empty'));\n                }\n\n                all_tokens.push([ curr_rule_tokens, last_rule_fallback_terminated, value.length ]);\n                curr_rule_tokens = [];\n                // curr_rule_tokens = [ [ '||', 'rule separator', value.length  ] ];\n                // FIXME: Use this. Unknown bug needs to be solved in the process.\n                value = value.substr(2);\n\n                last_rule_fallback_terminated = true;\n            } else if (tmp = value.match(/^\"([^\"]+)\"/)) {\n                // Comment following the specification.\n                // Any character is allowed inside the comment except \" itself.\n                curr_rule_tokens.push([tmp[1], 'comment', value.length ]);\n                value = value.substr(tmp[0].length);\n            } else if (tmp = value.match(/^([\"'])([^\"';|]*)([\"'])/)) {\n                // Comments with error tolerance.\n                // The comments still have to be somewhat correct meaning\n                // the start and end quote signs used have to be\n                // appropriate. So testing will not match as it is not a\n                // quote but rather something unknown which the user should\n                // fix first.\n                // console.log('Matched: ' + JSON.stringify(tmp));\n                for (var pos = 1; pos <= 3; pos += 2) {\n                    // console.log('Pos: ' + pos + ', substring: ' + tmp[pos]);\n                    var correct_val = returnCorrectWordOrToken(tmp[pos],\n                        value.length - (pos === 3 ? tmp[1].length + tmp[2].length : 0)\n                    );\n                    if (typeof correct_val !== 'string' && tmp[pos] !== '\"') {\n                        throw formatLibraryBugMessage(\n                            'A character for error tolerance was allowed in the regular expression'\n                            + ' but is not covered by word_error_correction'\n                            + ' which is needed to format a proper message for the user.'\n                        );\n                    }\n                }\n                curr_rule_tokens.push([tmp[2], 'comment', value.length ]);\n                value = value.substr(tmp[0].length);\n            } else if (/^(?:|\\s)/.test(value)) {\n                // Using \"\" as space is not expected to be a normal\n                // mistake. Just ignore it to make using taginfo easier.\n                value = value.substr(1);\n            } else {\n                // other single-character tokens\n                curr_rule_tokens.push([value[0].toLowerCase(), value[0].toLowerCase(), value.length ]);\n                value = value.substr(1);\n            }\n        }\n\n        all_tokens.push([ curr_rule_tokens, last_rule_fallback_terminated ]);\n\n        return all_tokens;\n    }\n    /* }}} */\n\n    /* error correction/tolerance function {{{\n     * Go through word_error_correction hash and get correct value back.\n     *\n     * :param word: Wrong word or character.\n     * :param value_length: Current value_length (used for warnings).\n     * :returns:\n     *        * (valid) opening_hours sub string.\n     *        * object with [ internal_value, token_name ] if value is correct.\n     *        * undefined if word could not be found (and thus is not corrected).\n     */\n    function returnCorrectWordOrToken(word, value_length) {\n        var correctWordOrToken;\n        var token_from_map = string_to_token_map[word];\n        if (typeof token_from_map === 'object') {\n            return token_from_map;\n        }\n        Object.keys(word_error_correction).forEach(function (comment) {\n            if (correctWordOrToken) {\n                return;\n            }\n            Object.keys(word_error_correction[comment]).forEach(function (old_val) {\n                if (correctWordOrToken) {\n                    return;\n                }\n                if (new RegExp('^' + old_val + '$').test(word)) {\n                    var val = word_error_correction[comment][old_val];\n                    // Replace wrong words or characters with correct ones.\n                    // This will return a string which is then being tokenized.\n                    if (!done_with_warnings) {\n                        parsing_warnings.push([\n                            -1,\n                            value_length - word.length,\n                            t(comment, {'ko': word, 'ok': val}),\n                        ]);\n                    }\n                    correctWordOrToken = val;\n                }\n            });\n        });\n        return correctWordOrToken;\n    }\n    /* }}} */\n\n    /* return warnings as list {{{\n     *\n     * :param it: Iterator object if available (optional).\n     * :returns: Warnings as list with one warning per element.\n     */\n    function getWarnings(it) {\n        if (warnings_severity < 4) {\n            return [];\n        }\n\n        if (!done_with_warnings && typeof it === 'object') {\n            /* getWarnings was called in a state without critical errors.\n             * We can do extended tests.\n             */\n\n            /* Place all tests in this function if an additional (high\n             * level) test is added and this does not require to rewrite\n             * big parts of (sub) selector parsers only to get the\n             * position. If that is the case, then rather place the test\n             * code in the (sub) selector parser function directly.\n             */\n\n            var wide_range_selector_order = [ 'year', 'month', 'week', 'holiday' ];\n            var small_range_selector_order = [ 'weekday', 'time', '24/7', 'state', 'comment'];\n\n            // How many times was a selector_type used per rule? {{{\n            var used_selectors = [];\n            var used_selectors_types_array = [];\n            var has_token = {};\n\n            for (var nrule = 0; nrule < new_tokens.length; nrule++) {\n                if (new_tokens[nrule][0].length === 0) continue;\n                // Rule does contain nothing useful e.g. second rule of '10:00-12:00;' (empty) which needs to be handled.\n\n                var selector_start_end_type = [ 0, 0, undefined ];\n                // console.log(new_tokens[nrule][0]);\n\n                used_selectors[nrule] = {};\n                used_selectors_types_array[nrule] = [];\n\n                do {\n                    selector_start_end_type = getSelectorRange(new_tokens[nrule][0], selector_start_end_type[1]);\n                    // console.log(selector_start_end_type, new_tokens[nrule][0].length);\n\n                    for (var token_pos = 0; token_pos <= selector_start_end_type[1]; token_pos++) {\n                        if (typeof new_tokens[nrule][0][token_pos] === 'object' && new_tokens[nrule][0][token_pos][0] === 'PH') {\n                            has_token['PH'] = true;\n                        }\n                    }\n\n                    if (selector_start_end_type[0] === selector_start_end_type[1] &&\n                        new_tokens[nrule][0][selector_start_end_type[0]][0] === '24/7'\n                        ) {\n                            has_token['24/7'] = true;\n                    }\n\n                    if (typeof used_selectors[nrule][selector_start_end_type[2]] !== 'object') {\n                        used_selectors[nrule][selector_start_end_type[2]] = [ selector_start_end_type[1] ];\n                    } else {\n                        used_selectors[nrule][selector_start_end_type[2]].push(selector_start_end_type[1]);\n                    }\n                    used_selectors_types_array[nrule].push(selector_start_end_type[2]);\n\n                    selector_start_end_type[1]++;\n                } while (selector_start_end_type[1] < new_tokens[nrule][0].length);\n            }\n            // console.log('used_selectors: ' + JSON.stringify(used_selectors, null, '    '));\n            // console.log('used_selectors_types_array: ' + JSON.stringify(used_selectors_types_array, null, '    '));\n            /* }}} */\n\n            for (var nrule = 0; nrule < used_selectors.length; nrule++) {\n\n                /* Check if more than one not connected selector of the same type is used in one rule {{{ */\n                Object.keys(used_selectors[nrule]).forEach(function (selector_type) {\n                    // console.log(selector_type + ' use at: ' + used_selectors[nrule][selector_type].length);\n                    if (used_selectors[nrule][selector_type].length > 1) {\n                        parsing_warnings.push([nrule, used_selectors[nrule][selector_type][used_selectors[nrule][selector_type].length - 1],\n                            t('use multi', {\n                                'count': used_selectors[nrule][selector_type].length,\n                                'part2': (\n                                    /^(?:comment|state)/.test(selector_type) ?\n                                        t('selector multi 2a', {'what': (selector_type === 'state' ? t('selector state'): t('comments'))})\n                                        :\n                                        t('selector multi 2b', {'what': t(selector_type + (/^(?:month|weekday)$/.test(selector_type) ? 's' : ' ranges'))})\n                                )\n                            })]\n                        );\n                        done_with_selector_reordering = true; // Correcting the selector order makes no sense if this kind of issue exists.\n                    }\n                });\n                /* }}} */\n                /* Check if change default state rule is not the first rule {{{ */\n                if (   typeof used_selectors[nrule].state === 'object'\n                    && Object.keys(used_selectors[nrule]).length === 1\n                ) {\n                    if (nrule !== 0) {\n                        parsing_warnings.push([nrule, new_tokens[nrule][0].length - 1, t('default state')]);\n                    }\n                /* }}} */\n                /* Check if a rule (with state open) has no time selector {{{ */\n                } else if (typeof used_selectors[nrule].time === 'undefined') {\n                    if (    (       typeof used_selectors[nrule].state === 'object'\n                                && new_tokens[nrule][0][used_selectors[nrule].state[0]][0] === 'open'\n                                && typeof used_selectors[nrule].comment === 'undefined'\n                            ) || ( typeof used_selectors[nrule].comment === 'undefined'\n                                && typeof used_selectors[nrule].state === 'undefined'\n                            ) &&\n                            typeof used_selectors[nrule]['24/7'] === 'undefined'\n                    ) {\n\n                        parsing_warnings.push([nrule, new_tokens[nrule][0].length - 1, t('vague')]);\n                    }\n                }\n                /* }}} */\n                /* Check if empty comment was given {{{ */\n                if (typeof used_selectors[nrule].comment === 'object'\n                    && new_tokens[nrule][0][used_selectors[nrule].comment[0]][0].length === 0\n                ) {\n\n                    parsing_warnings.push([nrule, used_selectors[nrule].comment[0], t('empty comment')]);\n                }\n                /* }}} */\n                /* Check for valid use of <separator_for_readability> {{{ */\n                for (var i = 0; i < used_selectors_types_array[nrule].length - 1; i++) {\n                    var selector_type = used_selectors_types_array[nrule][i];\n                    var next_selector_type = used_selectors_types_array[nrule][i+1];\n                    if (   (   wide_range_selector_order.indexOf(selector_type)       !== -1\n                            && wide_range_selector_order.indexOf(next_selector_type)  !== -1\n                        ) || ( small_range_selector_order.indexOf(selector_type)      !== -1\n                            && small_range_selector_order.indexOf(next_selector_type) !== -1)\n                        ) {\n\n                        if (new_tokens[nrule][0][used_selectors[nrule][selector_type][0]][0] === ':') {\n                            parsing_warnings.push([nrule, used_selectors[nrule][selector_type][0],\n                                t('separator_for_readability')\n                            ]);\n                        }\n                    }\n                }\n                /* }}} */\n                /* Check for missing use of <additional_rule_separator> for time wrapping midnight {{{ */\n                if (typeof rule_infos[nrule] === 'object'\n                        && typeof rule_infos[nrule]['time_wraps_over_midnight'] === 'boolean'\n                        && rule_infos[nrule]['time_wraps_over_midnight'] === true\n                        && typeof used_selectors[nrule+1] === 'object'\n                        && typeof used_selectors[nrule+1]['rule separator'] === 'undefined' // Not an additional rule\n                        && new_tokens[nrule+1][1] === false // Not a fallback rule\n                        ) {\n\n                    var rules_too_complex = [ nrule, nrule+1 ].map(function (nrule){\n                        for (var i = 0; i < wide_range_selector_order.length - 1; i++) {\n                            if (typeof used_selectors[nrule][wide_range_selector_order[i]] === 'object') {\n                                return true;\n                            }\n                        }\n                        return false;\n                    });\n                    var rules_too_complex_count = rules_too_complex.filter(function (el){ return el; }).length;\n                    var next_rule_selects_next_day = false;\n                    if (\n                            typeof rule_infos[nrule] === 'object'\n                            && typeof rule_infos[nrule] === 'object'\n                            && typeof rule_infos[nrule]['week_days'] === 'object'\n                            && typeof rule_infos[nrule+1] === 'object'\n                            && typeof rule_infos[nrule+1]['week_days'] === 'object'\n                            ) {\n                        for (var i = 0; i < rule_infos[nrule]['week_days'].length; i++) {\n                            var week_day = rule_infos[nrule]['week_days'][i];\n                                // console.log(rule_infos[nrule+1]['week_days']);\n                                // console.log(week_day);\n                            if (rule_infos[nrule+1]['week_days'].indexOf(week_day === 6 ? 0 : week_day+1) !== -1) {\n                                next_rule_selects_next_day = true;\n                                break;\n                            }\n                        }\n                    } else {\n                        next_rule_selects_next_day = true;\n                    }\n                    // console.log(rule_infos);\n                    // console.log(next_rule_selects_next_day);\n                    var additional_rule_separator_enabled = (optional_conf_parm||{}).additional_rule_separator !== false;\n                    if (rules_too_complex_count < 2 && next_rule_selects_next_day && additional_rule_separator_enabled) {\n                        parsing_warnings.push([nrule+1, new_tokens[nrule+1][0].length - 1,\n                            t('additional_rule_separator not used after time wrapping midnight'),\n                            new_tokens\n                        ]);\n                    }\n                }\n                /* }}} */\n                /* Check if rule with closed|off modifier is additional {{{ */\n                if (typeof new_tokens[nrule][0][0] === 'object'\n                        && new_tokens[nrule][0][0][0] === ','\n                        && new_tokens[nrule][0][0][1] === 'rule separator'\n                        && typeof used_selectors[nrule].state === 'object'\n                        && (\n                               new_tokens[nrule][0][used_selectors[nrule].state[0]][0] === 'closed'\n                            || new_tokens[nrule][0][used_selectors[nrule].state[0]][0] === 'off'\n                           )\n                ) {\n\n                    parsing_warnings.push([nrule, new_tokens[nrule][0].length - 1,\n                        t('additional rule which evaluates to closed'),\n                        new_tokens\n                    ]);\n                }\n                /* }}} */\n\n            }\n\n            /* Check if 24/7 is used and it does not mean 24/7 because there are other rules {{{ */\n            var has_advanced = it.advance();\n\n            if (has_advanced === true && has_token['24/7'] && !done_with_warnings) {\n                parsing_warnings.push([ -1, 0,\n                    // Probably because of: \"24/7; 12:00-14:00 open\", \". Needs extra testing.\n                    t('strange 24/7')\n                ]);\n            }\n            /* }}} */\n\n            /* Check for missing PH. {{{ */\n            if (    warnings_severity >= 5\n                && !has_token['PH']\n                && !has_token['24/7']\n                && !done_with_warnings\n                && (\n                        (\n                            typeof oh_key === 'string'\n                            && osm_tag_defaults[oh_regex_key]['warn_for_PH_missing']\n                        )\n                        || (typeof oh_key !== 'string')\n                   )\n                ) {\n\n                var keys_with_warn_for_PH_missing = [];\n                Object.keys(osm_tag_defaults).forEach(function (key) {\n                    if (osm_tag_defaults[key]['warn_for_PH_missing']) {\n                        keys_with_warn_for_PH_missing.push(key);\n                    }\n                });\n                parsing_warnings.push([ -1, 0,\n                    t('public holiday', { 'part2': (typeof oh_key !== 'string'\n                        ? t('public holiday part2', {'keys': keys_with_warn_for_PH_missing.join(', ')}) : '')})\n                        // + '(see README how to provide it)' // UI of the evaluation tool does not allow to provide it (currently).\n                ]);\n            }\n            /* }}} */\n\n            /* Check if value consists of multiple rules each only using a time selector {{{ */\n            if (used_selectors_types_array.length > 1\n                    &&  used_selectors_types_array.filter(function (el){\n                            return el.length === 1 && el[0] === 'time';\n                        }).length === used_selectors_types_array.length\n                    ) {\n                parsing_warnings.push([ -1, 0,\n                    t('combine rules', { 'ok': ',' }),\n                ]);\n            }\n            /* }}} */\n\n            prettifyValue();\n        }\n        done_with_warnings = true;\n\n        var warnings = [];\n        // FIXME: Sort based on parsing_warnings[1], tricky \n        for (var i = 0; i < parsing_warnings.length; i++) {\n            warnings.push( formatWarnErrorMessage(parsing_warnings[i][0], parsing_warnings[i][1], parsing_warnings[i][2], parsing_warnings[i][3]) );\n        }\n        return warnings;\n    }\n\n    /* Helpers for getWarnings {{{ */\n\n    /* Check if token is the begin of a selector and why. {{{\n     *\n     * :param tokens: List of token objects.\n     * :param at: Position where to start.\n     * :returns:\n     *        * false if the current token is not the begin of a selector.\n     *        * Position in token array from where the decision was made that\n     *          the token is the start of a selector.\n     */\n    function tokenIsTheBeginOfSelector(tokens, at) {\n        if (typeof tokens[at][3] === 'string') {\n            return 3;\n        } else if (tokens[at][1] === 'comment'\n                || tokens[at][1] === 'state'\n                || tokens[at][1] === '24/7'\n                || tokens[at][1] === 'rule separator'\n            ){\n\n            return 1;\n        } else {\n            return false;\n        }\n    }\n    /* }}} */\n\n    /* Get start and end position of a selector. {{{\n     * For example this value 'Mo-We,Fr' will return the position of the\n     * token lexeme 'Mo' and 'Fr' e.g. there indexes [ 0, 4 ] in the\n     * selector array of tokens.\n     *\n     * :param tokens: List of token objects.\n     * :param at: Position where to start.\n     * :returns: Array:\n     *            0. Index of first token in selector array of tokens.\n     *            1. Index of last token in selector array of tokens.\n     *            2. Selector type.\n     */\n    function getSelectorRange(tokens, at) {\n        var selector_start = at,\n            selector_end,\n            pos_in_token_array;\n\n        for (; selector_start >= 0; selector_start--) {\n            pos_in_token_array = tokenIsTheBeginOfSelector(tokens, selector_start);\n            if (pos_in_token_array) {\n                break;\n            }\n        }\n        selector_end = selector_start;\n\n        if (pos_in_token_array === 1) {\n            // Selector consists of a single token.\n\n            // Include tailing colon.\n            if (selector_end + 1 < tokens.length && tokens[selector_end + 1][0] === ':')\n                selector_end++;\n\n            return [ selector_start, selector_end, tokens[selector_start][pos_in_token_array] ];\n        }\n\n        for (selector_end++; selector_end < tokens.length ; selector_end++) {\n            if (tokenIsTheBeginOfSelector(tokens, selector_end))\n                return [ selector_start, selector_end - 1, tokens[selector_start][pos_in_token_array] ];\n        }\n\n        return [ selector_start, selector_end - 1, tokens[selector_start][pos_in_token_array] ];\n    }\n    /* }}} */\n    /* }}} */\n    /* }}} */\n\n    /* Prettify raw value from user. {{{\n     * The value is generated by putting the tokens back together to a string.\n     *\n     * :param argument_hash: Hash which can contain:\n     *        'conf': Configuration hash.\n     *        'get_internals: If true export internal data structures.\n     *        'rule_index: Only prettify the rule with this index.\n     * :returns: Prettified value string or object if get_internals is true.\n     */\n    function prettifyValue(argument_hash) {\n        var user_conf = {};\n        var get_internals = false;\n        var rule_index;\n\n        prettified_value = '';\n        var prettified_value_array = [];\n\n        if (typeof argument_hash === 'object') {\n            if (typeof argument_hash.conf === 'object') {\n                user_conf = argument_hash.conf;\n            }\n\n            if (typeof argument_hash.rule_index === 'number') {\n                rule_index = argument_hash.rule_index;\n            }\n\n            if (argument_hash.get_internals === true) {\n                get_internals = true;\n            }\n\n        }\n\n        Object.keys(default_prettify_conf).forEach(function (key) {\n            if (typeof user_conf[key] === 'undefined') {\n                user_conf[key] = default_prettify_conf[key];\n            }\n        });\n\n        // use months, weekdays for locales 'en' and 'all'\n        // otherwise use Date.toLocaleString, see https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Date/toLocaleString\n        var _is_en_or_all = user_conf['locale'] === 'en' || user_conf['locale'] === 'all';\n        var months_local = _is_en_or_all ? months : [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12].map(function(month) {\n            return new Date(2018, month - 1, 1).toLocaleString(user_conf['locale'], {month: 'short'});\n        });\n        var weekdays_local = _is_en_or_all ? weekdays : [1, 2, 3, 4, 5, 6, 7].map(function(weekday) {\n            // 2017-01-01 is Sunday\n            return new Date(2017, 0, weekday).toLocaleString(user_conf['locale'], {weekday: 'short'});\n        });\n\n        for (var nrule = 0; nrule < new_tokens.length; nrule++) {\n            if (new_tokens[nrule][0].length === 0) continue;\n            // Rule does contain nothing useful e.g. second rule of '10:00-12:00;' (empty) which needs to be handled.\n\n            if (typeof rule_index === 'number') {\n                if (rule_index !== nrule) continue;\n            } else {\n                if (nrule !== 0)\n                    prettified_value += (\n                        new_tokens[nrule][1]\n                            ? user_conf.rule_sep_string + '|| '\n                            : (\n                                new_tokens[nrule][0][0][1] === 'rule separator'\n                                ? ','\n                                : (\n                                    user_conf.print_semicolon\n                                    ? ';'\n                                    : ''\n                                )\n                            ) +\n                        user_conf.rule_sep_string);\n            }\n\n            var selector_start_end_type = [ 0, 0, undefined ];\n            var prettified_group_value = [];\n            var count = 0;\n            // console.log(new_tokens[nrule][0]);\n\n            do {\n                selector_start_end_type = getSelectorRange(new_tokens[nrule][0], selector_start_end_type[1]);\n                // console.log(selector_start_end_type, new_tokens[nrule][0].length, count);\n\n                if (count > 50) {\n                    throw formatLibraryBugMessage('Infinite loop.');\n                }\n\n                if (selector_start_end_type[2] !== 'rule separator') {\n                    prettified_group_value.push(\n                        [\n                            selector_start_end_type,\n                            prettifySelector(\n                                new_tokens[nrule][0],\n                                selector_start_end_type[0],\n                                selector_start_end_type[1],\n                                selector_start_end_type[2],\n                                user_conf\n                            ),\n                        ]\n                    );\n                }\n\n                selector_start_end_type[1]++;\n                count++;\n                // console.log(selector_start_end_type, new_tokens[nrule][0].length, count);\n            } while (selector_start_end_type[1] < new_tokens[nrule][0].length);\n            // console.log('Prettified value: ' + JSON.stringify(prettified_group_value, null, '    '));\n            var not_sorted_prettified_group_value = prettified_group_value.slice();\n\n            if (!done_with_selector_reordering) {\n                prettified_group_value.sort(\n                    function (a, b) {\n                        var selector_order = [ 'year', 'month', 'week', 'holiday', 'weekday', 'time', '24/7', 'state', 'comment'];\n                        return selector_order.indexOf(a[0][2]) - selector_order.indexOf(b[0][2]);\n                    }\n                );\n            }\n            var old_prettified_value_length = prettified_value.length;\n\n            if (typeof user_conf['locale'] === 'string' && user_conf['locale'] !== 'en') {\n                var translatorFunction;\n                if (i18next.language !== user_conf['locale']) {\n                    translatorFunction = i18next.getFixedT(user_conf['locale']);\n                } else {\n                    translatorFunction = i18next.t;\n                }\n                for (var i = 0; i < prettified_group_value.length; i++) {\n                    var type = prettified_group_value[i][0][2];\n                    if (type === 'weekday') {\n                        weekdays.forEach(function (weekday, key) {\n                            prettified_group_value[i][1] = prettified_group_value[i][1].replace(new RegExp(weekday, 'g'), weekdays_local[key]);\n                        });\n                    } else if (type === 'month') {\n                        months.forEach(function (month, key) {\n                            prettified_group_value[i][1] = prettified_group_value[i][1].replace(new RegExp(month, 'g'), months_local[key]);\n                        });\n                    } else {\n                        var prettifiedValueIsProbablyTranslatable = prettified_group_value[i][1].indexOf(':') === -1;\n                        if (prettifiedValueIsProbablyTranslatable) {\n                            prettified_group_value[i][1] = translatorFunction(['opening_hours:pretty.' + prettified_group_value[i][1], prettified_group_value[i][1]]);\n                        }\n                    }\n                }\n            }\n\n            prettified_value += prettified_group_value.map(function (array) {\n                return array[1];\n            }).join(' ');\n\n            prettified_value_array.push( prettified_group_value );\n\n            if (!done_with_selector_reordering_warnings) {\n                for (var i = 0, l = not_sorted_prettified_group_value.length; i < l; i++) {\n                    if (not_sorted_prettified_group_value[i] !== prettified_group_value[i]) {\n                        // console.log(i + ': ' + prettified_group_value[i][0][2]);\n                        var length = i + old_prettified_value_length; // i: Number of spaces in string.\n                        for (var x = 0; x <= i; x++) {\n                            length += prettified_group_value[x][1].length;\n                            // console.log('Length: ' + length + ' ' + prettified_group_value[x][1]);\n                        }\n                        // console.log(length);\n                        parsing_warnings.push([ prettified_value, length, t('switched', {\n                            'first': prettified_group_value[i][0][2],\n                            'second': not_sorted_prettified_group_value[i][0][2]\n                        })\n                        ]);\n                    }\n                }\n            }\n        }\n\n        done_with_selector_reordering_warnings = true;\n        // console.log(JSON.stringify(prettified_value_array, null, '    '));\n\n        if (get_internals) {\n            return [ prettified_value_array, new_tokens ];\n        } else {\n            return prettified_value;\n        }\n    }\n    /* }}} */\n\n    /* Check selector array of tokens for specific token name pattern. {{{\n     *\n     * :param tokens: List of token objects.\n     * :param at: Position at which the matching should begin.\n     * :param token_name(s): One or many token_name strings which have to match in that order.\n     * :returns: true if token_name(s) match in order false otherwise.\n     */\n    function matchTokens(tokens, at /*, matches... */) {\n        if (at + arguments.length - 2 > tokens.length)\n            return false;\n        for (var i = 0; i < arguments.length - 2; i++) {\n            if (tokens[at + i][1] !== arguments[i + 2]) {\n                return false;\n            }\n        }\n\n        return true;\n    }\n    /* }}} */\n\n    /* Generate selector wrapper with time offset {{{\n     *\n     * :param func: Generated selector code function.\n     * :param shirt: Time to shift in milliseconds.\n     * :param token_name(s): One or many token_name strings which have to match in that order.\n     * :returns: See selector code.\n     */\n    function generateDateShifter(func, shift) {\n        return function(date) {\n            var res = func(new Date(date.getTime() + shift));\n\n            if (typeof res[1] === 'undefined')\n                return res;\n            return [ res[0], new Date(res[1].getTime() - shift) ];\n        };\n    }\n    /* }}} */\n\n    /* Top-level parser {{{\n     *\n     * :param tokens: List of token objects.\n     * :param at: Position where to start.\n     * :param rule: Reference to rule object.\n     * :param nrule: Rule number starting with 0.\n     * :returns: See selector code.\n     */\n    function parseGroup(tokens, at, rule, nrule) {\n        var rule_modifier_specified = false;\n\n        // console.log(tokens); // useful for debugging of tokenize\n        var last_selector = [];\n        while (at < tokens.length) {\n            // console.log('Parsing at position', at +':', tokens[at]);\n            if (matchTokens(tokens, at, 'weekday')) {\n                at = parseWeekdayRange(tokens, at, rule, undefined, nrule);\n            } else if (matchTokens(tokens, at, '24/7')) {\n                rule.time.push(function() { return [true]; });\n                // Not needed. If there is no selector it automatically matches everything.\n                // WRONG: This only works if there is no other selector in this selector group ...\n                at++;\n            } else if (matchTokens(tokens, at, 'holiday')) {\n                if (matchTokens(tokens, at+1, ',')) {\n                    at = parseHoliday(tokens, at, rule, true);\n                } else {\n                    at = parseHoliday(tokens, at, rule, false);\n                }\n                week_stable = false;\n            } else if (matchTokens(tokens, at, 'month', 'number')\n                    || matchTokens(tokens, at, 'month', 'weekday')\n                    || matchTokens(tokens, at, 'year', 'month', 'number')\n                    || matchTokens(tokens, at, 'year', 'event')\n                    || matchTokens(tokens, at, 'event')) {\n\n                at = parseMonthdayRange(tokens, at, nrule);\n                week_stable = false;\n            } else if (matchTokens(tokens, at, 'year')) {\n                at = parseYearRange(tokens, at);\n                week_stable = false;\n            } else if (matchTokens(tokens, at, 'month')) {\n                at = parseMonthRange(tokens, at);\n                // week_stable = false; // Decided based on the actual value/tokens.\n            } else if (matchTokens(tokens, at, 'week')) {\n                tokens[at][3] = 'week';\n                at = parseWeekRange(tokens, at);\n\n            } else if (at !== 0 && at !== tokens.length - 1 && tokens[at][0] === ':'\n                && !(typeof last_selector[1] === 'string' && last_selector[1] === 'time')) {\n                /* Ignore colon if they appear somewhere else than as time separator.\n                 * Except the start or end of the value.\n                 * This provides compatibility with the syntax proposed by Netzwolf:\n                 * https://wiki.openstreetmap.org/wiki/Key:opening_hours/specification#separator_for_readability\n                 * Check for valid use of <separator_for_readability> is implemented in function getWarnings().\n                 */\n\n                if (!done_with_warnings && matchTokens(tokens, at-1, 'holiday')) {\n                    parsing_warnings.push([nrule, at, t('no colon after', { 'token': tokens[at-1][1] })]);\n                }\n\n                at++;\n            } else if (matchTokens(tokens, at, 'number', 'timesep')\n                    || matchTokens(tokens, at, 'timevar')\n                    || matchTokens(tokens, at, '(', 'timevar')\n                    || matchTokens(tokens, at, 'number', '-')) {\n\n                at = parseTimeRange(tokens, at, rule, false, nrule);\n                last_selector = [ at, 'time' ];\n\n            } else if (matchTokens(tokens, at, 'state')) {\n\n                if (tokens[at][0] === 'open') {\n                    rule.meaning = true;\n                } else if (tokens[at][0] === 'closed' || tokens[at][0] === 'off') {\n                    rule.meaning = false;\n                } else {\n                    rule.meaning = false;\n                    rule.unknown = true;\n                }\n\n                rule_modifier_specified = true;\n                at++;\n                if (typeof tokens[at] === 'object' && tokens[at][0] === ',') // additional rule\n                    at = [ at + 1 ];\n\n            } else if (matchTokens(tokens, at, 'comment')) {\n                rule.comment = tokens[at][0];\n                if (!rule_modifier_specified) {\n                    // Then it is unknown. Either with unknown explicitly\n                    // specified or just a comment.\n                    rule.meaning = false;\n                    rule.unknown = true;\n                }\n\n                rule_modifier_specified = true;\n                at++;\n                if (typeof tokens[at] === 'object' && tokens[at][0] === ',') { // additional rule\n                    at = [ at + 1 ];\n                }\n            } else if ((at === 0 || at === tokens.length - 1) && matchTokens(tokens, at, 'rule separator')) {\n                at++;\n                // console.log(\"value: \" + nrule);\n                // throw formatLibraryBugMessage('Not implemented yet.');\n            } else {\n                var warnings = getWarnings();\n                throw formatWarnErrorMessage(nrule, at, t('unexpected token', {token: tokens[at][1] })) + (warnings ? (' ' + warnings.join('; ')) : '');\n            }\n\n            if (typeof at === 'object') { // additional rule\n                tokens[at[0] - 1][1] = 'rule separator';\n                break;\n            }\n            if (typeof last_selector[0] === 'number' && last_selector[0] !== at) {\n                last_selector = [];\n            }\n        }\n\n        return at;\n    }\n\n    /* Not used\n    function get_last_token_pos_in_token_group(tokens, at, last_at) {\n        for (at++; at < last_at; at++) {\n            if (typeof tokens[at] === 'object') {\n                if (typeof tokens[at][3] === 'string'\n                        || tokens[at][1] === 'comment'\n                        || tokens[at][1] === 'state'){\n\n                        return at - 1;\n                }\n            }\n        }\n        return last_at;\n    }\n    */\n\n    /* }}} */\n\n    // helper functions for sub parser {{{\n\n    /* For given date, returns date moved to the start of the day with an offset specified in minutes. {{{\n     * For example, if date is 2014-05-19_18:17:12, dateAtDayMinutes would\n     * return 2014-05-19_02:00:00 for minutes=120.\n     *\n     * :param date: Date object.\n     * :param minutes: Minutes used as offset starting from midnight of current day.\n     * :returns: Moved date object.\n     */\n    function dateAtDayMinutes(date, minutes) {\n        return new Date(date.getFullYear(), date.getMonth(), date.getDate(), 0, minutes);\n    }\n    /* }}} */\n\n    /* For given date, returns date moved to the specific day of week {{{\n     *\n     * :param date: Date object.\n     * :param weekday: Integer number for day of week. Starting with zero (Sunday).\n     * :returns: Moved date object.\n     */\n    function dateAtNextWeekday(date, weekday) {\n        var delta = weekday - date.getDay();\n        return new Date(date.getFullYear(), date.getMonth(), date.getDate() + delta + (delta < 0 ? 7 : 0));\n    }\n    /* }}} */\n\n    /* Numeric list parser (1,2,3-4,-1) {{{\n     * Used in weekday parser above.\n     *\n     * :param tokens: List of token objects.\n     * :param at: Position where to start.\n     * :param func: Function func(from, to, at).\n     * :returns: Position at which the token does not belong to the list any more.\n     */\n    function parseNumRange(tokens, at, func) {\n        for (; at < tokens.length; at++) {\n            if (matchTokens(tokens, at, 'number', '-', 'number')) {\n                // Number range\n                func(tokens[at][0], tokens[at+2][0], at);\n                at += 3;\n            } else if (matchTokens(tokens, at, '-', 'number')) {\n                // Negative number\n                func(-tokens[at+1][0], -tokens[at+1][0], at);\n                at += 2;\n            } else if (matchTokens(tokens, at, 'number')) {\n                // Single number\n                func(tokens[at][0], tokens[at][0], at);\n                at++;\n            } else {\n                throw formatWarnErrorMessage(nrule, at + matchTokens(tokens, at, '-'),\n                    'Unexpected token in number range: ' + tokens[at][1]);\n            }\n\n            if (!matchTokens(tokens, at, ','))\n                break;\n        }\n\n        return at;\n    }\n    /* }}} */\n\n    /* List parser for constrained weekdays in month range {{{\n     * e.g. Su[-1] which selects the last Sunday of the month.\n     *\n     * :param tokens: List of token objects.\n     * :param at: Position where to start.\n     * :returns: Array:\n     *            0. Constrained weekday number.\n     *            1. Position at which the token does not belong to the list any more (after ']' token).\n     */\n    function getConstrainedWeekday(tokens, at) {\n        var number = 0;\n        var endat = parseNumRange(tokens, at, function(from, to, at) {\n\n            // bad number\n            if (from === 0 || from < -5 || from > 5)\n                throw formatWarnErrorMessage(nrule, at,\n                    t('number -5 to 5'));\n\n            if (from === to) {\n                if (number !== 0)\n                    throw formatWarnErrorMessage(nrule, at,\n                        t('one weekday constraint'));\n                number = from;\n            } else {\n                throw formatWarnErrorMessage(nrule, at+2,\n                    t('range constrained weekdays'));\n            }\n        });\n        for (var i = at; i < endat; i++) {\n            tokens[i][4] = 'positive_number';\n        }\n\n        if (!matchTokens(tokens, endat, ']'))\n            throw formatWarnErrorMessage(nrule, endat, t('expected', {symbol: ']'}));\n\n        return [ number, endat + 1 ];\n    }\n    /* }}} */\n\n    // Check if period is ok. Period 0 or 1 dont make much sense.\n    function checkPeriod(at, period, period_type, parm_string) {\n        if (done_with_warnings)\n            return;\n\n        if (period === 0) {\n            throw formatWarnErrorMessage(nrule, at,\n                t('range zero', { 'type': period_type }));\n        } else if (period === 1) {\n            if (typeof parm_string === 'string' && parm_string === 'no_end_year')\n                parsing_warnings.push([nrule, at, t('period one year+', {'type': period_type})]);\n            else\n                parsing_warnings.push([nrule, at, t('period one', {'type': period_type})]);\n        }\n    }\n\n    /* Get date moved to constrained weekday (and moved for add_days. {{{\n     * E.g. used for 'Aug Su[-1] -1 day'.\n     *\n     * :param year: Year as integer.\n     * :param month: Month as integer starting with zero.\n     * :param weekday: Integer number for day of week. Starting with zero (Sunday).\n     * :param constrained_weekday: Position where to start.\n     * :returns: Date object.\n     */\n    function getDateForConstrainedWeekday(year, month, weekday, constrained_weekday, add_days) {\n        var tmp_date = dateAtNextWeekday(\n            new Date(year, month + (constrained_weekday[0] > 0 ? 0 : 1), 1), weekday);\n\n        tmp_date.setDate(tmp_date.getDate() + (constrained_weekday[0] + (constrained_weekday[0] > 0 ? -1 : 0)) * 7);\n\n        if (typeof add_days === 'object' && add_days[1])\n            tmp_date.setDate(tmp_date.getDate() + add_days[0]);\n\n        return tmp_date;\n    }\n    /* }}} */\n\n    /* Check if date is valid. {{{\n     *\n     * :param month: Month as integer starting with zero.\n     * :param date: Day of month as integer.\n     * :param nrule: Rule number starting with 0.\n     * :param at: Position at which the matching should begin.\n     * :returns: undefined. There is no real return value. This function just throws an exception if something is wrong.\n     */\n    function checkIfDateIsValid(month, day, nrule, at) {\n        // May use this instead. The problem is that this does not give feedback as precise as the code which is used in this function.\n        // var testDate = new Date(year, month, day);\n        // if (testDate.getDate() !== day || testDate.getMonth() !== month || testDate.getFullYear() !== year) {\n        //     console.error('date not valid');\n        // }\n\n        // https://en.wikipedia.org/wiki/Month#Julian_and_Gregorian_calendars\n        if (day < 1 || day > 31) {\n            throw formatWarnErrorMessage(nrule, at, t('month 31', {'month': months[month]}));\n        } else if ((month === 3 || month === 5 || month === 8 || month === 10) && day === 31) {\n            throw formatWarnErrorMessage(nrule, at, t('month 30', {'month': months[month]}));\n        } else if (month === 1 && day === 30) {\n            throw formatWarnErrorMessage(nrule, at, t('month feb', {'month': months[month]}));\n        }\n    }\n    /* }}} */\n    /* }}} */\n\n    /* Time range parser (10:00-12:00,14:00-16:00) {{{\n     *\n     * :param tokens: List of token objects.\n     * :param at: Position where to start.\n     * :param rule: Reference to rule object.\n     * :param extended_open_end: Used for combined time range with open end.\n     * :param nrule: Rule number starting with 0.\n     * extended_open_end: <time> - <time> +\n     *        parameter at is here A (if extended_open_end is true)\n     * :returns: Position at which the token does not belong to the selector anymore.\n     */\n    function parseTimeRange(tokens, at, rule, extended_open_end, nrule) {\n        if (!extended_open_end)\n            tokens[at][3] = 'time';\n\n        for (; at < tokens.length; at++) {\n            var has_time_var_calc = [], has_normal_time = []; // element 0: start time, 1: end time\n                has_normal_time[0]   = matchTokens(tokens, at, 'number', 'timesep', 'number');\n                has_time_var_calc[0] = matchTokens(tokens, at, '(', 'timevar');\n            var minutes_from,\n                minutes_to;\n            if (has_normal_time[0] || matchTokens(tokens, at, 'timevar') || has_time_var_calc[0]) {\n                // relying on the fact that always *one* of them is true\n\n                var is_point_in_time = false; // default no time range\n                var has_open_end     = false; // default no open end\n                var timevar_add      = [ 0, 0 ];\n                var timevar_string   = [];    // capture timevar string like 'sunrise' to calculate it for the current date.\n                var point_in_time_period;\n\n                // minutes_from\n                if (has_normal_time[0]) {\n                    minutes_from = getMinutesByHoursMinutes(tokens, nrule, at+has_time_var_calc[0]);\n                } else {\n                    timevar_string[0] = tokens[at+has_time_var_calc[0]][0];\n                    minutes_from = word_value_replacement[timevar_string[0]];\n\n                    if (has_time_var_calc[0]) {\n                        timevar_add[0] = parseTimevarCalc(tokens, at);\n                        minutes_from += timevar_add[0];\n                    }\n                }\n\n                var at_end_time = at+(has_normal_time[0] ? 3 : (has_time_var_calc[0] ? 7 : 1))+1; // after '-'\n                if (!matchTokens(tokens, at_end_time - 1, '-')) { // not time range\n                    if (matchTokens(tokens, at_end_time - 1, '+')) {\n                        has_open_end = true;\n                    } else {\n                        if (oh_mode === 0) {\n                            throw formatWarnErrorMessage(nrule,\n                                at+(\n                                    has_normal_time[0] ? (\n                                        typeof tokens[at+3] === 'object' ? 3 : 2\n                                    ) : (\n                                        has_time_var_calc[0] ? 2 : (\n                                                typeof tokens[at+1] === 'object' ? 1 : 0\n                                            )\n                                    )\n                                ),\n                                t('point in time', {\n                                    'calc': (has_time_var_calc[0] ? t('calculation') + ' ' : ''),\n                                    'libraryname': library_name\n                                }));\n                        } else {\n                            minutes_to = minutes_from + 1;\n                            is_point_in_time = true;\n                        }\n                    }\n                }\n\n                // minutes_to\n                if (has_open_end) {\n                    if (extended_open_end === 1) {\n                        minutes_from += minutes_in_day;\n                    }\n                    if (minutes_from >= 22 * 60) {\n\n                        minutes_to = minutes_from +  8 * 60;\n                    } else if (minutes_from >= 17 * 60) {\n                        minutes_to = minutes_from + 10 * 60;\n                    } else {\n                        minutes_to = minutes_in_day;\n                    }\n                } else if (!is_point_in_time) {\n                    has_normal_time[1] = matchTokens(tokens, at_end_time, 'number', 'timesep', 'number');\n                    has_time_var_calc[1]      = matchTokens(tokens, at_end_time, '(', 'timevar');\n                    if (!has_normal_time[1] && !matchTokens(tokens, at_end_time, 'timevar') && !has_time_var_calc[1]) {\n                        throw formatWarnErrorMessage(nrule, at_end_time - (typeof tokens[at_end_time] === 'object' ? 0 : 1),\n                                t('time range continue'));\n                    } else {\n                        if (has_normal_time[1]) {\n                            minutes_to = getMinutesByHoursMinutes(tokens, nrule, at_end_time);\n                        } else {\n                            timevar_string[1] = tokens[at_end_time+has_time_var_calc[1]][0];\n                            minutes_to = word_value_replacement[timevar_string[1]];\n                        }\n\n                        if (has_time_var_calc[1]) {\n                            timevar_add[1] = parseTimevarCalc(tokens, at_end_time);\n                            minutes_to += timevar_add[1];\n                        }\n                    }\n                }\n\n                at = at_end_time + (is_point_in_time ? -1 :\n                        (has_normal_time[1] ? 3 : (has_time_var_calc[1] ? 7 : !has_open_end))\n                    );\n\n                if (matchTokens(tokens, at, '/', 'number')) {\n                    if (matchTokens(tokens, at + 2, 'timesep', 'number')) { // /hours:minutes\n                        point_in_time_period = getMinutesByHoursMinutes(tokens, nrule, at + 1);\n                        at += 4;\n                    } else { // /minutes\n                        point_in_time_period = tokens[at + 1][0];\n                        at += 2;\n                        if (matchTokens(tokens, at, 'timesep'))\n                            throw formatWarnErrorMessage(nrule, at,\n                                t('period continue'));\n                    }\n\n                    // Check at this later state in the if condition to get the correct position.\n                    if (oh_mode === 0) {\n                        throw formatWarnErrorMessage(nrule, at - 1,\n                            t('time range mode', {'libraryname': library_name}));\n                    }\n\n                    is_point_in_time = true;\n                } else if (matchTokens(tokens, at, '+')) {\n                    parseTimeRange(tokens, at_end_time, rule, minutes_to < minutes_from ? 1 : true, nrule);\n                    at++;\n                } else if (oh_mode === 1 && !is_point_in_time) {\n                    throw formatWarnErrorMessage(nrule, at_end_time,\n                        t('point in time mode', {'libraryname': library_name}));\n                }\n\n                if (typeof lat === 'string') { // lon will also be defined (see above)\n                    if (!has_normal_time[0] || !(has_normal_time[1] || has_open_end || is_point_in_time) ) {\n                        week_stable = false;\n                    }\n                } else { // we can not calculate exact times so we use the already applied constants (word_value_replacement).\n                    timevar_string = [];\n                }\n\n                // Normalize minutes into range.\n                if (!extended_open_end && minutes_from >= minutes_in_day) {\n                    throw formatWarnErrorMessage(nrule, at_end_time - 2,\n                        t('outside current day'));\n                }\n                if (minutes_to < minutes_from || ((has_normal_time[0] && has_normal_time[1]) && minutes_from === minutes_to)) {\n                    minutes_to += minutes_in_day;\n                }\n                if (minutes_to > minutes_in_day * 2) {\n                    throw formatWarnErrorMessage(nrule, at_end_time + (has_normal_time[1] ? 4 : (has_time_var_calc[1] ? 7 : 1)) - 2,\n                        t('two midnights'));\n                }\n\n                // This shortcut makes always-open range check faster.\n                if (minutes_from === 0 && minutes_to === minutes_in_day) {\n                    rule.time.push(function() { return [true]; });\n                } else {\n                    if (minutes_to > minutes_in_day) { // has_normal_time[1] must be true\n                        rule.time.push(function(minutes_from, minutes_to, timevar_string, timevar_add, has_open_end, is_point_in_time, point_in_time_period, extended_open_end) { return function(date) {\n                            var ourminutes = date.getHours() * 60 + date.getMinutes();\n\n                            if (timevar_string[0]) {\n                                var date_from = SunCalc.getTimes(date, lat, lon)[timevar_string[0]];\n                                minutes_from  = date_from.getHours() * 60 + date_from.getMinutes() + timevar_add[0];\n                            }\n                            if (timevar_string[1]) {\n                                var date_to = SunCalc.getTimes(date, lat, lon)[timevar_string[1]];\n                                minutes_to  = date_to.getHours() * 60 + date_to.getMinutes() + timevar_add[1];\n                                minutes_to += minutes_in_day;\n                                // Needs to be added because it was added by\n                                // normal times: if (minutes_to < minutes_from)\n                                // above the selector construction.\n                            } else if (is_point_in_time && typeof point_in_time_period !== 'number') {\n                                minutes_to = minutes_from + 1;\n                            }\n\n                            if (typeof point_in_time_period === 'number') {\n                                if (ourminutes < minutes_from) {\n                                    return [false, dateAtDayMinutes(date, minutes_from)];\n                                } else if (ourminutes <= minutes_to) {\n                                    for (var cur_min = minutes_from; ourminutes + point_in_time_period >= cur_min; cur_min += point_in_time_period) {\n                                        if (cur_min === ourminutes) {\n                                            return [true, dateAtDayMinutes(date, ourminutes + 1)];\n                                        } else if (ourminutes < cur_min) {\n                                            return [false, dateAtDayMinutes(date, cur_min)];\n                                        }\n                                    }\n                                }\n                                return [false, dateAtDayMinutes(date, minutes_in_day)];\n                            } else {\n                                if (ourminutes < minutes_from)\n                                    return [false, dateAtDayMinutes(date, minutes_from)];\n                                else\n                                    return [true, dateAtDayMinutes(date, minutes_to), has_open_end, extended_open_end];\n                            }\n                        }}(minutes_from, minutes_to, timevar_string, timevar_add, has_open_end, is_point_in_time, point_in_time_period, extended_open_end));\n\n                        if (minutes_to - minutes_in_day > 0) {\n                            if (typeof rule_infos[nrule] === 'undefined') {\n                                rule_infos[nrule] = {};\n                            }\n                            rule_infos[nrule]['time_wraps_over_midnight'] = true;\n                            rule.wraptime.push(function(minutes_to, timevar_string, timevar_add, has_open_end, point_in_time_period, extended_open_end) { return function(date) {\n                                var ourminutes = date.getHours() * 60 + date.getMinutes();\n\n                                if (timevar_string[1]) {\n                                    var date_to = SunCalc.getTimes(date, lat, lon)[timevar_string[1]];\n                                    minutes_to  = date_to.getHours() * 60 + date_to.getMinutes() + timevar_add[1];\n                                    // minutes_in_day does not need to be added.\n                                    // For normal times in it was added in: if (minutes_to < // minutes_from)\n                                    // above the selector construction and\n                                    // subtracted in the selector construction call\n                                    // which returns the selector function.\n                                }\n\n                                if (typeof point_in_time_period === 'number') {\n                                    if (ourminutes <= minutes_to) {\n                                        for (var cur_min = 0; ourminutes + point_in_time_period >= cur_min; cur_min += point_in_time_period) {\n                                            if (cur_min === ourminutes) {\n                                                return [true, dateAtDayMinutes(date, ourminutes + 1)];\n                                            } else if (ourminutes < cur_min) {\n                                                return [false, dateAtDayMinutes(date, cur_min)];\n                                            }\n                                        }\n                                    }\n                                } else {\n                                    if (ourminutes < minutes_to)\n                                        return [true, dateAtDayMinutes(date, minutes_to), has_open_end, extended_open_end];\n                                }\n                                return [false, undefined];\n                            }}(minutes_to - minutes_in_day, timevar_string, timevar_add, has_open_end, point_in_time_period, extended_open_end));\n                        }\n                    } else {\n                        rule.time.push(function(minutes_from, minutes_to, timevar_string, timevar_add, has_open_end, is_point_in_time, point_in_time_period) { return function(date) {\n                            var ourminutes = date.getHours() * 60 + date.getMinutes();\n\n                            if (timevar_string[0]) {\n                                var date_from = SunCalc.getTimes(date, lat, lon)[timevar_string[0]];\n                                minutes_from  = date_from.getHours() * 60 + date_from.getMinutes() + timevar_add[0];\n                            }\n                            if (timevar_string[1]) {\n                                var date_to = SunCalc.getTimes(date, lat, lon)[timevar_string[1]];\n                                minutes_to  = date_to.getHours() * 60 + date_to.getMinutes() + timevar_add[1];\n                            } else if (is_point_in_time && typeof point_in_time_period !== 'number') {\n                                minutes_to = minutes_from + 1;\n                            }\n\n                            if (typeof point_in_time_period === 'number') {\n                                if (ourminutes < minutes_from) {\n                                    return [false, dateAtDayMinutes(date, minutes_from)];\n                                } else if (ourminutes <= minutes_to) {\n                                    for (var cur_min = minutes_from; ourminutes + point_in_time_period >= cur_min; cur_min += point_in_time_period) {\n                                        if (cur_min === ourminutes) {\n                                            return [true, dateAtDayMinutes(date, ourminutes + 1)];\n                                        } else if (ourminutes < cur_min) {\n                                            return [false, dateAtDayMinutes(date, cur_min)];\n                                        }\n                                    }\n                                }\n                                return [false, dateAtDayMinutes(date, minutes_in_day)];\n                            } else {\n                                if (ourminutes < minutes_from)\n                                    return [false, dateAtDayMinutes(date, minutes_from)];\n                                else if (ourminutes < minutes_to)\n                                    return [true, dateAtDayMinutes(date, minutes_to), has_open_end];\n                                else\n                                    return [false, dateAtDayMinutes(date, minutes_from + minutes_in_day)];\n                            }\n                        }}(minutes_from, minutes_to, timevar_string, timevar_add, has_open_end, is_point_in_time, point_in_time_period));\n                    }\n                }\n\n            } else if (matchTokens(tokens, at, 'number', '-', 'number')) { // \"Mo 09-18\" (Please dont use this) -> \"Mo 09:00-18:00\".\n                minutes_from = tokens[at][0]   * 60;\n                minutes_to   = tokens[at+2][0] * 60;\n                if (!done_with_warnings) {\n                    parsing_warnings.push([nrule, at + 2, t('without minutes', {\n                        'syntax': (tokens[at][0]   < 10 ? '0' : '') + tokens[at][0]   + ':00-'\n                                + (tokens[at+2][0] < 10 ? '0' : '') + tokens[at+2][0] + ':00'\n                    })]);\n                }\n\n                if (minutes_from >= minutes_in_day)\n                    throw formatWarnErrorMessage(nrule, at, t('outside day'));\n                if (minutes_to < minutes_from)\n                    minutes_to += minutes_in_day;\n                if (minutes_to > minutes_in_day * 2)\n                    throw formatWarnErrorMessage(nrule, at + 2, t('two midnights'));\n\n                if (minutes_to > minutes_in_day) {\n                    rule.time.push(function(minutes_from, minutes_to) { return function(date) {\n                        var ourminutes = date.getHours() * 60 + date.getMinutes();\n\n                        if (ourminutes < minutes_from)\n                            return [false, dateAtDayMinutes(date, minutes_from)];\n                        else\n                            return [true, dateAtDayMinutes(date, minutes_to)];\n                    }}(minutes_from, minutes_to));\n\n                    if (minutes_to - minutes_in_day > 0) {\n                        if (typeof rule_infos[nrule] === 'undefined') {\n                            rule_infos[nrule] = {};\n                        }\n                        rule_infos[nrule]['time_wraps_over_midnight'] = true;\n                        rule.wraptime.push(function(minutes_to) { return function(date) {\n                            var ourminutes = date.getHours() * 60 + date.getMinutes();\n\n                            if (ourminutes < minutes_to) {\n                                return [true, dateAtDayMinutes(date, minutes_to)];\n                            } else {\n                                return [false, undefined];\n                            }\n                        }}(minutes_to - minutes_in_day));\n                    }\n                } else {\n                    rule.time.push(function(minutes_from, minutes_to) { return function(date) {\n                        var ourminutes = date.getHours() * 60 + date.getMinutes();\n\n                        if (ourminutes < minutes_from)\n                            return [false, dateAtDayMinutes(date, minutes_from)];\n                        else if (ourminutes < minutes_to)\n                            return [true, dateAtDayMinutes(date, minutes_to), has_open_end];\n                        else\n                            return [false, dateAtDayMinutes(date, minutes_from + minutes_in_day)];\n                    }}(minutes_from, minutes_to));\n                }\n\n                at += 3;\n            } else { // additional rule\n                if (matchTokens(tokens, at, '('))\n                    throw formatWarnErrorMessage(nrule, at, 'Missing variable time (e.g. sunrise) after: \"' + tokens[at][1] + '\"');\n                if (matchTokens(tokens, at, 'number', 'timesep'))\n                    throw formatWarnErrorMessage(nrule, at+1, 'Missing minutes in time range after: \"' + tokens[at+1][1] + '\"');\n                if (matchTokens(tokens, at, 'number'))\n                    throw formatWarnErrorMessage(nrule, at + (typeof tokens[at+1] === 'object' ? 1 : 0),\n                            'Missing time separator in time range after: \"' + tokens[at][1] + '\"');\n                return [ at ];\n            }\n\n            if (!matchTokens(tokens, at, ',')) {\n                break;\n            }\n\n            if (typeof tokens[at+1] === 'undefined' && !done_with_warnings) {\n                parsing_warnings.push([nrule, at, t('value ends with token', { 'token': tokens[at][1] }) ]);\n            }\n        }\n\n        return at;\n    }\n    /* }}} */\n\n    /* Helpers for time range parser {{{ */\n\n    /* Get time in minutes from <hour>:<minute> (tokens). {{{\n     * Only used if throwing an error is wanted.\n     *\n     * :param tokens: List of token objects.\n     * :param nrule: Rule number starting with 0.\n     * :param at: Position at which the time begins.\n     * :returns: Time in minutes.\n     */\n    function getMinutesByHoursMinutes(tokens, nrule, at) {\n        if (tokens[at+2][0] > 59)\n            throw formatWarnErrorMessage(nrule, at+2,\n                    'Minutes are greater than 59.');\n        return tokens[at][0] * 60 + tokens[at+2][0];\n    }\n    /* }}} */\n\n    /* Get time in minutes from \"(sunrise-01:30)\" {{{\n     * Extract the added or subtracted time from \"(sunrise-01:30)\"\n     * returns time in minutes e.g. -90.\n     *\n     * :param tokens: List of token objects.\n     * :param at: Position where the specification for the point in time could be.\n     * :returns: Time in minutes on suggest, throws an exception otherwise.\n    */\n    function parseTimevarCalc(tokens, at) {\n        var error;\n        if (matchTokens(tokens, at+2, '+') || matchTokens(tokens, at+2, '-')) {\n            if (matchTokens(tokens, at+3, 'number', 'timesep', 'number')) {\n                if (matchTokens(tokens, at+6, ')')) {\n                    var add_or_subtract = tokens[at+2][0] === '+' ? '1' : '-1';\n                    var minutes = getMinutesByHoursMinutes(tokens, nrule, at+3) * add_or_subtract;\n                    if (minutes === 0)\n                        parsing_warnings.push([ nrule, at+5, t('zero calculation') ]\n                            );\n                    return minutes;\n                } else {\n                    error = [ at+6, '. ' + t('missing', {'symbol': \")\"}) + '.'];\n                }\n            } else {\n                error = [ at+5, ' ' + t('(time)') + '.'];\n            }\n        } else {\n            error = [ at+2, '. ' + t('expected', {'symbol': '+\" or \"-'})];\n        }\n\n        if (error)\n            throw formatWarnErrorMessage(nrule, error[0],\n                 t('calculation syntax')+ error[1]);\n    }\n    /* }}} */\n    /* }}} */\n\n    /* Weekday range parser (Mo,We-Fr,Sa[1-2,-1],PH). {{{\n     *\n     * :param tokens: List of token objects.\n     * :param at: Position where the weekday tokens could be.\n     * :param rule: Reference to rule object.\n     * :param nrule: Rule number starting with 0.\n     * :returns: Position at which the token does not belong to the selector anymore.\n     */\n    function parseWeekdayRange(tokens, at, rule, in_holiday_selector, nrule) {\n        if (!in_holiday_selector) {\n            in_holiday_selector = true;\n            tokens[at][3] = 'weekday';\n        }\n\n        for (; at < tokens.length; at++) {\n            if (matchTokens(tokens, at, 'weekday', '[')) {\n                // Conditional weekday (Mo[3])\n                var numbers = [];\n\n                // Get list of constraints\n                var endat = parseNumRange(tokens, at+2, function(from, to, at) {\n\n                    // bad number\n                    if (from === 0 || from < -5 || from > 5)\n                        throw formatWarnErrorMessage(nrule, at,\n                            t('number -5 to 5'));\n\n                    if (from === to) {\n                        numbers.push(from);\n                    } else if (from < to) {\n                        for (var i = from; i <= to; i++) {\n                            // bad number\n                            if (i === 0 || i < -5 || i > 5)\n                                throw formatWarnErrorMessage(nrule, at+2,\n                                    t('number -5 to 5'));\n\n                            numbers.push(i);\n                        }\n                    } else {\n                        throw formatWarnErrorMessage(nrule, at+2,\n                            t('bad range',{'from': from, 'to': to}));\n                    }\n                });\n\n                if (!matchTokens(tokens, endat, ']')) {\n                    throw formatWarnErrorMessage(\n                        nrule,\n                        endat + (typeof tokens[endat] === 'object' ? 0 : -1),\n                        t('] or more numbers')\n                    );\n                }\n\n                var add_days = getMoveDays(tokens, endat+1, 6, 'constrained weekdays');\n                week_stable = false;\n\n                // Create selector for each list element.\n                for (var nnumber = 0; nnumber < numbers.length; nnumber++) {\n\n                    rule.weekday.push(function(weekday, number, add_days) { return function(date) {\n                        var date_num = getValueForDate(date, false); // Year not needed to distinguish.\n                        var start_of_this_month = new Date(date.getFullYear(), date.getMonth(), 1);\n                        var start_of_next_month = new Date(date.getFullYear(), date.getMonth() + 1, 1);\n\n                        var target_day_this_month;\n\n                        target_day_this_month = getDateForConstrainedWeekday(date.getFullYear(), date.getMonth(), weekday, [ number ]);\n\n                        var target_day_with_added_days_this_month = new Date(target_day_this_month.getFullYear(),\n                            target_day_this_month.getMonth(), target_day_this_month.getDate() + add_days);\n\n                        // The target day with added days can be before this month\n                        if (target_day_with_added_days_this_month.getTime() < start_of_this_month.getTime()) {\n                            // but in this case, the target day without the days added needs to be in this month\n                            if (target_day_this_month.getTime() >= start_of_this_month.getTime()) {\n                                // so we calculate it for the month\n                                // following this month and hope that the\n                                // target day will actually be this month.\n\n                                target_day_with_added_days_this_month = dateAtNextWeekday(\n                                    new Date(date.getFullYear(), date.getMonth() + (number > 0 ? 0 : 1) + 1, 1), weekday);\n                                target_day_this_month.setDate(target_day_with_added_days_this_month.getDate()\n                                    + (number + (number > 0 ? -1 : 0)) * 7 + add_days);\n                            } else {\n                                // Calculated target day is not inside this month\n                                // therefore the specified weekday (e.g. fifth Sunday)\n                                // does not exist this month. Try it next month.\n                                return [false, start_of_next_month];\n                            }\n                        } else if (target_day_with_added_days_this_month.getTime() >= start_of_next_month.getTime()) {\n                            // The target day is in the next month. If the target day without the added days is not in this month\n                            if (target_day_this_month.getTime() >= start_of_next_month.getTime())\n                                return [false, start_of_next_month];\n                        }\n\n                        var target_day_with_added_moved_days_this_month;\n                        if (add_days > 0) {\n                            target_day_with_added_moved_days_this_month = dateAtNextWeekday(\n                                new Date(date.getFullYear(), date.getMonth() + (number > 0 ? 0 : 1) -1, 1), weekday);\n                            target_day_with_added_moved_days_this_month.setDate(target_day_with_added_moved_days_this_month.getDate()\n                                + (number + (number > 0 ? -1 : 0)) * 7 + add_days);\n\n                            if (date_num === getValueForDate(target_day_with_added_moved_days_this_month, false))\n                                return [true, dateAtDayMinutes(date, minutes_in_day)];\n                        } else if (add_days < 0) {\n                            target_day_with_added_moved_days_this_month = dateAtNextWeekday(\n                                new Date(date.getFullYear(), date.getMonth() + (number > 0 ? 0 : 1) + 1, 1), weekday);\n                            target_day_with_added_moved_days_this_month.setDate(target_day_with_added_moved_days_this_month.getDate()\n                                + (number + (number > 0 ? -1 : 0)) * 7 + add_days);\n\n                            if (target_day_with_added_moved_days_this_month.getTime() >= start_of_next_month.getTime()) {\n                                if (target_day_with_added_days_this_month.getTime() >= start_of_next_month.getTime())\n                                    return [false, target_day_with_added_moved_days_this_month];\n                            } else {\n                                if (target_day_with_added_days_this_month.getTime() < start_of_next_month.getTime()\n                                    && getValueForDate(target_day_with_added_days_this_month, false) === date_num)\n                                    return [true, dateAtDayMinutes(date, minutes_in_day)];\n\n                                target_day_with_added_days_this_month = target_day_with_added_moved_days_this_month;\n                            }\n                        }\n\n                        // we hit the target day\n                        if (date.getDate() === target_day_with_added_days_this_month.getDate()) {\n                            return [true, dateAtDayMinutes(date, minutes_in_day)];\n                        }\n\n                        // we're before target day\n                        if (date.getDate() < target_day_with_added_days_this_month.getDate()) {\n                            return [false, target_day_with_added_days_this_month];\n                        }\n\n                        // we're after target day, set check date to next month\n                        return [false, start_of_next_month];\n                    }}(tokens[at][0], numbers[nnumber], add_days[0]));\n                }\n\n                at = endat + 1 + add_days[1];\n            } else if (matchTokens(tokens, at, 'weekday')) {\n                // Single weekday (Mo) or weekday range (Mo-Fr)\n                var is_range = matchTokens(tokens, at+1, '-', 'weekday');\n\n                var weekday_from = tokens[at][0];\n                var weekday_to = is_range ? tokens[at+2][0] : weekday_from;\n\n                var inside = true;\n\n                // handle reversed range\n                if (weekday_to < weekday_from) {\n                    var tmp = weekday_to;\n                    weekday_to = weekday_from - 1;\n                    weekday_from = tmp + 1;\n                    inside = false;\n                }\n                var weekday_list = Array.apply(0, Array(weekday_to - weekday_from + 1)).map(function (_, index) {\n                    return index + weekday_to;\n                });\n                if (typeof rule_infos[nrule] === 'undefined') {\n                    rule_infos[nrule] = {};\n                }\n                if (typeof rule_infos[nrule]['week_days'] === 'object') {\n                    Array.prototype.push.apply(rule_infos[nrule]['week_days'], weekday_list);\n                } else {\n                    rule_infos[nrule]['week_days'] = weekday_list;\n                }\n\n                if (weekday_to < weekday_from) { // handle full range\n                    rule.weekday.push(function() { return [true]; });\n                    // Not needed. If there is no selector it automatically matches everything.\n                    // WRONG: This only works if there is no other selector in this selector group ...\n                } else {\n                    rule.weekday.push(function(weekday_from, weekday_to, inside) { return function(date) {\n                        var ourweekday = date.getDay();\n\n                        if (ourweekday < weekday_from || ourweekday > weekday_to) {\n                            return [!inside, dateAtNextWeekday(date, weekday_from)];\n                        } else {\n                            return [inside, dateAtNextWeekday(date, weekday_to + 1)];\n                        }\n                    }}(weekday_from, weekday_to, inside));\n                }\n\n                at += is_range ? 3 : 1;\n            } else if (matchTokens(tokens, at, 'holiday')) {\n                week_stable = false;\n                return parseHoliday(tokens, at, rule, true, in_holiday_selector);\n            } else if (matchTokens(tokens, at - 1, ',')) { // additional rule\n                throw formatWarnErrorMessage(\n                    nrule,\n                    at - 1,\n                    t('additional rule no sense'));\n            } else {\n                throw formatWarnErrorMessage(nrule, at, t('unexpected token weekday range', {'token': tokens[at][1]}));\n            }\n\n            if (!matchTokens(tokens, at, ',')) {\n                break;\n            }\n        }\n\n        return at;\n    }\n    /* }}} */\n\n    /* Get the number of days a date should be moved (if any). {{{\n     *\n     * :param tokens: List of token objects.\n     * :param at: Position where the date moving tokens could be.\n     * :param max_differ: Maximal number of days to move (could also be zero if there are no day move tokens).\n     * :returns: Array:\n     *            0. Days to add.\n     *            1. How many tokens.\n     */\n    function getMoveDays(tokens, at, max_differ, name) {\n        var add_days = [ 0, 0 ]; // [ 'days to add', 'how many tokens' ]\n        add_days[0] = matchTokens(tokens, at, '+') || (matchTokens(tokens, at, '-') ? -1 : 0);\n        if (add_days[0] !== 0 && matchTokens(tokens, at+1, 'number', 'calcday')) {\n            // continues with '+ 5 days' or something like that\n            if (tokens[at+1][0] > max_differ)\n                throw formatWarnErrorMessage(nrule, at+2,\n                    t('max differ',{'maxdiffer': max_differ, 'name': name}));\n            add_days[0] *= tokens[at+1][0];\n            if (add_days[0] === 0 && !done_with_warnings)\n                parsing_warnings.push([ nrule, at+2, t('adding 0') ]);\n            add_days[1] = 3;\n        } else {\n            add_days[0] = 0;\n        }\n        return add_days;\n    }\n    /* }}} */\n\n    /* Holiday parser for public and school holidays (PH,SH) {{{\n     *\n     * :param tokens: List of token objects.\n     * :param at: Position where to start.\n     * :param rule: Reference to rule object.\n     * :param push_to_weekday: Will push the selector into the weekday selector array which has the desired side effect of working in conjunction with the weekday selectors (either the holiday match or the weekday), which is the normal and expected behavior.\n     * :returns: Position at which the token does not belong to the selector anymore.\n     */\n    function parseHoliday(tokens, at, rule, push_to_weekday, in_holiday_selector) {\n        if (!in_holiday_selector) {\n\n            if (push_to_weekday)\n                tokens[at][3] = 'weekday';\n            else\n                tokens[at][3] = 'holiday'; // Could also be holiday but this is not important here.\n        }\n\n        for (; at < tokens.length; at++) {\n            if (matchTokens(tokens, at, 'holiday')) {\n                if (tokens[at][0] === 'PH') {\n                    var applying_holidays = getMatchingHoliday(tokens[at][0]);\n\n                    // Only allow moving one day in the past or in the future.\n                    // This makes implementation easier because only one holiday is assumed to be moved to the next year.\n                    var add_days = getMoveDays(tokens, at+1, 1, 'public holiday');\n\n                    var selector = function(applying_holidays, add_days) { return function(date) {\n\n                        var holidays = getApplyingHolidaysForYear(applying_holidays, date.getFullYear(), add_days);\n                        // Needs to be calculated each time because of movable days.\n\n                        var date_num = getValueForDate(date, true);\n\n                        for (var i = 0; i < holidays.length; i++) {\n                            var next_holiday_date_num = getValueForDate(holidays[i][0], true);\n\n                            if (date_num < next_holiday_date_num) {\n\n                                if (add_days[0] > 0) {\n                                    // Calculate the last holiday from previous year to tested against it.\n                                    var holidays_last_year = getApplyingHolidaysForYear(applying_holidays, date.getFullYear() - 1, add_days);\n                                    var last_holiday_last_year = holidays_last_year[holidays_last_year.length - 1];\n                                    var last_holiday_last_year_num = getValueForDate(last_holiday_last_year[0], true);\n\n                                    if (date_num < last_holiday_last_year_num ) {\n                                        return [ false, last_holiday_last_year[0] ];\n                                    } else if (date_num === last_holiday_last_year_num) {\n                                        return [true, dateAtDayMinutes(last_holiday_last_year[0], minutes_in_day),\n                                            'Day after ' +last_holiday_last_year[1] ];\n                                    }\n                                }\n\n                                return [ false, holidays[i][0] ];\n                            } else if (date_num === next_holiday_date_num) {\n                                return [true, new Date(date.getFullYear(), date.getMonth(), date.getDate() + 1),\n                                    (add_days[0] > 0 ? 'Day after ' : (add_days[0] < 0 ? 'Day before ' : '')) + holidays[i][1] ];\n                            }\n                        }\n\n                        if (add_days[0] < 0) {\n                            // Calculate the first holiday from next year to tested against it.\n                            var holidays_next_year = getApplyingHolidaysForYear(applying_holidays, date.getFullYear() + 1, add_days);\n                            var first_holidays_next_year = holidays_next_year[0];\n                            var first_holidays_next_year_num = getValueForDate(first_holidays_next_year[0], true);\n                            if (date_num === first_holidays_next_year_num) {\n                                return [true, dateAtDayMinutes(first_holidays_next_year[0], minutes_in_day),\n                                    'Day before ' + first_holidays_next_year[1] ];\n                            }\n                        }\n\n                        // continue next year\n                        return [ false, new Date(holidays[0][0].getFullYear() + 1,\n                                holidays[0][0].getMonth(),\n                                holidays[0][0].getDate()) ];\n\n                    }}(applying_holidays, add_days);\n\n                    if (push_to_weekday)\n                        rule.weekday.push(selector);\n                    else\n                        rule.holiday.push(selector);\n\n                    at += 1 + add_days[1];\n                } else if (tokens[at][0] === 'SH') {\n                    var applying_holidays = getMatchingHoliday(tokens[at][0]);\n\n                    var selector = function(applying_holidays) { return function(date) {\n                        var date_num = getValueForDate(date);\n\n                        // Iterate over holiday array containing the different holiday ranges.\n                        for (var i = 0; i < applying_holidays.length; i++) {\n\n                            var holiday = getSHForYear(applying_holidays[i], date.getFullYear(), false);\n                            if (typeof holiday === 'undefined') {\n                                continue;\n                            }\n\n                            for (var h = 0; h < holiday.length; h+=4) {\n                                var holiday_to_plus = new Date(date.getFullYear(), holiday[2+h] - 1, holiday[3+h] + 1);\n                                var holiday_from = (holiday[0+h] - 1) * 100 + holiday[1+h];\n                                var holiday_to   = (holiday[2+h] - 1) * 100 + holiday[3+h];\n                                holiday_to_plus  = getValueForDate(holiday_to_plus);\n\n                                // console.log(`holiday_from: ${holiday_from}, holiday_to: ${holiday_to}, holiday_to_plus: ${holiday_to_plus}`);\n\n                                var holiday_ends_next_year = holiday_to < holiday_from;\n\n                                if (date_num < holiday_from) { // date is before selected holiday\n\n                                    // check if we are in the holidays from the last year spanning into this year\n                                    var last_year_holiday = getSHForYear(applying_holidays[applying_holidays.length - 1], date.getFullYear() - 1, false);\n                                    if (typeof last_year_holiday === 'object') {\n                                        var last_year_holiday_from = (last_year_holiday[last_year_holiday.length - 4] - 1) * 100\n                                            + last_year_holiday[last_year_holiday.length - 3]; // e.g. 1125\n                                        var last_year_holiday_to   = (last_year_holiday[last_year_holiday.length - 2] - 1) * 100\n                                            + last_year_holiday[last_year_holiday.length - 1]; // e.g. 0005\n                                        // console.log(last_year_holiday_from, last_year_holiday_to);\n\n                                        if (last_year_holiday_from > last_year_holiday_to && date_num <= last_year_holiday_to) {\n                                            return [ true, new Date(date.getFullYear(),\n                                                last_year_holiday[last_year_holiday.length - 2] - 1,\n                                                last_year_holiday[last_year_holiday.length - 1] + 1),\n                                                applying_holidays[applying_holidays.length - 1].name ];\n                                        } else {\n                                            return [ false, new Date(date.getFullYear(), holiday[0+h] - 1, holiday[1+h]) ];\n                                        }\n                                    } else { /* School holidays for last year are not defined. */\n                                        return [ false, new Date(date.getFullYear(), holiday[0+h] - 1, holiday[1+h]) ];\n                                    }\n                                } else if (holiday_from <= date_num && (date_num <= holiday_to || holiday_ends_next_year)) {\n                                    return [ true, new Date(date.getFullYear() + holiday_ends_next_year, holiday[2+h] - 1, holiday[3+h] + 1),\n                                        applying_holidays[i].name ];\n                                } else if (holiday_to_plus === date_num) { // selected holiday end is equal to month and day\n                                    if (h + 4 < holiday.length) { // next holiday is next date range of the same holidays\n                                        h += 4;\n                                        return [ false, new Date(date.getFullYear(), holiday[0+h] - 1, holiday[1+h]) ];\n                                    } else {\n                                        /* Because not all school holidays\n                                         * have to apply each year this\n                                         * part has been simplified which\n                                         * makes the implementation a bit\n                                         * less efficient but reduces\n                                         * complexity.\n                                         */\n                                        return [ false, new Date(date.getFullYear(), holiday[2+h] - 1, holiday[3+h] + 2) ];\n                                    }\n                                }\n                            }\n                        }\n                        throw formatLibraryBugMessage(t('no SH definition', {\n                            'name': '',\n                            'year': date.getFullYear(),\n                        }), 'library bug PR only');\n                    }}(applying_holidays);\n\n                    if (push_to_weekday)\n                        rule.weekday.push(selector);\n                    else\n                        rule.holiday.push(selector);\n                    at += 1; // FIXME: test\n                }\n            } else if (matchTokens(tokens, at, 'weekday')) {\n                return parseWeekdayRange(tokens, at, rule, true, nrule);\n            } else if (matchTokens(tokens, at - 1, ',')) { // additional rule\n                throw formatWarnErrorMessage(\n                    nrule,\n                    at - 1,\n                    t('additional rule no sense'));\n            } else {\n                throw formatWarnErrorMessage(nrule, at, t('unexpected token holiday', {'token': tokens[at][1]}));\n            }\n\n            if (!matchTokens(tokens, at, ','))\n                break;\n        }\n\n        return at;\n    }\n\n    // Helpers for holiday parsers {{{\n\n    /* Returns a number for a date which can then be used to compare just the dates (without the time). {{{\n     *\n     * This is necessary because a selector could be called for the middle of the day and we need to tell if it matches that day.\n     * Example: Returns 20150015 for Jan 15 2015.\n     *\n     * :param date: Date object.\n     * :param include_year: Boolean. If true include the year.\n     * :returns: Number for the date.\n     */\n    function getValueForDate(date, include_year) {\n        // Implicit because undefined evaluates to false.\n        // include_year = typeof include_year !== 'undefined' ? include_year : false;\n\n        return (include_year ? (date.getFullYear() * 10000) : 0) + (date.getMonth() * 100) + date.getDate();\n    }\n    /* }}} */\n\n    /* Return the school holiday definition e.g. [ 5, 25, to 6, 5 ], for the specified year {{{\n     *\n     * :param SH_hash:\n     * :param year: Year as integer.\n     * :param fatal: Defines the behavior in case no definition is find. Throw an error if set to true. Return return undefined otherwise.\n     * :returns: school holidays for the given year.\n     */\n    function getSHForYear(SH_hash, year, fatal) {\n        if (typeof fatal !== 'boolean') {\n            fatal = true;\n        }\n\n        var holiday = SH_hash[year];\n        if (typeof holiday === 'undefined') {\n            holiday = SH_hash['default']; // applies for any year without explicit definition\n            if (typeof holiday === 'undefined') {\n                if (fatal) {\n                    throw formatLibraryBugMessage(t('no SH definition', {\n                        'name': SH_hash.name + ' ',\n                        'year': year,\n                    }), 'library bug PR only');\n                } else {\n                    return undefined;\n                }\n            }\n        }\n        return holiday;\n    }\n    /* }}} */\n\n    /* Return closest holiday definition available. {{{\n     *\n     * First try to get the state, if missing get the country wide holidays\n     * (which can on its own be limited to some states).\n     *\n     * :param type_of_holidays: Choices: PH, SH.\n     * :returns: Public or school holiday list.\n     */\n    function getMatchingHoliday(type_of_holidays) {\n        if (typeof location_cc !== 'string') {\n            /* We have no idea which holidays do apply because the country code was not provided. */\n            throw t('no country code');\n        }\n\n        if (!holiday_definitions[location_cc]) {\n            throw formatLibraryBugMessage(t('no holiday definition', {\n                'name': type_of_holidays,\n                'cc': location_cc,\n            }), 'library bug PR only');\n        }\n\n        var matching_holiday = [];\n        if (typeof location_state === 'string'\n            && typeof holiday_definitions[location_cc][location_state] === 'object'\n            && typeof holiday_definitions[location_cc][location_state][type_of_holidays] === 'object') {\n\n            /* If holiday_definitions for the state are specified,\n             * use it and ignore lesser specific ones (for the\n             * country).\n             */\n\n            var country_holidays = holiday_definitions[location_cc][type_of_holidays] || [];\n            var state_holidays = holiday_definitions[location_cc][location_state][type_of_holidays];\n            if (type_of_holidays === 'PH') {\n                matching_holiday = state_holidays;\n            } else if (!country_holidays.length) {\n                matching_holiday = state_holidays;\n            } else {\n                // Merge country and state holidays chronologically\n                var country_holiday_names = country_holidays.map(function(country_holiday) {\n                    return country_holiday.name;\n                });\n                var matching_holiday = [];\n                matching_holiday.push.apply(matching_holiday, country_holidays);\n                matching_holiday.push.apply(matching_holiday, state_holidays.filter(function is_not_a_country_holiday(state_holiday) {\n                    return country_holiday_names.indexOf(state_holiday.name) === -1;\n                }));\n                matching_holiday.sort(function(h1, h2) {\n                    var h1_year = Object.keys(h1).find(function(k) {return k !== 'name';});\n                    var h2_year = Object.keys(h2).find(function(k) {return k !== 'name';});\n                    var h1_date = h1[h1_year];\n                    var h2_date = h2[h2_year];\n                    // compare both months, or to break a tie both days\n                    return (h1_date[0] - h2_date[0]) || (h1_date[1] - h2_date[1]);\n                });\n            }\n        } else if (holiday_definitions[location_cc][type_of_holidays]) {\n            /* Holidays are defined country wide. Some\n             * countries only have country-wide holiday definitions\n             * so that is ok too.\n             */\n            var applying_holidays_for_country = holiday_definitions[location_cc][type_of_holidays];\n\n            switch (type_of_holidays) {\n                case 'PH':\n                    applying_holidays_for_country.forEach(function (holiday_item) {\n                        /* Holidays in the country-wide scope can be limited to certain states. */\n                        if ('only_states' in holiday_item) {\n                            if (-1 === holiday_item.only_states.indexOf(location_state)) {\n                                return;\n                            }\n                        }\n\n                        matching_holiday.push(holiday_item);\n                    });\n                    break;\n                case 'SH':\n                    matching_holiday = applying_holidays_for_country;\n                    break;\n            }\n        } else {\n            throw formatLibraryBugMessage(t('no holiday definition state', {\n                'name': type_of_holidays,\n                'cc': location_cc,\n                'state': location_state,\n            }), 'library bug PR only');\n        }\n\n        if (matching_holiday.length === 0) {\n            throw formatLibraryBugMessage(t('no holiday definition', {\n                'name': type_of_holidays,\n                'cc': location_cc,\n            }), 'library bug PR only');\n        }\n\n        return matching_holiday;\n    }\n    /* }}} */\n\n    /* Return variable dates used for holiday calculation. {{{\n     *\n     * :param year: Year as integer.\n     * :returns: Hash of variables dates. Key is the name of the variable date. Value is the variable date date object.\n     */\n    function getMovableEventsForYear(year) {\n        /* Calculate easter {{{ */\n        var C = Math.floor(year/100);\n        var N = year - 19*Math.floor(year/19);\n        var K = Math.floor((C - 17)/25);\n        var I = C - Math.floor(C/4) - Math.floor((C - K)/3) + 19*N + 15;\n        I = I - 30*Math.floor((I/30));\n        I = I - Math.floor(I/28)*(1 - Math.floor(I/28)*Math.floor(29/(I + 1))*Math.floor((21 - N)/11));\n        var J = year + Math.floor(year/4) + I + 2 - C + Math.floor(C/4);\n        J = J - 7*Math.floor(J/7);\n        var L = I - J;\n        var M = 3 + Math.floor((L + 40)/44);\n        var D = L + 28 - 31*Math.floor(M/4);\n        /* }}} */\n\n        /* Calculate orthodox easter {{{ */\n        var oA = year % 4;\n        var oB = year % 7;\n        var oC = year % 19;\n        var oD = (19*oC + 15) % 30;\n        var oE = (2*oA+4*oB - oD + 34) % 7;\n        var oF = oD+oE;\n\n        var oDate;\n        if (oF < 9) {\n            oDate = new Date(year, 4-1, oF+4);\n        } else {\n            if ((oF+4)<31) {\n                oDate = new Date(year, 4-1, oF+4);\n            } else {\n                oDate = new Date(year, 5-1, oF-26);\n            }\n        }\n        /* }}} */\n\n        /* Calculate last Sunday in February {{{ */\n        var lastFebruaryDay = new Date(year, 2, 0);\n        var lastFebruarySunday = lastFebruaryDay.getDate() - lastFebruaryDay.getDay();\n        /* }}} */\n\n        /* Calculate Victoria Day. last Monday before or on May 24 {{{ */\n        var may_24 = new Date(year, 4, 24);\n        var victoriaDay = 24  - ((6 + may_24.getDay()) % 7);\n        /* }}} */\n\n        /* Calculate Canada Day. July 1st unless 1st is on Sunday, then July 2. {{{ */\n        var july_1 = new Date(year, 6, 1);\n        var canadaDay = july_1.getDay() === 0 ? 2 : 1;\n        /* }}} */\n\n        /* Calculation of the spring and autumnal equinoxes (for Public holidays in Japan). {{{ */\n        function springEquinoxCalc(year){\n            if(year >= 1900 && year <= 1923){\n                if(year % 4 === 3) return new Date(year, 2, 22)\n                else return new Date(year, 2, 21)\n            } else if(year >= 1924 && year <= 1959){\n                return new Date(year, 2, 21)\n            } else if(year >= 1960 && year <= 1991){\n                if(year % 4 === 0) return new Date(year, 2, 20)\n                else return new Date(year, 2, 21)\n            } else if(year >= 1992 && year <= 2023){\n                if(year % 4 === 0 || year % 4 === 1) return new Date(year, 2, 20)\n                else return new Date(year, 2, 21)\n            } else if(year >= 2024 && year <= 2055){\n                if(year % 4 === 3) return new Date(year, 2, 21)\n                else return new Date(year, 2, 20)\n            } else if(year >= 2056 && year <= 2091){\n                return new Date(year, 2, 20)\n            } else if(year >= 2092 && year <= 2099){\n                if(year % 4 === 0) return new Date(year, 2, 19)\n                else return new Date(year, 2, 20)\n            }\n        }\n\n        function autumnalEquinoxCalc(year){\n            if(year >= 1900 && year <= 1919){\n                if(year % 4 === 0) return new Date(year, 8, 23)\n                else return new Date(year, 8, 24)\n            } else if(year >= 1920 && year <= 1947){\n                if(year % 4 === 0 || year % 4 === 1) return new Date(year, 8, 23)\n                else return new Date(year, 8, 24)\n            } else if(year >= 1948 && year <= 1979){\n                if(year % 4 === 3) return new Date(year, 8, 24)\n                else return new Date(year, 8, 23)\n            } else if(year >= 1980 && year <= 2011){\n                return new Date(year, 8, 23)\n            } else if(year >= 2012 && year <= 2043){\n                if(year % 4 === 0) return new Date(year, 8, 22)\n                else return new Date(year, 8, 23)\n            }  else if(year >= 2044 && year <= 2075){\n                if(year % 4 === 0 || year % 4 === 1) return new Date(year, 8, 22)\n                else return new Date(year, 8, 23)\n            } else if(year >= 2076 && year <= 2099){\n                if(year % 4 === 3) return new Date(year, 8, 23)\n                else return new Date(year, 8, 22)\n            }\n        }\n\n        /* Helper functions {{{ */\n        function firstWeekdayOfMonth(month, weekday){\n            var first = new Date(year, month, 1);\n            return 1 + ((7 + weekday - first.getDay()) % 7);\n        }\n\n        function lastWeekdayOfMonth(month, weekday){\n            var last = new Date(year, month+1, 0);\n            var offset = ((7 + last.getDay() - weekday) % 7);\n            return last.getDate() - offset;\n        }\n\n        function getDateOfWeekdayInDateRange(weekday, start_date){\n            var days_to_dest_date = weekday - start_date.getDay();\n            if (days_to_dest_date < 0) {\n                days_to_dest_date += 7;\n            }\n            start_date.setDate(start_date.getDate() + days_to_dest_date);\n            return start_date;\n        }\n\n        /* Date of next weekday range. {{{\n         *\n         * :param first_weekday: First weekday in range of wanted weekday (1 is Mo).\n         * :param last_weekday: Last weekday in range of wanted weekday (1 is Mo).\n         * :param start_date: Earliest possible date to consider.\n         * :returns: start_date if in weekday range, otherwise the next day which is in range.\n         */\n        function getDateOfNextWeekdayRange(first_weekday, last_weekday, start_date){\n            if (first_weekday >= last_weekday) {\n                throw formatLibraryBugMessage('Not implemented yet.');\n            }\n\n            if (first_weekday <= start_date.getDay() && start_date.getDay() <= last_weekday) {\n                return start_date;\n            } else {\n                var days_to_dest_date = first_weekday - start_date.getDay();\n                if (days_to_dest_date < 0) {\n                    days_to_dest_date += 7;\n                }\n                start_date.setDate(start_date.getDate() + days_to_dest_date);\n                return start_date;\n            }\n\n        }\n        /* }}} */\n\n        return {\n            'easter'                : new Date(year, M - 1, D),\n            'orthodox easter'       : oDate,\n            'victoriaDay'           : new Date(year,  4, victoriaDay),\n            'canadaDay'             : new Date(year,  6, canadaDay),\n            'firstJanuaryMonday'    : new Date(year,  0, firstWeekdayOfMonth(0, 1)),\n            'firstFebruaryMonday'   : new Date(year,  1, firstWeekdayOfMonth(1, 1)),\n            'lastFebruarySunday'    : new Date(year,  1, lastFebruarySunday),\n            'firstMarchMonday'      : new Date(year,  2, firstWeekdayOfMonth(2, 1)),\n            'firstAprilMonday'      : new Date(year,  3, firstWeekdayOfMonth(3, 1)),\n            'firstMayMonday'        : new Date(year,  4, firstWeekdayOfMonth(4, 1)),\n            'firstJuneMonday'       : new Date(year,  5, firstWeekdayOfMonth(5, 1)),\n            'firstJulyMonday'       : new Date(year,  6, firstWeekdayOfMonth(6, 1)),\n            'firstAugustMonday'     : new Date(year,  7, firstWeekdayOfMonth(7, 1)),\n            'firstSeptemberMonday'  : new Date(year,  8, firstWeekdayOfMonth(8, 1)),\n            'firstSeptemberTuesday' : new Date(year,  8, firstWeekdayOfMonth(8, 2)),\n            'firstSeptemberSunday'  : new Date(year,  8, firstWeekdayOfMonth(8, 0)),\n            'firstOctoberMonday'    : new Date(year,  9, firstWeekdayOfMonth(9, 1)),\n            'firstNovemberMonday'   : new Date(year, 10, firstWeekdayOfMonth(10, 1)),\n            'firstNovemberTuesday'  : new Date(year, 10, firstWeekdayOfMonth(10, 2)),\n            'firstMarchTuesday'     : new Date(year,  2, firstWeekdayOfMonth(2, 2)),\n            'firstAugustTuesday'    : new Date(year,  7, firstWeekdayOfMonth(7, 2)),\n            'firstAugustFriday'     : new Date(year,  7, firstWeekdayOfMonth(7, 5)),\n            'firstNovemberThursday' : new Date(year, 10, firstWeekdayOfMonth(10, 4)),\n            'lastMayMonday'         : new Date(year,  4, lastWeekdayOfMonth(4, 1)),\n            'lastMarchMonday'       : new Date(year,  2, lastWeekdayOfMonth(2, 1)),\n            'lastAprilMonday'       : new Date(year,  3, lastWeekdayOfMonth(3, 1)),\n            'lastAprilFriday'       : new Date(year,  3, lastWeekdayOfMonth(3, 5)),\n            'lastAugustMonday'      : new Date(year,  7, lastWeekdayOfMonth(7, 1)),\n            'lastSeptemberMonday'   : new Date(year,  8, lastWeekdayOfMonth(8, 1)),\n            'lastSeptemberFriday'   : new Date(year,  8, lastWeekdayOfMonth(8, 5)),\n            'lastOctoberMonday'     : new Date(year,  9, lastWeekdayOfMonth(9, 1)),\n            'lastOctoberFriday'     : new Date(year,  9, lastWeekdayOfMonth(9, 5)),\n            'nextSaturday20Jun'     : getDateOfWeekdayInDateRange(6, new Date(year, 5, 20)),\n            'nextSaturday31Oct'     : getDateOfWeekdayInDateRange(6, new Date(year, 9, 31)),\n            'nextWednesday16Nov'    : getDateOfWeekdayInDateRange(3, new Date(year, 10, 16)),\n            'nextMo-Fr17March'      : getDateOfNextWeekdayRange(1, 5, new Date(year, 2, 17)),\n            'nextMo-Sa01May'        : getDateOfNextWeekdayRange(1, 6, new Date(year, 4, 1)),\n            'nextMo-Sa07August'     : getDateOfNextWeekdayRange(1, 6, new Date(year, 7, 7)),\n            'nextMo-Sa25December'   : getDateOfNextWeekdayRange(1, 6, new Date(year, 11, 25)),\n            'springEquinox'         : springEquinoxCalc(year),\n            'autumnalEquinox'       : autumnalEquinoxCalc(year),\n        };\n    }\n    /* }}} */\n\n    function getApplyingHolidaysForYear(applying_holidays, year, add_days) {\n        var movableDays = getMovableEventsForYear(year);\n\n        var sorted_holidays = [];\n        var next_holiday;\n\n        applying_holidays.forEach(function (holiday_item) {\n            if ('fixed_date' in holiday_item) {\n                next_holiday = new Date(year,\n                        holiday_item.fixed_date[0] - 1,\n                        holiday_item.fixed_date[1]\n                    );\n            } else if ('variable_date' in holiday_item) {\n                var selected_movableDay = movableDays[holiday_item.variable_date];\n                if (!selected_movableDay) {\n                    throw t('movable no formula', {'name': holiday_item.name});\n                }\n                var date_offset = 0;\n                if ('offset' in holiday_item) {\n                    date_offset = holiday_item.offset;\n                }\n                next_holiday = new Date(selected_movableDay.getFullYear(),\n                    selected_movableDay.getMonth(),\n                    selected_movableDay.getDate() + date_offset\n                );\n                if (year !== next_holiday.getFullYear()) {\n                    throw t('movable not in year', {\n                        'name': holiday_item.variable_date, 'days': date_offset});\n                }\n            } else {\n                throw formatLibraryBugMessage('Unexpected object: ' + JSON.stringify(holiday_item, null, '    '));\n            }\n\n            if (add_days[0]) {\n                next_holiday.setDate(next_holiday.getDate() + add_days[0]);\n            }\n\n            sorted_holidays.push([ next_holiday, holiday_item.name ]);\n        });\n\n        sorted_holidays = sorted_holidays.sort(function(a,b){\n            if (a[0].getTime() < b[0].getTime()) return -1;\n            if (a[0].getTime() > b[0].getTime()) return 1;\n            return 0;\n        });\n\n        return sorted_holidays;\n    }\n    /* }}} */\n    /* }}} */\n\n    /* Year range parser (2013,2016-2018,2020/2). {{{\n     *\n     * :param tokens: List of token objects.\n     * :param at: Position where to start.\n     * :returns: Position at which the token does not belong to the selector anymore.\n     */\n    function parseYearRange(tokens, at) {\n        tokens[at][3] = 'year';\n        for (; at < tokens.length; at++) {\n            if (matchTokens(tokens, at, 'year')) {\n                var is_range = false,\n                    has_period,\n                    period;\n                if (matchTokens(tokens, at+1, '-', 'year', '/', 'number')) {\n                    is_range   = true;\n                    has_period = true;\n                    period = parseInt(tokens[at+4][0]);\n                    checkPeriod(at+4, period, 'year');\n                } else {\n                    is_range   = matchTokens(tokens, at+1, '-', 'year');\n                    has_period = matchTokens(tokens, at+1, '/', 'number');\n                    if (has_period) {\n                        period = parseInt(tokens[at+2][0]);\n                        checkPeriod(at+2, period, 'year', 'no_end_year');\n                    } else if (matchTokens(tokens, at+1, '+')) {\n                        period = 1;\n                        has_period = 2;\n                    }\n                }\n\n                var year_from = parseInt(tokens[at][0]);\n                // error checking {{{\n                    if (is_range && tokens[at+2][0] <= year_from) {\n                        // handle reversed range\n                        if (tokens[at+2][0] === year_from) {\n                            throw formatWarnErrorMessage(nrule, at, t('year range one year', {'year': year_from }));\n                        } else {\n                            throw formatWarnErrorMessage(nrule, at, t('year range reverse'));\n                        }\n                    }\n                    if (!is_range && year_from < new Date().getFullYear()) {\n                        parsing_warnings.push([ nrule, at, t('year past') ]);\n                    }\n                    if (is_range && tokens[at+2][0] < new Date().getFullYear()) {\n                        parsing_warnings.push([ nrule, at+2, t('year past') ]);\n                    }\n                /* }}} */\n\n                rule.year.push(function(tokens, at, year_from, is_range, has_period, period) { return function(date) {\n                    var ouryear = date.getFullYear();\n                    var year_to = is_range ? parseInt(tokens[at+2][0]) : year_from;\n\n                    if (ouryear < year_from ){\n                        return [false, new Date(year_from, 0, 1)];\n                    } else if (has_period) {\n                        if (year_from <= ouryear) {\n                            if (is_range && ouryear > year_to)\n                                return [false];\n                            if (period > 0) {\n                                if ((ouryear - year_from) % period === 0) {\n                                    return [true, new Date(ouryear + 1, 0, 1)];\n                                } else {\n                                    return [false, new Date(ouryear + period - 1, 0, 1)];\n                                }\n                            }\n                        }\n                    } else if (is_range) {\n                        if (ouryear <= year_to)\n                            return [true, new Date(year_to + 1, 0, 1)];\n                    } else if (ouryear === year_from) {\n                        return [true];\n                    }\n\n                    return [false];\n\n                }}(tokens, at, year_from, is_range, has_period, period));\n\n                at += 1 + (is_range ? 2 : 0) + (has_period ? (has_period === 2 ? 1 : 2) : 0);\n            } else if (matchTokens(tokens, at - 1, ',')) { // additional rule\n                throw formatWarnErrorMessage(nrule, at - 1, t('additional rule no sense'));\n            } else {\n                throw formatWarnErrorMessage(nrule, at, t('unexpected token year range', {'token': tokens[at][1]}));\n            }\n\n            if (!matchTokens(tokens, at, ','))\n                break;\n        }\n\n        return at;\n    }\n    /* }}} */\n\n    /* Week range parser (week 11-20, week 1-53/2). {{{\n     *\n     * :param tokens: List of token objects.\n     * :param at: Position where to start.\n     * :returns: Position at which the token does not belong to the selector anymore.\n     */\n    function parseWeekRange(tokens, at) {\n        for (; at < tokens.length; at++) {\n            if (matchTokens(tokens, at, 'week')) {\n                at++;\n            }\n            if (matchTokens(tokens, at, 'number')) {\n                var is_range = matchTokens(tokens, at+1, '-', 'number'), period = 0;\n                var week_from = tokens[at][0];\n                var week_to   = is_range ? tokens[at+2][0] : week_from;\n                if (week_from > week_to) {\n                    throw formatWarnErrorMessage(nrule, at+2, t('week range reverse'));\n                }\n                if (week_from < 1) {\n                    throw formatWarnErrorMessage(nrule, at, t('week negative'));\n                }\n                if (week_to > 53) {\n                    throw formatWarnErrorMessage(nrule, is_range ? at+2 : at, t('week exceed'));\n                }\n                if (is_range) {\n                    period = matchTokens(tokens, at+3, '/', 'number');\n                    if (period) {\n                        period = tokens[at+4][0];\n                        tokens[at+4][4] = 'positive_number';\n                        if (period < 2) {\n                            throw formatWarnErrorMessage(nrule, at+4, t('week period less than 2', {\n                                'weekfrom': week_from, 'weekto': week_to, 'period': period}));\n                        } else if (period > 26) {\n                            throw formatWarnErrorMessage(nrule, at+4, t('week period greater than 26', {\n                                'weekfrom': week_from\n                            }));\n                        }\n                    }\n                }\n\n                if (week_stable && (!(week_from <= 1 && week_to >= 53) || period)) {\n                    week_stable = false;\n                }\n\n                if (!period && week_from === 1 && week_to === 53) {\n                    /* Shortcut and work around bug. */\n                    rule.week.push(function() { return [true]; });\n                } else {\n\n                    rule.week.push(function(week_from, week_to, period) { return function(date) {\n                        var ourweek = getWeekNumber(date);\n\n                        // console.log(\"week_from: %s, week_to: %s\", week_from, week_to);\n                        // console.log(\"ourweek: %s, date: %s\", ourweek, date);\n\n                        // before range\n                        if (ourweek < week_from) {\n                            // console.log(\"Before: \" + getNextDateOfISOWeek(week_from, date));\n                            return [false, getNextDateOfISOWeek(week_from, date)];\n                        }\n\n                        // we're after range, set check date to next year\n                        if (ourweek > week_to) {\n                            // console.log(\"After\");\n                            return [false, getNextDateOfISOWeek(week_from, date)];\n                        }\n\n                        // we're in range\n                        if (period) {\n                            var in_period = (ourweek - week_from) % period === 0;\n                            if (in_period) {\n                                return [true, getNextDateOfISOWeek(ourweek + 1, date)];\n                            } else {\n                                return [false, getNextDateOfISOWeek(ourweek + period - 1, date)];\n                            }\n                        }\n\n                        // console.log(\"Match\");\n                        return [true, getNextDateOfISOWeek(week_to === 53 ? 1 : week_to + 1, date)];\n                    }}(week_from, week_to, period));\n                }\n\n                at += 1 + (is_range ? 2 : 0) + (period ? 2 : 0);\n            } else if (matchTokens(tokens, at - 1, ',')) { // additional rule\n                throw formatWarnErrorMessage(nrule, at - 1, t('additional rule no sense'));\n            } else {\n                throw formatWarnErrorMessage(nrule, at, t('unexpected token week range', {'token': tokens[at][1]}));\n            }\n\n            if (!matchTokens(tokens, at, ','))\n                break;\n        }\n\n        return at;\n    }\n\n    // https://stackoverflow.com/a/6117889\n    /* For a given date, get the ISO week number.\n     *\n     * Based on information at:\n     *\n     *    http://www.merlyn.demon.co.uk/weekcalc.htm#WNR\n     *\n     * Algorithm is to find nearest Thursday, it's year\n     * is the year of the week number. Then get weeks\n     * between that date and the first day of that year.\n     *\n     * Note that dates in one year can be weeks of previous\n     * or next year, overlap is up to 3 days.\n     *\n     * e.g. 2014/12/29 is Monday in week  1 of 2015\n     *      2012/1/1   is Sunday in week 52 of 2011\n     */\n    function getWeekNumber(d) {\n        // Copy date so don't modify original\n        d = new Date(+d);\n        d.setHours(0,0,0,0);\n        // Set to nearest Thursday: current date + 4 - current day number\n        // Make Sunday's day number 7\n        d.setDate(d.getDate() + 4 - (d.getDay()||7));\n        // Get first day of year\n        var yearStart = new Date(d.getFullYear(),0,1);\n        // Calculate full weeks to nearest Thursday\n        return Math.ceil(( ( (d - yearStart) / 86400000) + 1)/7)\n    }\n    // https://stackoverflow.com/a/16591175\n    function getDateOfISOWeek(w, year) {\n        var simple = new Date(year, 0, 1 + (w - 1) * 7);\n        var dow = simple.getDay();\n        var ISOweekStart = simple;\n        if (dow <= 4)\n            ISOweekStart.setDate(simple.getDate() - simple.getDay() + 1);\n        else\n            ISOweekStart.setDate(simple.getDate() + 8 - simple.getDay());\n        return ISOweekStart;\n    }\n    function getNextDateOfISOWeek(week, date) {\n        var next_date;\n        for (var i = -1; i <= 1; i++) {\n            next_date = getDateOfISOWeek(week, date.getFullYear() + i);\n            if (next_date.getTime() > date.getTime()) {\n                return next_date;\n            }\n        }\n        throw formatLibraryBugMessage();\n    }\n    /* }}} */\n\n    /* Month range parser (Jan,Feb-Mar). {{{\n     *\n     * :param tokens: List of token objects.\n     * :param at: Position where to start.\n     * :param push_to_monthday: Will push the selector into the monthday selector array which has the desired side effect of working in conjunction with the monthday selectors (either the month match or the monthday).\n     * :returns: Position at which the token does not belong to the selector anymore.\n     */\n    function parseMonthRange(tokens, at, push_to_monthday, in_selector) {\n        if (!in_selector)\n            tokens[at][3] = 'month';\n\n        for (; at < tokens.length; at++) {\n            // Use parseMonthdayRange if '<month> <daynum>' and not '<month> <hour>:<minute>'\n            if (matchTokens(tokens, at, 'month', 'number') && !matchTokens(tokens, at+2, 'timesep', 'number')) {\n                return parseMonthdayRange(tokens, at, nrule, true);\n            } else if (matchTokens(tokens, at, 'month')) {\n                // Single month (Jan) or month range (Feb-Mar)\n                var is_range = matchTokens(tokens, at+1, '-', 'month');\n\n                var month_from = tokens[at][0];\n                var month_to = is_range ? tokens[at+2][0] : month_from;\n\n                if (is_range && week_stable) {\n                    if (month_from !== (month_to + 1) % 12)\n                        week_stable = false;\n                } else {\n                    week_stable = false;\n                }\n\n                var inside = true;\n\n                // handle reversed range\n                if (month_to < month_from) {\n                    var tmp = month_to;\n                    month_to = month_from - 1;\n                    month_from = tmp + 1;\n                    inside = false;\n                }\n\n                var selector = function(month_from, month_to, inside) { return function(date) {\n                    var ourmonth = date.getMonth();\n\n                    if (month_to < month_from) {\n                        /* Handle full range. */\n                        return [!inside];\n                    }\n\n                    if (ourmonth < month_from || ourmonth > month_to) {\n                        return [!inside, dateAtNextMonth(date, month_from)];\n                    } else {\n                        return [inside, dateAtNextMonth(date, month_to + 1)];\n                    }\n                }}(month_from, month_to, inside);\n\n                if (push_to_monthday === true)\n                    rule.monthday.push(selector);\n                else\n                    rule.month.push(selector);\n\n                at += is_range ? 3 : 1;\n            } else {\n                throw formatWarnErrorMessage(nrule, at, t('unexpected token month range', {'token': tokens[at][1]}));\n            }\n\n            if (!matchTokens(tokens, at, ','))\n                break;\n        }\n\n        return at;\n    }\n\n    function dateAtNextMonth(date, month) {\n        return new Date(date.getFullYear(), month < date.getMonth() ? month + 12 : month);\n    }\n    /* }}} */\n\n    /* Month day range parser (Jan 26-31; Jan 26-Feb 26). {{{\n     *\n     * :param tokens: List of token objects.\n     * :param at: Position where to start.\n     * :param nrule: Rule number starting with 0.\n     * :param push_to_month: Will push the selector into the month selector array which has the desired side effect of working in conjunction with the month selectors (either the month match or the monthday).\n     * :returns: Position at which the token does not belong to the selector anymore.\n     */\n    function parseMonthdayRange(tokens, at, nrule, push_to_month) {\n        if (!push_to_month)\n            tokens[at][3] = 'month';\n\n        for (; at < tokens.length; at++) {\n            var has_year = [], has_month = [], has_event = [], has_calc = [], has_constrained_weekday = [];\n            has_year[0]  = matchTokens(tokens, at, 'year');\n            has_month[0] = matchTokens(tokens, at+has_year[0], 'month', 'number');\n            has_event[0] = matchTokens(tokens, at+has_year[0], 'event');\n\n            if (has_event[0])\n                has_calc[0] = getMoveDays(tokens, at+has_year[0]+1, 200, 'event like easter');\n\n            var at_range_sep;\n            if (matchTokens(tokens, at+has_year[0], 'month', 'weekday', '[')) {\n                has_constrained_weekday[0] = getConstrainedWeekday(tokens, at+has_year[0]+3);\n                has_calc[0] = getMoveDays(tokens, has_constrained_weekday[0][1], 6, 'constrained weekdays');\n                at_range_sep = has_constrained_weekday[0][1] + (typeof has_calc[0] === 'object' && has_calc[0][1] ? 3 : 0);\n            } else {\n                at_range_sep = at+has_year[0]\n                    + (has_event[0]\n                        ? (typeof has_calc[0] === 'object' && has_calc[0][1] ? 4 : 1)\n                        : 2);\n            }\n\n            var at_sec_event_or_month;\n            if ((has_month[0] || has_event[0] || has_constrained_weekday[0]) && matchTokens(tokens, at_range_sep, '-')) {\n                has_year[1] = matchTokens(tokens, at_range_sep+1, 'year');\n                at_sec_event_or_month = at_range_sep+1+has_year[1];\n                has_month[1] = matchTokens(tokens, at_sec_event_or_month, 'month', 'number');\n                if (!has_month[1]) {\n                    has_event[1] = matchTokens(tokens, at_sec_event_or_month, 'event');\n                    if (has_event[1]) {\n                        has_calc[1] = getMoveDays(tokens, at_sec_event_or_month+1, 366, 'event like easter');\n                    } else if (matchTokens(tokens, at_sec_event_or_month, 'month', 'weekday', '[')) {\n                        has_constrained_weekday[1] = getConstrainedWeekday(tokens, at_sec_event_or_month+3);\n                        has_calc[1] = getMoveDays(tokens, has_constrained_weekday[1][1], 6, 'constrained weekdays');\n                    }\n                }\n            }\n\n            // monthday range like Jan 26-Feb 26 {{{\n            if (has_year[0] === has_year[1] && (has_month[1] || has_event[1] || has_constrained_weekday[1])) {\n\n                if (has_month[0])\n                    checkIfDateIsValid(tokens[at+has_year[0]][0], tokens[at+has_year[0]+1][0], nrule, at+has_year[0]+1);\n                if (has_month[1])\n                    checkIfDateIsValid(tokens[at_sec_event_or_month][0], tokens[at_sec_event_or_month+1][0], nrule, at_sec_event_or_month+1);\n\n                var selector = function(tokens, at, nrule, has_year, has_event, has_calc, at_sec_event_or_month, has_constrained_weekday) { return function(date) {\n                    var start_of_next_year = new Date(date.getFullYear() + 1, 0, 1);\n\n                    var movableDays, from_date;\n                    if (has_event[0]) {\n                        movableDays = getMovableEventsForYear(has_year[0] ? parseInt(tokens[at][0]) : date.getFullYear());\n                        from_date = movableDays[tokens[at+has_year[0]][0]];\n\n                        if (typeof has_calc[0] === 'object' && has_calc[0][1]) {\n                            var from_year_before_calc = from_date.getFullYear();\n                            from_date.setDate(from_date.getDate() + has_calc[0][0]);\n                            if (from_year_before_calc !== from_date.getFullYear())\n                                throw formatWarnErrorMessage(nrule, at+has_year[0]+has_calc[0][1]*3,\n                                    t('movable not in year', {'name': tokens[at+has_year[0]][0], 'days': has_calc[0][0]}));\n                        }\n                    } else if (has_constrained_weekday[0]) {\n                        from_date = getDateForConstrainedWeekday((has_year[0] ? tokens[at][0] : date.getFullYear()), // year\n                            tokens[at+has_year[0]][0], // month\n                            tokens[at+has_year[0]+1][0], // weekday\n                            has_constrained_weekday[0],\n                            has_calc[0]);\n                    } else {\n                        from_date = new Date((has_year[0] ? tokens[at][0] : date.getFullYear()),\n                            tokens[at+has_year[0]][0], tokens[at+has_year[0]+1][0]);\n                    }\n\n                    var to_date;\n                    if (has_event[1]) {\n                        movableDays = getMovableEventsForYear(has_year[1]\n                                    ? parseInt(tokens[at_sec_event_or_month-1][0])\n                                    : date.getFullYear());\n                        to_date = movableDays[tokens[at_sec_event_or_month][0]];\n\n                        if (typeof has_calc[1] === 'object' && has_calc[1][1]) {\n                            var to_year_before_calc = to_date.getFullYear();\n                            to_date.setDate(to_date.getDate() + has_calc[1][0]);\n                            if (to_year_before_calc !== to_date.getFullYear()) {\n                                throw formatWarnErrorMessage(nrule, at_sec_event_or_month+has_calc[1][1],\n                                    t('movable not in year', {'name': tokens[at_sec_event_or_month][0], 'days':  has_calc[1][0] }));\n                            }\n                        }\n                    } else if (has_constrained_weekday[1]) {\n                        to_date = getDateForConstrainedWeekday((has_year[1] ? tokens[at_sec_event_or_month-1][0] : date.getFullYear()), // year\n                            tokens[at_sec_event_or_month][0],   // month\n                            tokens[at_sec_event_or_month+1][0], // weekday\n                            has_constrained_weekday[1],\n                            has_calc[1]);\n                    } else {\n                        to_date = new Date((has_year[1] ? tokens[at_sec_event_or_month-1][0] : date.getFullYear()),\n                            tokens[at_sec_event_or_month][0], tokens[at_sec_event_or_month+1][0] + 1);\n                    }\n\n                    var inside = true;\n\n                    if (to_date < from_date) {\n                        var tmp = to_date;\n                        to_date = from_date;\n                        from_date = tmp;\n                        inside = false;\n                    }\n\n                    if (date.getTime() < from_date.getTime()) {\n                        return [!inside, from_date];\n                    } else if (date.getTime() < to_date.getTime()) {\n                        return [inside, to_date];\n                    } else {\n                        if (has_year[0]) {\n                            return [!inside];\n                        } else {\n                            return [!inside, start_of_next_year];\n                        }\n                    }\n                }}(tokens, at, nrule, has_year, has_event, has_calc, at_sec_event_or_month, has_constrained_weekday);\n\n                if (push_to_month === true)\n                    rule.month.push(selector);\n                else\n                    rule.monthday.push(selector);\n\n                at = (has_constrained_weekday[1]\n                        ? has_constrained_weekday[1][1]\n                        : at_sec_event_or_month + (has_event[1] ? 1 : 2))\n                    + (typeof has_calc[1] === 'object' ? has_calc[1][1] : 0);\n\n                /* }}} */\n                // Monthday range like Jan 26-31 {{{\n            } else if (has_month[0]) {\n\n                has_year = has_year[0];\n                var year = tokens[at][0]; // Could be month if has no year. Tested later.\n                var month = tokens[at+has_year][0];\n\n                var first_round = true;\n\n                do {\n                    var range_from = tokens[at+1 + has_year][0];\n                    var is_range = matchTokens(tokens, at+2+has_year, '-', 'number');\n                    var period = undefined;\n                    var range_to = tokens[at+has_year+(is_range ? 3 : 1)][0] + 1;\n                    if (is_range && matchTokens(tokens, at+has_year+4, '/', 'number')) {\n                        period = tokens[at+has_year+5][0];\n                        tokens[at+has_year+5][4] = 'positive_number';\n                        checkPeriod(at+has_year+5, period, 'day');\n                    }\n\n                    if (first_round) {\n                        var at_timesep_if_monthRange = at + has_year + 1 // at month number\n                            + (is_range ? 2 : 0) + (period ? 2 : 0)\n                            + !(is_range || period); // if not range nor has period, add one\n\n                        // Check for '<month> <timespan>'\n                        if (matchTokens(tokens, at_timesep_if_monthRange, 'timesep', 'number')\n                                && (matchTokens(tokens, at_timesep_if_monthRange+2, '+')\n                                    || matchTokens(tokens, at_timesep_if_monthRange+2, '-')\n                                    || oh_mode !== 0)\n                            ) {\n                                return parseMonthRange(tokens, at, true, true);\n                        }\n                    }\n\n                    // error checking {{{\n                    if (range_to < range_from)\n                        throw formatWarnErrorMessage(nrule, at+has_year+3, t('day range reverse'));\n\n                    checkIfDateIsValid(month, range_from, nrule, at+1 + has_year);\n                    checkIfDateIsValid(month, range_to - 1 /* added previously */,\n                        nrule, at+has_year+(is_range ? 3 : 1));\n                    /* }}} */\n\n                    var selector = function(year, has_year, month, range_from, range_to, period) { return function(date) {\n                        var start_of_next_year = new Date(date.getFullYear() + 1, 0, 1);\n\n                        var from_date = new Date(has_year ? year : date.getFullYear(),\n                            month, range_from);\n                        if (month === 1 && range_from !== from_date.getDate()) // Only on leap years does this day exist.\n                            return [false]; // If day 29 does not exist,\n                                            // then the date object adds one day to date\n                                            // and this selector should not match.\n                        var to_date   = new Date(from_date.getFullYear(),\n                            month, range_to);\n                        if (month === 1 && is_range && range_to !== to_date.getDate()) // Only on leap years does this day exist.\n                            return [false];\n\n                        if (date.getTime() < from_date.getTime())\n                            return [false, from_date];\n                        else if (date.getTime() >= to_date.getTime())\n                            return [false, start_of_next_year];\n                        else if (!period)\n                            return [true, to_date];\n\n                        var nday = Math.floor((date.getTime() - from_date.getTime()) / msec_in_day);\n                        var in_period = nday % period;\n\n                        if (in_period === 0)\n                            return [true, new Date(date.getFullYear(), date.getMonth(), date.getDate() + 1)];\n                        else\n                            return [false, new Date(date.getFullYear(), date.getMonth(), date.getDate() + period - in_period)];\n\n                    }}(year, has_year, month, range_from, range_to, period);\n\n                    if (push_to_month === true)\n                        rule.month.push(selector);\n                    else\n                        rule.monthday.push(selector);\n\n                    at += 2 + has_year + (is_range ? 2 : 0) + (period ? 2 : 0);\n\n                    first_round = false;\n                }\n                while (matchTokens(tokens, at, ',', 'number'))\n\n\n                /* }}} */\n                // Only event like easter {{{\n            } else if (has_event[0]) {\n\n                var selector = function(tokens, at, nrule, has_year, add_days) { return function(date) {\n\n                    // console.log('enter selector with date: ' + date);\n                    var movableDays = getMovableEventsForYear((has_year ? tokens[at][0] : date.getFullYear()));\n                    var event_date = movableDays[tokens[at+has_year][0]];\n                    if (!event_date)\n                        throw t('movable no formula', {'name': tokens[at+has_year][0]});\n\n                    if (add_days[0]) {\n                        event_date.setDate(event_date.getDate() + add_days[0]);\n                        if (date.getFullYear() !== event_date.getFullYear())\n                            throw formatWarnErrorMessage(nrule, at+has_year+add_days[1], t('movable not in year', {\n                                'name': tokens[at+has_year][0], 'days': add_days[0]}));\n                    }\n\n                    if (date.getTime() < event_date.getTime())\n                        return [false, event_date];\n                    // else if (date.getTime() < event_date.getTime() + msec_in_day) // does not work because of daylight saving times\n                    else if (event_date.getMonth() * 100 + event_date.getDate() === date.getMonth() * 100 + date.getDate())\n                        return [true, new Date(date.getFullYear(), date.getMonth(), date.getDate() + 1)];\n                    else\n                        return [false, new Date(date.getFullYear() + 1, 0, 1)];\n\n                }}(tokens, at, nrule, has_year[0], has_calc[0]);\n\n                if (push_to_month === true)\n                    rule.month.push(selector);\n                else\n                    rule.monthday.push(selector);\n\n                at += has_year[0] + has_event[0] + (typeof has_calc[0][1] === 'number' && has_calc[0][1] ? 3 : 0);\n                /* }}} */\n            } else if (has_constrained_weekday[0]) {\n                at = parseMonthRange(tokens, at);\n            } else if (matchTokens(tokens, at, 'month')) {\n                return parseMonthRange(tokens, at, true, true);\n            } else {\n                // throw 'Unexpected token in monthday range: \"' + tokens[at] + '\"';\n                return at;\n            }\n\n            if (!matchTokens(tokens, at, ','))\n                break;\n        }\n\n        return at;\n    }\n    /* }}} */\n\n    /* Main selector traversal function (return state array for date). {{{\n     * Checks for given date which rule and those which state and comment applies.\n     *\n     * :param date: Date object.\n     * :returns: Array:\n     *            0. resultstate: State: true for 'open', false for 'closed'.\n     *            1. changedate: Next change as date object.\n     *            2. unknown: true if state open is not sure.\n     *            3. comment: Comment which applies for this time range (from date to changedate).\n     *            4. match_rule: Rule number starting with 0 (nrule).\n     */\n    this.getStatePair = function(date) {\n        var resultstate = false;\n        var changedate;\n        var unknown = false;\n        var comment;\n        var match_rule;\n\n        var date_matching_rules = [];\n\n        /* Go though all date selectors and check if they return something\n         * else than closed for the given date.\n         */\n        for (var nrule = 0; nrule < rules.length; nrule++) {\n            var matching_date_rule = true;\n            // console.log(nrule, 'length',  rules[nrule].date.length);\n\n            /* Try each date selector type. */\n            for (var ndateselector = 0; ndateselector < rules[nrule].date.length; ndateselector++) {\n                var dateselectors = rules[nrule].date[ndateselector];\n                // console.log(nrule, ndateselector);\n\n                var has_matching_selector = false;\n                for (var datesel = 0; datesel < dateselectors.length; datesel++) {\n                    var res = dateselectors[datesel](date);\n                    if (res[0]) {\n                        has_matching_selector = true;\n\n                        if (typeof res[2] === 'string') { // holiday name\n                            comment = [ res[2], nrule ];\n                        }\n\n                    }\n                    if (typeof changedate === 'undefined' || (typeof res[1] === 'object' && res[1].getTime() < changedate.getTime()))\n                        changedate = res[1];\n                }\n\n                if (!has_matching_selector) {\n                    matching_date_rule = false;\n                    // We can ignore other date selectors, as the state won't change\n                    // anyway until THIS selector matches (due to conjunction of date\n                    // selectors of different types).\n                    // This is also an optimization, if widest date selector types\n                    // are checked first.\n                    break;\n                }\n            }\n\n            if (matching_date_rule) {\n                /* The following lines implement date overwriting logic (e.g. for\n                 * \"Mo-Fr 10:00-20:00; We 10:00-16:00\", We rule overrides Mo-Fr rule partly (We).\n                 *\n                 * This is the only way to be consistent. I thought about (\"22:00-02:00; Tu 12:00-14:00\") letting Th override 22:00-02:00 partly:\n                 * Like: Th 00:00-02:00,12:00-14:00 but this would result in including 22:00-00:00 for Th which is probably not what you want.\n                 */\n                if ((rules[nrule].date.length > 0 || nrule > 0 && rules[nrule].meaning && rules[nrule-1].date.length === 0)\n                        && (rules[nrule].meaning || rules[nrule].unknown)\n                        && !rules[nrule].wrapped && !rules[nrule].additional && !rules[nrule].fallback\n                    ) {\n\n                    // var old_date_matching_rules = date_matching_rules;\n                    date_matching_rules = [];\n                    // for (var nrule = 0; nrule < old_date_matching_rules.length; nrule++) {\n                    //     if (!rules[old_date_matching_rules[nrule]].wrapped)\n                    //         date_matching_rules.push(nrule);\n                    // }\n                }\n                date_matching_rules.push(nrule);\n            }\n        }\n\n        // console.log(date_matching_rules);\n        for (var nrule = 0; nrule < date_matching_rules.length; nrule++) {\n            var rule = date_matching_rules[nrule];\n\n            // console.log('Processing rule ' + rule + ': with date ' + date\n                // + ' and ' + rules[rule].time.length + ' time selectors (comment: \"' + rules[rule].comment + '\").');\n\n            /* There is no time specified, state applies to the whole day. */\n            if (rules[rule].time.length === 0) {\n                // console.log('there is no time', date);\n                if (!rules[rule].fallback || (rules[rule].fallback && !(resultstate || unknown))) {\n                    resultstate = rules[rule].meaning;\n                    unknown     = rules[rule].unknown;\n                    match_rule  = rule;\n\n                    // if (rules[rule].fallback)\n                        // break rule; // fallback rule matched, no need for checking the rest\n                    // WRONG: What if closing rules follow?\n                }\n            }\n\n            for (var timesel = 0; timesel < rules[rule].time.length; timesel++) {\n                var res = rules[rule].time[timesel](date);\n\n                // console.log('res:', res);\n                if (res[0]) {\n                    if (!rules[rule].fallback || (rules[rule].fallback && !(resultstate || unknown))) {\n                        resultstate = rules[rule].meaning;\n                        unknown     = rules[rule].unknown;\n                        match_rule  = rule;\n\n                        /* Reset open end comment */\n                        if (typeof comment === 'object' && comment[0] === t('open end'))\n                            comment = undefined;\n\n                        // open end\n                        if (res[2] === true && (resultstate || unknown)) {\n                            comment = [ t('open end'), match_rule ];\n\n                            resultstate = false;\n                            unknown     = true;\n\n                            /* Hack to make second rule in '07:00+,12:00-16:00; 16:00-24:00 closed \"needed because of open end\"' obsolete {{{ */\n                            if (typeof rules[rule].time[timesel+1] === 'function') {\n\n                                var next_res = rules[rule].time[timesel+1](date);\n                                if (  !next_res[0]\n                                    // && next_res[2]\n                                    && typeof next_res[1] === 'object'\n                                    // && getValueForDate(next_res[1], true) !== getValueForDate(date, true) // Just to be sure.\n                                    && rules[rule].time[timesel](new Date(date.getTime() - 1))[0]\n                                    /* To distinguish the following two values:\n                                     *     'sunrise-14:00,14:00+',\n                                     *   '07:00+,12:00-16:00',\n                                     */\n                                    ) {\n\n                                    // console.log(\"07:00+,12:00-16:00 matched.\");\n\n                                    resultstate = false;\n                                    unknown     = false;\n                                }\n                            }\n\n                            /* Hack to handle '17:00+,13:00-02:00' {{{ */\n                            /* Not enabled. To complicated, just dont use them \n                             * It gets even crazier \n                             * Time wrapping over midnight is\n                             * stored in the next internal rule:\n                             * '17:00-00:00 unknown \"Specified as open end. Closing time was guessed.\", 13:00-00:00 open' // First internal rule.\n                             * + ', ' overwritten part: 00:00-03:00 open + '00:00-02:00 open', // Second internal rule.\n                             */\n                            // eslint-disable-next-line no-constant-condition\n                            if (    false\n                                    && typeof rules[rule-1] === 'object'\n                                    && rules[rule].build_from_token_rule.toString() === rules[rule-1].build_from_token_rule.toString()\n                                    && typeof rules[rule] === 'object'\n                                    && rules[rule].build_from_token_rule.toString() === rules[rule].build_from_token_rule.toString()\n                                    ) {\n\n                                var last_wrapping_time_selector = rules[rule].time[rules[rule].time.length - 1];\n                                var last_w_res = last_wrapping_time_selector(new Date(date.getTime() - 1));\n                                // console.log(last_w_res);\n\n                                if (    last_w_res[0]\n                                        &&  typeof last_w_res[2] === 'undefined'\n                                        && (typeof last_w_res[2] === 'undefined' || last_w_res[2] === false) // Do not match for 'Tu 23:59-40:00+'\n                                        &&  typeof last_w_res[1] === 'object'\n                                        && date.getTime() === last_w_res[1].getTime()\n                                    ) {\n\n                                    // '05:00-06:00,17:00+,13:00-02:00',\n\n                                    // console.log(\"17:00+,13:00-02:00 matched.\");\n                                    // console.log(JSON.stringify(rules, null, '    '));\n\n                                    resultstate = false;\n                                    unknown     = false;\n                                }\n                            /* }}} */\n                            }\n                            /* }}} */\n                        }\n\n                        if (rules[rule].fallback) {\n                            if (typeof changedate === 'undefined' || (typeof res[1] !== 'undefined' && res[1] < changedate)) {\n                                // FIXME: Changing undefined does not break the test framework.\n                                changedate = res[1];\n                            }\n\n                            // break rule; // Fallback rule matched, no need for checking the rest.\n                            // WRONG: What if 'off' is used after fallback rule.\n                        }\n                    }\n                }\n                if (typeof changedate === 'undefined' || (typeof res[1] === 'object' && res[1] < changedate))\n                    changedate = res[1];\n            }\n        }\n\n        if (typeof rules[match_rule] === 'object' && typeof rules[match_rule].comment === 'string') {\n            /* Only use comment if one is explicitly specified. */\n            comment = rules[match_rule].comment;\n        } else if (typeof comment === 'object') {\n            if (comment[1] === match_rule) {\n                comment = comment[0];\n            } else {\n                comment = undefined;\n            }\n        }\n\n        // console.log('changedate', changedate, resultstate, comment, match_rule);\n        return [ resultstate, changedate, unknown, comment, match_rule ];\n    };\n    /* }}} */\n\n    /* Generate prettified value for selector based on tokens. {{{\n     *\n     * :param tokens: List of token objects.\n     * :param at: Position where to start.\n     * :param last_at: Position where to stop.\n     * :param conf: Configuration options.\n     * :returns: Prettified value.\n     */\n    function prettifySelector(tokens, selector_start, selector_end, selector_type, conf) {\n\n        var prettified_value = '';\n        var at = selector_start;\n        // console.log(selector_type);\n        while (at <= selector_end) {\n            // console.log('At: ' + at + ', token: ' + tokens[at]);\n            if (matchTokens(tokens, at, 'weekday')) {\n                if (!conf.leave_weekday_sep_one_day_betw\n                    && at - selector_start > 1 && (matchTokens(tokens, at-1, ',') || matchTokens(tokens, at-1, '-'))\n                    && matchTokens(tokens, at-2, 'weekday')\n                    && tokens[at][0] === (tokens[at-2][0] + 1) % 7) {\n                        prettified_value = prettified_value.substring(0, prettified_value.length - 1) + conf.sep_one_day_between;\n                }\n                prettified_value += weekdays[tokens[at][0]];\n            } else if (at - selector_start > 0 // e.g. '09:0' -> '09:00'\n                    && selector_type === 'time'\n                    && matchTokens(tokens, at-1, 'timesep')\n                    && matchTokens(tokens, at, 'number')) {\n                prettified_value += (tokens[at][0] < 10 ? '0' : '') + tokens[at][0].toString();\n            } else if (selector_type === 'time' // e.g. '9:00' -> ' 09:00'\n                    && conf.zero_pad_hour\n                    && at !== tokens.length\n                    && matchTokens(tokens, at, 'number')\n                    && matchTokens(tokens, at+1, 'timesep')) {\n                prettified_value += (\n                        tokens[at][0] < 10 ?\n                            (tokens[at][0] === 0 && conf.one_zero_if_hour_zero ?\n                             '' : '0') :\n                            '') + tokens[at][0].toString();\n            } else if (selector_type === 'time' // e.g. '9-18' -> '09:00-18:00'\n                    && at + 2 <= selector_end\n                    && matchTokens(tokens, at, 'number')\n                    && matchTokens(tokens, at+1, '-')\n                    && matchTokens(tokens, at+2, 'number')) {\n                prettified_value += (tokens[at][0] < 10 ?\n                        (tokens[at][0] === 0 && conf.one_zero_if_hour_zero ? '' : '0')\n                        : '') + tokens[at][0].toString();\n                prettified_value += ':00-'\n                    + (tokens[at+2][0] < 10 ? '0' : '') + tokens[at+2][0].toString()\n                    + ':00';\n                at += 2;\n            } else if (matchTokens(tokens, at, 'comment')) {\n                prettified_value += '\"' + tokens[at][0].toString() + '\"';\n            } else if (matchTokens(tokens, at, 'closed')) {\n                prettified_value += (conf.leave_off_closed ? tokens[at][0] : conf.keyword_for_off_closed);\n            } else if (at - selector_start > 0 && matchTokens(tokens, at, 'number')\n                    && (selector_type === 'month' || selector_type === 'week')) {\n                prettified_value +=\n                    (matchTokens(tokens, at-1, 'month') || matchTokens(tokens, at-1, 'week') ? ' ' : '')\n                    + (conf.zero_pad_month_and_week_numbers && tokens[at][4] !== 'positive_number' && tokens[at][0] < 10 ? '0' : '')\n                    + tokens[at][0];\n            } else if (at - selector_start > 0 && matchTokens(tokens, at, 'month')\n                    && matchTokens(tokens, at-1, 'year')) {\n                prettified_value += ' ' + months[[tokens[at][0]]];\n            } else if (at - selector_start > 0 && matchTokens(tokens, at, 'event')\n                    && matchTokens(tokens, at-1, 'year')) {\n                prettified_value += ' ' + tokens[at][0];\n            } else if (matchTokens(tokens, at, 'month')) {\n                prettified_value += months[[tokens[at][0]]];\n                if (at + 1 <= selector_end && matchTokens(tokens, at+1, 'weekday'))\n                    prettified_value += ' ';\n            } else if (at + 2 <= selector_end\n                    && (matchTokens(tokens, at, '-') || matchTokens(tokens, at, '+'))\n                    && matchTokens(tokens, at+1, 'number', 'calcday')) {\n                prettified_value += ' ' + tokens[at][0] + tokens[at+1][0] + ' day' + (Math.abs(tokens[at+1][0]) === 1 ? '' : 's');\n                at += 2;\n            } else if (at === selector_end\n                    && selector_type === 'weekday'\n                    && tokens[at][0] === ':') {\n                // Do nothing.\n            } else if (at === selector_end\n                    && selector_type === 'time'\n                    && tokens[at][0] === ',') {\n                /* Remove trailing , which is ignored in parseTimeRange. */\n            } else {\n                prettified_value += tokens[at][0].toString();\n            }\n            at++;\n        }\n        return prettified_value;\n    }\n    /* }}} */\n\n    //======================================================================\n    // Public interface {{{\n    // All functions below are considered public.\n    //======================================================================\n\n    // Simple API {{{\n\n    this.getState = function(date) {\n        var it = this.getIterator(date);\n        return it.getState();\n    };\n\n    this.getUnknown = function(date) {\n        var it = this.getIterator(date);\n        return it.getUnknown();\n    };\n\n    this.getStateString = function(date, past) {\n        var it = this.getIterator(date);\n        return it.getStateString(past);\n    };\n\n    this.getComment = function(date) {\n        var it = this.getIterator(date);\n        return it.getComment();\n    };\n\n    this.getMatchingRule = function(date) {\n        var it = this.getIterator(date);\n        return it.getMatchingRule();\n    };\n\n    /* Not available for iterator API {{{ */\n    /* getWarnings: Get warnings, empty list if none {{{ */\n    this.getWarnings = function() {\n        var it = this.getIterator();\n        return getWarnings(it);\n    };\n    /* }}} */\n\n    /* prettifyValue: Get a nicely formated value {{{ */\n    this.prettifyValue = function(argument_hash) {\n        this.getWarnings();\n        /* getWarnings has to be run before prettifyValue because some\n         * decisions if certain aspects makes sense to prettify or not\n         * are influenced by warnings.\n         * Basically, both functions depend on each other in some way :(\n         * See done_with_selector_reordering.\n         */\n        return prettifyValue(argument_hash);\n    };\n    /* }}} */\n\n    /* getNextChange: Get time of next status change {{{ */\n    this.getNextChange = function(date, maxdate) {\n        var it = this.getIterator(date);\n        if (!it.advance(maxdate))\n            return undefined;\n        return it.getDate();\n    };\n    /* }}} */\n\n    /* isWeekStable: Checks whether open intervals are same for every week. {{{ */\n    this.isWeekStable = function() {\n        return week_stable;\n    };\n    /* }}} */\n\n    /* isEqualTo: Check if this opening_hours object has the same meaning as the given opening_hours object. {{{ */\n    this.isEqualTo = function(second_oh_object, start_date) {\n        if (typeof start_date === 'undefined') {\n            var start_date = new Date();\n        }\n        var datelimit;\n\n        if (this.isWeekStable() && second_oh_object.isWeekStable()) {\n            datelimit = new Date(start_date.getTime() + msec_in_day * 10);\n        // } else if (this.isWeekStable() !== second_oh_object.isWeekStable()) {\n        //     return [ false,\n        //         {\n        //             'reason': 'isWeekStable do not match',\n        //         }\n        //     ];\n        } else {\n            datelimit = new Date(start_date.getTime() + msec_in_day * 366 * 5);\n        }\n\n        var first_it = this.getIterator(start_date);\n        var second_it = second_oh_object.getIterator(start_date);\n\n        while (first_it.advance(datelimit)) {\n            second_it.advance(datelimit);\n\n            var not_equal = [];\n\n            if (first_it.getDate().getTime() !== second_it.getDate().getTime()) {\n                not_equal.push('getDate');\n            }\n\n            if (first_it.getState() !== second_it.getState()) {\n                not_equal.push('getState');\n            }\n\n            if (first_it.getUnknown() !== second_it.getUnknown()) {\n                not_equal.push('getUnknown');\n            }\n\n            if (first_it.getComment() !== second_it.getComment()) {\n                not_equal.push('getComment');\n            }\n\n            if (not_equal.length) {\n                var deviation_for_time = {};\n                deviation_for_time[first_it.getDate().getTime()] = not_equal;\n                return [ false,\n                    {\n                        'matching_rule': first_it.getMatchingRule(),\n                        'matching_rule_other': second_it.getMatchingRule(),\n                        'deviation_for_time': deviation_for_time,\n                    }\n                ];\n            }\n        }\n\n        return [ true ];\n    };\n    /* }}} */\n    /* }}} */\n    /* }}} */\n\n    // High-level API {{{\n    /* getOpenIntervals: Get array of open intervals between two dates {{{ */\n    this.getOpenIntervals = function(from, to) {\n        var res = [];\n\n        var it = this.getIterator(from);\n\n        if (it.getState() || it.getUnknown()) {\n            res.push([from, undefined, it.getUnknown(), it.getComment()]);\n        }\n\n        while (it.advance(to)) {\n            if (it.getState() || it.getUnknown()) {\n                if (res.length !== 0 && typeof res[res.length - 1][1] === 'undefined') {\n                    // last state was also open or unknown\n                    res[res.length - 1][1] = it.getDate();\n                }\n                res.push([it.getDate(), undefined, it.getUnknown(), it.getComment()]);\n            } else {\n                if (res.length !== 0 && typeof res[res.length - 1][1] === 'undefined') {\n                    // only use the first time as closing/change time and ignore closing times which might follow\n                    res[res.length - 1][1] = it.getDate();\n                }\n            }\n        }\n\n        if (res.length > 0 && typeof res[res.length - 1][1] === 'undefined') {\n            res[res.length - 1][1] = to;\n        }\n\n        return res;\n    };\n    /* }}} */\n\n    /* getOpenDuration: Get total number of milliseconds a facility is open,unknown within a given date range {{{ */\n    this.getOpenDuration = function(from, to) {\n\n        var open    = 0;\n        var unknown = 0;\n\n        var it = this.getIterator(from);\n        var prevdate    = (it.getState() || it.getUnknown()) ? from : undefined;\n        var prevstate   = it.getState();\n        var prevunknown = it.getUnknown();\n\n        while (it.advance(to)) {\n            if (it.getState() || it.getUnknown()) {\n\n                if (typeof prevdate === 'object') {\n                    // last state was also open or unknown\n                    if (prevunknown) //\n                        unknown += it.getDate().getTime() - prevdate.getTime();\n                    else if (prevstate)\n                        open    += it.getDate().getTime() - prevdate.getTime();\n                }\n\n                prevdate    = it.getDate();\n                prevstate   = it.getState();\n                prevunknown = it.getUnknown();\n                // console.log('if', prevdate, open / (1000 * 60 * 60), unknown / (1000 * 60 * 60));\n            } else {\n                // console.log('else', prevdate);\n                if (typeof prevdate === 'object') {\n                    if (prevunknown)\n                        unknown += it.getDate().getTime() - prevdate.getTime();\n                    else\n                        open    += it.getDate().getTime() - prevdate.getTime();\n                    prevdate = undefined;\n                }\n            }\n        }\n\n        if (typeof prevdate === 'object') {\n            if (prevunknown)\n                unknown += to.getTime() - prevdate.getTime();\n            else\n                open    += to.getTime() - prevdate.getTime();\n        }\n\n        return [ open, unknown ];\n    };\n    /* }}} */\n    /* }}} */\n\n    // Iterator API {{{\n    this.getIterator = function(date) {\n        return new function(oh) {\n            if (typeof date === 'undefined')\n                date = new Date();\n\n            var prevstate = [ undefined, date, undefined, undefined, undefined ];\n            var state = oh.getStatePair(date);\n\n            /* getDate {{{ */\n            this.getDate = function() {\n                return prevstate[1];\n            };\n            /* }}} */\n\n            /* setDate {{{ */\n            this.setDate = function(date) {\n                if (typeof date !== 'object')\n                    throw t('date parameter needed');\n\n                prevstate = [ undefined, date, undefined, undefined, undefined ];\n                state     = oh.getStatePair(date);\n            };\n            /* }}} */\n\n            /* getState: Check whether facility is `open' {{{ */\n            this.getState = function() {\n                return state[0];\n            };\n            /* }}} */\n\n            /* getUnknown: Checks whether the opening state is conditional or unknown {{{ */\n            this.getUnknown = function() {\n                return state[2];\n            };\n            /* }}} */\n\n            /* getStateString: Get state string. Either 'open', 'unknown' or 'closed' {{{ */\n            this.getStateString = function(past) {\n                return (state[0] ? 'open' : (state[2] ? 'unknown' : (past ? 'closed' : 'close')));\n            };\n            /* }}} */\n\n            /* getComment: Get the comment, undefined in none {{{ */\n            this.getComment = function() {\n                return state[3];\n            };\n            /* }}} */\n\n            /* getMatchingRule: Get the rule which matched thus deterrents the current state {{{ */\n            this.getMatchingRule = function() {\n                if (typeof state[4] === 'undefined')\n                    return undefined;\n\n                return rules[state[4]].build_from_token_rule[2];\n            };\n            /* }}} */\n\n            /* advance: Advances to the next position {{{ */\n            this.advance = function(datelimit) {\n                if (typeof datelimit === 'undefined') {\n                    datelimit = new Date(prevstate[1].getTime() + msec_in_day * 366 * 5);\n                } else if (datelimit.getTime() <= prevstate[1].getTime()) {\n                    return false; /* The limit for advance needs to be after the current time. */\n                }\n\n                do {\n                    if (typeof state[1] === 'undefined') {\n                        return false; /* open range, we won't be able to advance */\n                    }\n\n                    // console.log('\\n' + 'previous check time:', prevstate[1]\n                    //     + ', current check time:',\n                    //     state[1],\n                    //     (state[0] ? 'open' : (state[2] ? 'unknown' : 'closed'))\n                    //     + ', comment:', state[3]\n                    //     + ', match_rule:', state[4]);\n\n                    if (state[1].getTime() <= prevstate[1].getTime()) {\n                        /* We're going backwards or staying at the same time.\n                         * This most likely indicates an error in a selector code.\n                         */\n                        throw 'Fatal: infinite loop in nextChange';\n                    }\n\n                    if (state[1].getTime() >= datelimit.getTime()) {\n                        /* Don't advance beyond limits. */\n                        return false;\n                    }\n\n                    // do advance\n                    prevstate = state;\n                    state = oh.getStatePair(prevstate[1]);\n                    // console.log(state);\n                } while (state[0] === prevstate[0] && state[2] === prevstate[2] && state[3] === prevstate[3]);\n                return true;\n            };\n            /* }}} */\n        }(this);\n    };\n    /* }}} */\n\n    /* }}} */\n}\n\n/* vim: set ts=4 sw=4 tw=0 et foldmarker={{{,}}} foldlevel=0 foldmethod=marker : */\n"],"names":["PI","Math","sin","cos","tan","asin","atan","atan2","acos","rad","dayMs","J1970","J2000","fromJulian","j","Date","toDays","date","valueOf","toJulian","e","rightAscension","l","b","declination","azimuth","H","phi","dec","altitude","siderealTime","d","lw","solarMeanAnomaly","eclipticLongitude","M","sunCoords","L","ra","SunCalc","lat","lng","c","times","addTime","angle","riseName","setName","push","J0","approxTransit","Ht","n","solarTransitJ","ds","getSetJ","h","w","hourAngle","moonCoords","F","dt","dist","hoursLater","getTimes","height","i","len","time","Jset","Jrise","dh","sqrt","observerAngle","round","julianCycle","Jnoon","result","solarNoon","nadir","length","getMoonPosition","pa","astroRefraction","distance","parallacticAngle","getMoonIllumination","s","m","sdist","inc","fraction","phase","getMoonTimes","inUTC","t","setUTCHours","setHours","h1","h2","rise","set","a","xe","ye","roots","x1","x2","dx","hc","h0","abs","module","exports","isString","obj","defer","res","rej","promise","Promise","resolve","reject","makeString","object","lastOfPathSeparatorRegExp","cleanKey","key","indexOf","replace","canNotTraverseDeeper","getLastOfPath","path","Empty","stack","split","stackIndex","Object","prototype","hasOwnProperty","call","k","setPath","newValue","undefined","p","slice","last","getPath","deepExtend","target","source","overwrite","prop","String","regexEscape","str","_entityMap","escape","data","chars","looksLikeObjectPathRegExpCache","constructor","capacity","this","regExpMap","Map","regExpQueue","getRegExp","pattern","regExpFromCache","get","regExpNew","RegExp","delete","shift","deepFind","keySeparator","arguments","tokens","current","next","nextPath","getCleanedCode","code","consoleLogger","type","log","args","output","warn","error","console","apply","Logger","concreteLogger","options","init","prefix","logger","debug","_len","Array","_key","forward","_len2","_key2","_len3","_key3","deprecate","_len4","_key4","lvl","debugOnly","create","moduleName","clone","baseLogger","EventEmitter","observers","on","events","listener","forEach","event","numListeners","off","emit","from","entries","_ref","observer","numTimesAdded","_ref2","ResourceStore","ns","defaultNS","super","ignoreJSONStructure","addNamespaces","removeNamespaces","index","splice","getResource","isArray","join","addResource","value","silent","concat","addResources","resources","addResourceBundle","deep","skipCopy","pack","JSON","parse","stringify","removeResourceBundle","hasResourceBundle","getResourceBundle","getDataByLanguage","hasLanguageSomeTranslations","keys","find","v","toJSON","postProcessor","processors","addPostProcessor","name","handle","translator","processor","process","checkedLoadedFor","shouldHandleAsObject","Translator","services","changeLanguage","language","exists","interpolation","resolved","extractFromKey","nsSeparator","namespaces","wouldCheckForNsInKey","seemsNaturalLanguage","userDefinedKeySeparator","userDefinedNsSeparator","possibleChars","filter","r","map","matched","test","ki","substring","looksLikeObjectPath","match","interpolator","nestingRegexp","parts","translate","lastKey","overloadTranslationOptionHandler","returnDetails","namespace","appendNamespaceToCIMode","toLowerCase","usedKey","exactUsedKey","usedLng","usedNS","usedParams","getUsedParamsDetails","resUsedKey","resExactUsedKey","joinArrays","handleAsObjectInI18nFormat","i18nFormat","handleAsObject","needsPluralHandling","count","hasDefaultValue","defaultValueSuffix","pluralResolver","getSuffix","defaultValueSuffixOrdinalFallback","ordinal","needsZeroSuffixLookup","defaultValue","pluralSeparator","resForObjHndl","resType","toString","extendTranslation","usedDefault","isValidLookup","resForMissing","missingKeyNoValueFallbackToKey","updateMissing","fk","lngs","fallbackLngs","languageUtils","getFallbackCodes","fallbackLng","saveMissingTo","toResolveHierarchy","send","specificDefaultValue","defaultForMissing","missingKeyHandler","backendConnector","saveMissing","saveMissingPlurals","suffixes","getSuffixes","suffix","appendNamespaceToMissingKey","parseMissingKeyHandler","returnObjects","returnedObjectHandler","resTypeIsArray","copy","newKeyToUse","deepKey","_this","defaultVariables","skipInterpolation","skipOnVariables","nestBef","nb","interpolate","na","nest","context","reset","postProcess","postProcessorNames","applyPostProcessor","postProcessPassResolved","i18nResolved","found","extracted","fallbackNS","needsContextHandling","codes","utils","hasLoadedNamespace","finalKeys","addLookupKeys","pluralSuffix","zeroSuffix","ordinalPrefix","contextKey","contextSeparator","possibleKey","pop","returnNull","returnEmptyString","resourceStore","optionsKeys","useOptionsReplaceForData","option","LanguageUtil","supportedLngs","getScriptPartFromCode","formatLanguageCode","getLanguagePartFromCode","formattedCode","Intl","getCanonicalLocales","lowerCaseLng","cleanCode","isSupportedCode","load","nonExplicitSupportedLngs","getBestMatchFromCodes","cleanedLng","lngOnly","supportedLng","fallbacks","default","fallbackCode","fallbackCodes","addCode","fc","suffixesOrder","zero","one","two","few","many","other","dummyRule","select","resolvedOptions","pluralCategories","PluralResolver","pluralRulesCache","addRule","rules","clearCache","getRule","cleanedCode","cacheKey","rule","PluralRules","err","lngPart","needsPlural","getPluralFormsOfKey","sort","pluralCategory1","pluralCategory2","pluralCategory","prepend","deepFindWithDefaults","defaultData","getPathWithDefaults","regexSafe","val","Interpolator","format","escapeValue","escape$1","useRawValueToEscape","prefixEscaped","suffixEscaped","formatSeparator","unescapeSuffix","unescapePrefix","nestingPrefix","nestingPrefixEscaped","nestingSuffix","nestingSuffixEscaped","nestingOptionsSeparator","maxReplaces","alwaysFormat","resetRegExp","getOrResetRegExp","existingRegExp","lastIndex","regexp","regexpUnescape","replaces","handleFormat","interpolationkey","trim","f","missingInterpolationHandler","regex","safeValue","todo","exec","matchedVar","temp","clonedOptions","handleHasOptions","inheritedOptions","sep","optionsString","matchedSingleQuotes","matchedDoubleQuotes","formatters","doReduce","elem","reduce","createCachedFormatter","fn","cache","optForCache","formatParams","formatter","Formatter","formats","number","opt","NumberFormat","currency","style","datetime","DateTimeFormat","relativetime","RelativeTimeFormat","range","list","ListFormat","add","addCached","findIndex","mem","formatName","formatOptions","formatStr","optStr","rest","trimmedKey","isNaN","parseInt","parseFormatStr","formatted","valOptions","locale","Connector","backend","store","waitingReads","maxParallelReads","readingCalls","maxRetries","retryTimeout","state","queue","queueLoad","languages","callback","toLoad","pending","toLoadLanguages","toLoadNamespaces","hasAllNamespaces","reload","pendingCount","loaded","errors","q","pushPath","removePending","done","loadedKeys","read","fcName","tried","wait","resolver","setTimeout","bind","then","catch","prepareLoading","loadOne","fallbackValue","isUpdate","clb","opts","initAsync","preload","simplifyPluralSuffix","partialBundledLanguages","ret","tDescription","transformOptions","initImmediate","noop","I18n","inst","modules","external","getOwnPropertyNames","getPrototypeOf","isInitialized","isClone","isInitializing","defOpts","createClassOnDemand","ClassOrObject","lu","languageDetector","detection","deferred","finish","initializedStoreOnce","loadResources","usedCallback","append","resolvedLanguage","setResolvedLanguage","reloadResources","use","Error","li","lngInLngs","_this2","isLanguageChangingTo","setLngProps","setLng","cacheUserLanguage","async","detect","getFixedT","keyPrefix","_this3","fixedT","resultKey","_len5","_key5","setDefaultNamespace","lastLng","loadNotPending","loadState","precheck","preResult","loadNamespaces","loadLanguages","preloaded","newLngs","dir","createInstance","cloneInstance","forkResourceStore","mergedOptions","clonedData","prev","acc","_len6","_key6","instance","i18next","lang","opening_hours_resources","getAsync","useCookie","nominatim_object","optional_conf_parm","word_value_replacement","dawn","sunrise","sunset","dusk","months","weekdays","string_to_token_map","su","mo","tu","we","th","fr","sa","jan","feb","mar","apr","may","jun","jul","aug","oct","nov","day","days","easter","week","open","closed","unknown","default_prettify_conf","zero_pad_hour","one_zero_if_hour_zero","leave_off_closed","keyword_for_off_closed","rule_sep_string","print_semicolon","leave_weekday_sep_one_day_betw","sep_one_day_between","zero_pad_month_and_week_numbers","osm_tag_defaults","opening_hours","mode","warn_for_PH_missing","collection_times","smoking_hours","service_times","happy_hours","lit","yes","automatic","no","interval","limited","minutes_in_day","msec_in_day","library_name","repository_url","location_cc","location_state","lon","variables","text","address","country_code","county","oh_mode","oh_key","oh_regex_key","regex_key","exact_match","warnings_severity","oh_map_value","checkOptionalConfParm","severity","allowed","map_value","given","osm_key","parsing_warnings","done_with_warnings","done_with_selector_reordering","done_with_selector_reordering_warnings","tokenize","all_tokens","curr_rule_tokens","last_rule_fallback_terminated","tmp","token_from_map","substr","toUpperCase","unicode_code_point_to_digit","regular_number","ch","code_point","charCodeAt","ok","matchTokens","ko","correct_val","returnCorrectWordOrToken","hours_token","hours_token_at","correct_tokens","formatLibraryBugMessage","Number","formatWarnErrorMessage","pos","prettified_value","week_stable","rule_infos","new_tokens","nrule","continue_at","next_rule_is_additional","wraptime","weekday","holiday","month","monthday","year","fallback","additional","meaning","comment","build_from_token_rule","parseGroup","unshift","element","wrapselectors","wrapped","dselg","dsel","generateDateShifter","expected_type","expected","at","message","tokens_to_use","text_template","url","word","value_length","correctWordOrToken","word_error_correction","old_val","getWarnings","it","wide_range_selector_order","small_range_selector_order","used_selectors","used_selectors_types_array","has_token","selector_start_end_type","getSelectorRange","token_pos","selector_type","part2","what","next_selector_type","rules_too_complex","rules_too_complex_count","el","next_rule_selects_next_day","week_day","additional_rule_separator_enabled","additional_rule_separator","advance","keys_with_warn_for_PH_missing","prettifyValue","warnings","tokenIsTheBeginOfSelector","selector_end","pos_in_token_array","selector_start","argument_hash","rule_index","user_conf","get_internals","prettified_value_array","conf","_is_en_or_all","months_local","toLocaleString","weekdays_local","prettified_group_value","prettifySelector","not_sorted_prettified_group_value","selector_order","old_prettified_value_length","translatorFunction","array","x","first","second","func","getTime","rule_modifier_specified","last_selector","parseWeekdayRange","parseHoliday","parseMonthdayRange","parseYearRange","parseMonthRange","parseWeekRange","parseTimeRange","token","dateAtDayMinutes","minutes","getFullYear","getMonth","getDate","dateAtNextWeekday","delta","getDay","parseNumRange","getConstrainedWeekday","endat","to","symbol","checkPeriod","period","period_type","parm_string","getDateForConstrainedWeekday","constrained_weekday","add_days","tmp_date","setDate","checkIfDateIsValid","extended_open_end","minutes_from","minutes_to","has_time_var_calc","has_normal_time","point_in_time_period","is_point_in_time","has_open_end","timevar_add","timevar_string","getMinutesByHoursMinutes","parseTimevarCalc","at_end_time","calc","libraryname","ourminutes","getHours","getMinutes","date_from","date_to","cur_min","syntax","add_or_subtract","in_holiday_selector","numbers","getMoveDays","nnumber","target_day_this_month","date_num","getValueForDate","start_of_this_month","start_of_next_month","target_day_with_added_moved_days_this_month","target_day_with_added_days_this_month","is_range","weekday_from","weekday_to","inside","weekday_list","_","ourweekday","max_differ","maxdiffer","push_to_weekday","applying_holidays","getMatchingHoliday","selector","holidays","getApplyingHolidaysForYear","next_holiday_date_num","holidays_last_year","last_holiday_last_year","last_holiday_last_year_num","first_holidays_next_year","getSHForYear","holiday_to_plus","holiday_from","holiday_to","holiday_ends_next_year","last_year_holiday","last_year_holiday_from","last_year_holiday_to","include_year","SH_hash","fatal","type_of_holidays","holiday_definitions","cc","matching_holiday","country_holidays","state_holidays","country_holiday_names","country_holiday","state_holiday","h1_year","h2_year","h1_date","h2_date","applying_holidays_for_country","holiday_item","only_states","getMovableEventsForYear","C","floor","N","K","I","oDate","J","D","oD","oF","lastFebruaryDay","lastFebruarySunday","victoriaDay","canadaDay","firstWeekdayOfMonth","lastWeekdayOfMonth","offset","getDateOfWeekdayInDateRange","start_date","days_to_dest_date","getDateOfNextWeekdayRange","first_weekday","last_weekday","firstJanuaryMonday","firstFebruaryMonday","firstMarchMonday","firstAprilMonday","firstMayMonday","firstJuneMonday","firstJulyMonday","firstAugustMonday","firstSeptemberMonday","firstSeptemberTuesday","firstSeptemberSunday","firstOctoberMonday","firstNovemberMonday","firstNovemberTuesday","firstMarchTuesday","firstAugustTuesday","firstAugustFriday","firstNovemberThursday","lastMayMonday","lastMarchMonday","lastAprilMonday","lastAprilFriday","lastAugustMonday","lastSeptemberMonday","lastSeptemberFriday","lastOctoberMonday","lastOctoberFriday","nextSaturday20Jun","nextSaturday31Oct","nextWednesday16Nov","springEquinox","springEquinoxCalc","autumnalEquinox","autumnalEquinoxCalc","next_holiday","movableDays","sorted_holidays","fixed_date","selected_movableDay","variable_date","date_offset","has_period","year_from","ouryear","year_to","week_from","week_to","weekfrom","weekto","ourweek","getWeekNumber","getNextDateOfISOWeek","yearStart","ceil","next_date","simple","dow","ISOweekStart","push_to_monthday","in_selector","month_from","month_to","ourmonth","dateAtNextMonth","push_to_month","at_range_sep","at_sec_event_or_month","has_year","has_month","has_event","has_calc","has_constrained_weekday","from_date","to_date","start_of_next_year","from_year_before_calc","to_year_before_calc","first_round","range_from","range_to","at_timesep_if_monthRange","in_period","event_date","getStatePair","changedate","match_rule","resultstate","date_matching_rules","matching_date_rule","ndateselector","dateselectors","has_matching_selector","datesel","timesel","next_res","getState","getIterator","getUnknown","getStateString","past","getComment","getMatchingRule","getNextChange","maxdate","isWeekStable","isEqualTo","second_oh_object","datelimit","first_it","second_it","not_equal","deviation_for_time","matching_rule","matching_rule_other","getOpenIntervals","getOpenDuration","prevdate","prevstate","prevunknown","oh"],"mappings":"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","x_google_ignoreList":[0,1]}