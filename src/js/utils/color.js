/**
 * Códigos de color válidos para utilizar en ilustraciones. 
 */
const illustrationColors = [
    "primary",
    "miarg-azul",
    "palta",
    "success",
    "arandano",
    "rosado",
    "arena",
    "warning"
];


/**
 * Definición de colores Poncho
 */
const ponchoColorDefinitionsList = [
    {
        description: "",
        scope: "",
        name: "Azul MiArgentina",
        color: "#362FC1",
        code: "miarg-azul",
        alias: [
            "miarg-azul"
        ]
    },
    {
        description: "",
        scope: "",
        name: "Arena",
        color: "#EAE1B7",
        code: "arena",
        alias: [
            "arena"
        ]
    },
    {
        description: "",
        scope: "",
        name: "Rosado",
        color: "#F48EAB",
        code: "rosado",
        alias: [
            "rosado"
        ]
    },
    {
        description: "",
        scope: "",
        name: "Blanco",
        color: "#FFFFFF",
        code: "white",
        alias: [
            "white"
        ]
    },
    {
        description: "",
        scope: "",
        name: "Gris base",
        color: "#333333",
        code: "gray-base",
        alias: [
            "gray-base"
        ]
    },
    {
        description: "",
        scope: "brand",
        name: "Azul",
        color: "#242C4F",
        code: "azul",
        alias: [
            "azul"
        ]
    },
    {
        description: "",
        scope: "brand",
        name: "Azul",
        color: "#242C4F",
        code: "primary",
        alias: [
            "azul",
            "primary"
        ]
    },
    {
        description: "Acción principal o exitosa",
        scope: "brand",
        name: "Verde",
        color: "#2E7D33",
        code: "success",
        alias: [
            "verde",
            "success"
        ]
    },
    {
        description: "Atención o peligro",
        scope: "brand",
        name: "Rojo",
        color: "#C62828",
        code: "danger",
        alias: [
            "rojo",
            "danger"
        ]
    },
    {
        description: "Foco o alerta",
        scope: "brand",
        name: "Amarillo",
        color: "#E7BA61",
        code: "warning",
        alias: [
            "amarillo",
            "warning"
        ]
    },
    {
        description: "",
        scope: "brand",
        name: "Celeste",
        color: "#3e5a7e",
        code: "info",
        alias: [
            "celeste",
            "info"
        ]
    },
    {
        description: "Elementos básicos",
        scope: "brand",
        name: "Negro",
        color: "#333333",
        code: "black",
        alias: [
            "negro",
            "black"
        ]
    },
    {
        description: "Elementos básicos",
        scope: "",
        name: "Negro",
        color: "#333333",
        code: "black",
        alias: [
            "black"
        ]
    },
    {
        description: "Enlace visitado",
        scope: "brand",
        name: "Uva",
        color: "#6A1B99",
        code: "uva",
        alias: [
            "uva"
        ]
    },
    {
        description: "Texto secundario (subtitulos)",
        scope: "brand",
        name: "Gris",
        color: "#525252",
        code: "muted",
        alias: [
            "gris",
            "muted"
        ]
    },
    {
        description: "Gris área",
        scope: "",
        name: "Gris intermedio",
        color: "#555555",
        code: "gray",
        alias: [
            "grisintermedio",
            "gris-area",
            "gray"
        ]
    },
    {
        description: "Fondo footer/header",
        scope: "brand",
        name: "Celeste Argentina",
        color: "#37BBED",
        code: "celeste-argentina",
        alias: [
            "celesteargentina",
            "celeste-argentina"
        ]
    },
    {
        description: "",
        scope: "brand",
        name: "Fucsia",
        color: "#EC407A",
        code: "fucsia",
        alias: [
            "fucsia"
        ]
    },
    {
        description: "",
        scope: "brand",

        name: "Arándano",
        color: "#C2185B",
        code: "arandano",
        alias: [
            "arandano"
        ]
    },
    {
        description: "",
        scope: "brand",
        name: "Cielo",
        color: "#039BE5",
        code: "cielo",
        alias: [
            "cielo"
        ]
    },
    {
        description: "",
        scope: "brand",
        name: "Verdin",
        color: "#6EA100",
        code: "verdin",
        alias: [
            "verdin"
        ]
    },
    {
        description: "",
        scope: "brand",
        name: "Lima",
        color: "#CDDC39",
        code: "lima",
        alias: [
            "lima"
        ]
    },
    {
        description: "",
        scope: "brand",
        name: "Maiz",
        color: "#FFCE00",
        code: "maiz",
        alias: [
            "maiz",
            "maíz"
        ]
    },
    {
        description: "",
        scope: "brand",
        name: "Tomate",
        color: "#EF5350",
        code: "tomate",
        alias: [
            "tomate"
        ]
    },
    {
        description: "",
        scope: "brand",
        name: "Naranja oscuro",
        color: "#EF6C00",
        code: "naranja",
        alias: [
            "naranjaoscuro",
            "naranja"
        ]
    },
    {
        description: "",
        scope: "brand",
        name: "Verde azulado",
        color: "#008388",
        code: "verde-azulado",
        alias: [
            "verdeazulado",
            "verde-azulado"
        ]
    },
    {
        description: "",
        scope: "brand",
        name: "Escarapela",
        color: "#2CB9EE",
        code: "escarapela",
        alias: [
            "escarapela"
        ]
    },
    {
        description: "",
        scope: "brand",
        name: "Lavanda",
        color: "#9284BE",
        code: "lavanda",
        alias: [
            "lavanda"
        ]
    },
    {
        description: "",
        scope: "brand",
        name: "Mandarina",
        color: "#F79525",
        code: "mandarina",
        alias: [
            "mandarina"
        ]
    },
    {
        description: "",
        scope: "brand",
        name: "Palta",
        color: "#50B7B2",
        code: "palta",
        alias: [
            "palta"
        ]
    },
    {
        description: "",
        scope: "brand",
        name: "Cereza",
        color: "#ED3D8F",
        code: "cereza",
        alias: [
            "cereza"
        ]
    },
    {
        description: "",
        scope: "brand",
        name: "Limón",
        color: "#D7DF23",
        code: "limon",
        alias: [
            "limon"
        ]
    },
    {
        description: "",
        scope: "brand",
        name: "Verde Jade",
        color: "#006666",
        code: "verde-jade",
        alias: [
            "verdejade",
            "verde-jade"
        ]
    },
    {
        description: "",
        scope: "brand",
        name: "Verde Aloe",
        color: "#4FBB73",
        code: "verde-aloe",
        alias: [
            "verdealoe",
            "verde-aloe"
        ]
    },
    {
        description: "",
        scope: "brand",
        name: "Verde Cemento",
        color: "#B4BEBA",
        code: "verde-cemento",
        alias: [
            "verdecemento",
            "verde-cemento"
        ]
    },
    {
        "description": "",
        "scope": "",
        "name": "Gray dark",
        "color": "#444444",
        "code": "gray-dark",
        "alias": [
            "gray-dark"
        ]
    },
    {
        "description": "",
        "scope": "",
        "name": "Gray border",
        "color": "#DEE2E6",
        "code": "gray-border",
        "alias": [
            "gray-border"
        ]
    },
    {
        "description": "",
        "scope": "",
        "name": "Gray hover",
        "color": "#E9E9E9",
        "code": "gray-hover",
        "alias": [
            "gray-hover"
        ]
    },
    {
        "description": "",
        "scope": "",
        "name": "gray hover light",
        "color": "#F0F0F0",
        "code": "gray-hover-light",
        "alias": [
            "gray-hover-light"
        ]
    },
    {
        "description": "",
        "scope": "",
        "name": "gray background",
        "color": "#FFFFFF",
        "code": "gray-background",
        "alias": [
            "gray-background"
        ]
    },
    {
        "description": "",
        "scope": "",
        "name": "Gray light",
        "color": "#DDDDDD",
        "code": "gray-light",
        "alias": [
            "gray-light"
        ]
    },
    {
        "description": "",
        "scope": "",
        "name": "Gray lighter",
        "color": "#F2F2F2",
        "code": "gray-lighter",
        "alias": [
            "gray-lighter"
        ]
    },
    {
        "description": "",
        "scope": "brand",
        "name": "Default",
        "color": "#838383",
        "code": "default",
        "alias": [
            "default"
        ]
    },
    {
        "description": "",
        "scope": "brand",
        "name": "Primary alt",
        "color": "#242C4F",
        "code": "primary-alt",
        "alias": [
            "primary-alt"
        ]
    },
    {
        "description": "",
        "scope": "brand",
        "name": "Primary light",
        "color": "#F3FAFF",
        "code": "primary-light",
        "alias": [
            "primary-light"
        ]
    },
    {
        "description": "",
        "scope": "brand",
        "name": "Secondary",
        "color": "#45658D",
        "code": "secondary",
        "alias": [
            "secondary"
        ]
    },
    {
        "description": "",
        "scope": "brand",
        "name": "Complementary",
        "color": "#EF5350",
        "code": "complementary",
        "alias": [
            "complementary"
        ]
    },
    {
        "description": "",
        "scope": "brand",
        "name": "Azul marino",
        "color": "#242C4F",
        "code": "azul-marino",
        "alias": [
            "azul-marino"
        ]
    },
    {
        "description": "",
        "scope": "brand",
        "name": "Amarillo intenso",
        "color": "#E7BA61",
        "code": "amarillo-intenso",
        "alias": [
            "amarillo-intenso"
        ]
    }
];


/**
 * Variaciones de color
 */
const colorVariations = {
    high: [
        "primary","verde-jade","success","naranja","danger","arandano",
        "uva","celeste-argentina","palta","verdin","warning","tomate",
        "fucsia","lavanda","black"
    ],
    medium: [
        "info","verde-azulado","verdin","warning","tomate","fucsia",
        "lavanda","palta","lima","maiz","muted"
    ]
};


/**
 * Definición por color
 * 
 * @see ponchoColorDefinitionsList
 * @param {string} color Nombre del cólor a buscar. 
 * @returns {string|boolean}
 */
const ponchoColorDefinitions = ponchoColor => {
    if(typeof ponchoColor == undefined || !ponchoColor?.trim()){
        return;
    }
    let result = null;
    let gSpace = '';
    for(let i = 0; i <= theme.length -1; i++){
        const {data, space} = theme[i];
        gSpace = space;
        for (let item of data) {

            for (const f of item.instance) {
                if (f.alias.includes( ponchoColor )) {
                    result = f;
                    break;
                }
            }
            if (result) break;

        }
    }
    /*
    if(result){
        const {parent_group, scope} = result;
        const group = ponchoColorGroup(scope, parent_group);
        const {color=false, name=false} = group;
        if(color){
            result.group = {color, name};
        }
    }
    */


    return result;
};


/**
 * Grupo de color
 * @param {string} name Nombre del grupo 
 * @returns 
 */
const ponchoColorGroup = (themeSpace, spaceGroup) => {

    if(typeof spaceGroup == undefined || !spaceGroup?.trim()){
        return;
    }
    let result;
    for(let i = 0; i <= theme.length -1; i++){
        const {data, space} = theme[i];
        result = data.find(obj => (obj.group==spaceGroup && space==themeSpace));
        if (result) break;
    }
    return result;
};


/**
 * Espacio de color
 * @param {string} name Nombre del espacio
 * @returns 
 */
const ponchoColorSpace = (space) => {
    if(typeof space == undefined || !space?.trim()){
        return;
    }

    return theme.find(obj => obj.space==space);
};


/**
 * Colores poncho a hexa
 * 
 * @see https://argob.github.io/poncho/identidad/colores/
 * @param {string} color Nombre de color Poncho.
 * @example
 * // returns "#2897d4"
 * getColor("celeste")
 * @returns {string} Color en formato hexadecimal.
 */
const ponchoColor = color => {
    const defaultColor = "#99999";

    if (typeof color !== "string") {
        console.warn(`Invalid color provided. Using default: ${defaultColor}`);
        return defaultColor;
    }

    const definition = ponchoColorDefinitions( color.toLocaleLowerCase() );
    if (definition) {
        return definition.color || defaultColor;
    }

    return defaultColor;
};


/**
 * Hace un refactor del número hexa
 * 
 * @param {string} value Valor hexadecimal 
 * @returns {string}
 */
const cleanUpHex = value => {
    let hex = value
            .toString()
            .replace("#", "")
            .trim()
            .toUpperCase();

    if (hex.length < 3 || hex.length > 6){
        return false;
    } else if(hex.length == 3){
        hex = Array.from(hex).map(a => a.repeat(2)).join("");
    }
    return `#${hex}`;
};


/**
 * Retorna el código de color poncho por hexadecimal.
 * @param {string} value Valor hexadecimal a buscar 
 * @see ponchoColorDefinitionsList
 * @example
 * // {
 * //    "description": "",
 * //    "name": "Mandarina",
 * //    "color": "#f79525",
 * //    "code": "mandarina",
 * //    "alias": [
 * //        "mandarina"
 * //    ]
 * // }
 * findByHex("#f79525");
 * @returns {object} Objecto con la defición del color
 */
const ponchoColorByHex = (hexColor ) => {
    let result;
    const targetColor = cleanUpHex(hexColor);
    for(let i = 0; i <= theme.length -1; i++){
        let {data} = theme[i];

        for(entry of data){
            const {instance} = entry;
            for(item of instance){
                const {color, code} = item;
                if( cleanUpHex(color) === targetColor ){
                    result = code;
                    break;
                }
            }

        }

    }
    return result;
}


/**
 * Converson de HEX a RGB.
 * @param {string} hexColor Color hexadecimal
 * @returns {object}
 */
const hexToRgb = hexColor => {
    if (!hexColor || !hexColor.match(/^#?([A-Fa-f0-9]{3}|[A-Fa-f0-9]{6})$/gm)) {
        console.warn("Invalid hex color format:", hexColor);
        return null;
    }

    const hex = cleanUpHex(hexColor);
    const cleanedHex = (hex.startsWith("#") ? hex.slice(1) : hex);

    const red = parseInt(cleanedHex.slice(0, 2), 16);
    const green = parseInt(cleanedHex.slice(2, 4), 16);
    const blue = parseInt(cleanedHex.slice(4, 6), 16);

    return [red, green, blue];
}


if (typeof exports !== "undefined") {
    module.exports = {
        ponchoColorDefinitionsList,illustrationColors,
        ponchoColorDefinitions, ponchoColor, ponchoColorByHex, cleanUpHex};
}