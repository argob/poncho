

/**
 * DETAILS & SUMMARY
 *
 * @see https://github.com/argob/poncho/blob/master/src/scss/modules/_details.scss
 * @demo en: https://codepen.io/agustinbouillet/pen/dyxZpNz?editors=0100
 * @author Agustín Bouillet <bouilleta@jefatura.gob.ar>
 * Copyright (c) 2025 Argentina.gob.ar
 */

/**
 * Variables SCSS
 */
// details tag
$detailsPaddingY: 9px;
$detailsPaddingX: 0px;
$detailsBorderColor: #CCCCCC;

// summary tag
$summaryPaddingS: 1px;
$summaryPaddingE: 1px;
$summaryPaddingT: 9px;
$summaryPaddingB: 9px;
$summaryLineHeightSmall: 1.25em;
$summaryLineHeightDefault: 1.35em;

// caret
$circleDefaultSize: 39px;
$circleSmallSize: 31px;

$caretDefaultSize: 26px;
$caretSmallSize: 22px;
$caretOpenCorrectionSmall: 4px; // @todo Definir los valores automáticamente.
$caretCloseCorrectionSmall: 6px;
$caretOpenCorrectionDefault: 2px;
$caretCloseCorrectionDefault: 4px;
$caretColor: var(--arg-negro-600, #444444);
$caretBackground: var(--arg-negro-100, #E9E9E9);

// media queries
$mediaBreakpoint: 768px;
$containerBreakpoint: 350px;


/**
 * Definiciones para el cambio de tamaño del caret
 */
@mixin smallCaret() {
    > summary {
        --circle-size: #{$circleSmallSize};
        --caret-width: #{$caretSmallSize};
        --summary-line-height: #{$summaryLineHeightSmall};
    }
    > summary {
        &::after {
            top: calc(
                (var(--circle-size) - var(--caret-width)) +
                #{$caretCloseCorrectionSmall}
            );
        }
    }
    &[open] {
        > summary {
            &::after {
                top: calc(
                    (var(--circle-size) - var(--caret-width)) +
                    #{$caretOpenCorrectionSmall}
                );
            }
        }
    }
}

/**
 * Color de los caret
 *
 * @param {string} $background Color de fondo para el contenedor del caret.
 * @param {string} $fill Color para el caret.
 */
@mixin caretColor($background, $fill) {
    & > summary {
        &::before {
            background: $background;
        }
        &::after {
            background-color: $fill;
        }
    }
}

/* Definición de temas de color */
$colorThemes: (
    warning: (
        background: var(--arg-amarillo),
        caret: black
    ),
    success: (
        background: var(--arg-verde),
        caret: white
    ),
    danger: (
        background: var(--arg-rojo),
        caret: white
    ),
    blanco: (
        background: var(--arg-blanco),
        caret: black
    ),
    palta: (
        background: var(--arg-palta),
        caret: black
    ),
    primary: (
        background: var(--arg-azul),
        caret: white
    ),
    azul-morado: (
        background: var(--arg-azul-morado),
        caret: white
    ),
    negro: (
        background: var(--arg-negro-600),
        caret: white
    ),
    dark: (
        background: rgb(0 0 0 / 0.35),
        caret: white
    ),
    light: (
        background: rgb(255 255 255 / 0.75),
        caret: black
    ),
    default: (
        background: #{$caretBackground},
        caret: #{$caretColor}
    ),
    transparent: (
        background: transparent,
        caret: var(--arg-azul)
    ),
    rosado: (
        background: var(--arg-rosado),
        caret: white
    )
);


details {
    --icon: url('data:image/svg+xml;utf8,<svg focusable="false" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M16.59 8.59L12 13.17 7.41 8.59 6 10l6 6 6-6z"></path></svg>');
    --details-border-color: #{$detailsBorderColor};
    --details-padding-x: 0px;
    --details-padding-y: #{$detailsPaddingY};

    --summary-line-height: #{$summaryLineHeightDefault};
    
    --summary-padding-s: #{$summaryPaddingS}; // padding-left summary
    --summary-padding-e: #{$summaryPaddingE}; // padding-right summary
    --summary-padding-t: #{$summaryPaddingT}; // padding-top summary
    --summary-padding-b: #{$summaryPaddingB}; // padding-bottom summary
    
    --content-padding-s: #{$summaryPaddingS}; // padding-left contenido
    --content-padding-e: #{$summaryPaddingE}; // padding-right contenido
    --content-margin-t: .5rem; // margin-top contenido
    --content-margin-b: 1rem; // margin-bottom contenido
    
    --circle-size: #{$circleDefaultSize};
    --circle-margin-right: 10px;
    --caret-width: #{$caretDefaultSize};
    --caret-color: #{$caretColor};
    --caret-background: #{$caretBackground};

    /* Definitions */
    container: {
        type: inline-size;
        name: detailsSize;
    }
    border: {
        color: var(--details-border-color);
        style: solid;
        width: 0 0 1px 0;
    }

    &:last-child {
        border-bottom: 1px solid var(--details-border-color);
    }
    &.details-borderless {
        border: none !important;
    }
    &.details-border-top {
        border-top: 1px solid var(--details-border-color);
    }
    &.details-border-light {
        border-color: rgb(255 255 255 / 0.75) !important;
    }
    &.details-border-dark {
        border-color: rgb(0 0 0 / 0.25) !important;
    }

    summary {
        min-height: calc( var(--circle-size) + (var(--summary-padding-t) + var(--summary-padding-b)));
        line-height: var(--summary-line-height);
        display: flex;
        align-items: center;
        position: relative;
        list-style-type: none;
        cursor: pointer;
        
        box-sizing: border-box;
        -moz-box-sizing: border-box;
        -webkit-box-sizing: border-box;
        
        font-weight: 600;
        padding: {
            top: var(--summary-padding-t);
            bottom: var(--summary-padding-b);
            left: var(--summary-padding-s);
            right: calc(
                var(--circle-size) + 
                var(--details-padding-x) +
                var(--circle-margin-right) + 
                (var(--summary-padding-s) + var(--summary-padding-e))
            );
        }

        &::-webkit-details-marker {
            display: none;
        }

        &::before {
            content: " ";
            position: absolute;
            background: var(--caret-background);
            height: var(--circle-size);
            width: var(--circle-size);
            border-radius: 50%;
            text-align: center;
            aspect-ratio: 1 / 1 !important;
            top: var(--summary-padding-t);
            left: initial;
            right: var(--summary-padding-e);
        }

        &::after {
            width: var(--caret-width);
            height: var(--caret-width);
            margin: auto;
            vertical-align: -15%;
            -webkit-mask: {
                image: var(--icon);
                origin: fill-box;
                repeat: no-repeat !important;
                size: contain;
            }
            mask: {
                image: var(--icon);
                origin: fill-box;
                repeat: no-repeat !important;
                size: contain;
            }
            background-color: var(--caret-color);
            content: "";
            position: absolute;
            left: initial;
            top: calc(
                (var(--circle-size) - var(--caret-width)) + #{$caretCloseCorrectionDefault}
            );
            right: calc(
                ((var(--circle-size) - var(--caret-width)) / 2) +
                var(--summary-padding-e)
            );
        }
    }

    &.caret-left {
        > summary {
            padding: {
                left: calc(
                    var(--circle-size) + var(--details-padding-x) +
                        var(--circle-margin-right) + var(--summary-padding-s)
                );
                right: var(--summary-padding-e);
            }

            &::before {
                left: var(--summary-padding-s);
                top: var(--details-padding-y);
            }

            &::after {
                right: initial;
                left: calc(
                    ((var(--circle-size) - var(--caret-width)) / 2) +
                        var(--summary-padding-s)
                );
            }
        }
    }

    &[open] {
        > summary {
            &::after {
                transform: rotate(180deg);
                top: calc(
                    (var(--circle-size) - var(--caret-width)) +
                    #{$caretOpenCorrectionDefault}
                );
            }
        }
    }

    /* Creo los caret de color */
    @each $theme-name, $theme-colors in $colorThemes {
        &.caret-#{$theme-name} {
            @include caretColor(
                map-get($theme-colors, background),
                map-get($theme-colors, caret)
            );
        }
    }

    /* Define los atributos del contenedor para el contenido */
    .ar-details__content {
        background: transparent;
        padding: {
            left: var(--content-padding-s);
            right: var(--content-padding-s);
        }
        margin: {
            top: var(--content-margin-t);
            bottom: var(--content-margin-b);
        }
        line-height: inherit;
    }
    // @todo usar el pseudo elemento cuando esté habilitado
    // &[open]::details-content { }

    /* Caret small */
    &.caret-small {
        @include smallCaret();
    }
}

/*
Cuando un elemento en inferior al breakpoint los caret cambian el tamaño
*/
@container detailsSize (max-width: #{$containerBreakpoint}) {
    details {
        @include smallCaret();
    }
}

@media all and (max-width: #{$mediaBreakpoint}) {
    details {
        @include smallCaret();
    }
}


/**
 * Contenedores
 * Definición para los contenedores de los details
 */
.details-container {
    overflow: hidden;
    position: relative;
    border: 1px solid $detailsBorderColor;
    margin-bottom: 1em;
    border-radius: 3px;
    &.details-container__borderless {
        border: none;
    }

    &.details-container__rounded {
        border-radius: calc(#{$circleDefaultSize} / 2 + #{$detailsPaddingY});
    }
    
    &.details-container__rounded .details-container {
        border-radius: calc(#{$circleDefaultSize} / 2 + #{$detailsPaddingY}  - var(--content-padding-s) );
    }

    &.details-container__rounded:has(details.caret-small) {
        border-radius: calc(#{$circleSmallSize} / 2 + #{$detailsPaddingY} );
    }
    
    &.details-container__rounded:has(details.caret-small) .details-container:has(details.caret-small)  {
        border-radius: calc(#{$circleSmallSize} / 2 + #{$detailsPaddingY} - var(--content-padding-s) );
    }

    &:not(:is(.details-container__borderless)) details:last-of-type {
        border-bottom: none;
    }
    & > details  {
        --summary-padding-s: 18px; // padding-left summary
        --summary-padding-e: 9px; // padding-right summary
        --content-padding-s: 18px; // padding-left content
        --content-padding-e: 18px; // padding-right content
    }
    & > details:is(.caret-left)  {
        --summary-padding-s: 9px; // padding-left summary
        --summary-padding-e: 9px; // padding-right summary
        --content-padding-s: 18px; // padding-left content
        --content-padding-e: 18px; // padding-right content
    }
}

@media all and (max-width: $mediaBreakpoint) {
    .details-container {
        &.details-container__rounded {
            border-radius: calc(#{$circleSmallSize} / 2 + #{$detailsPaddingY});
        }
    }
}